var TimeCat=function(t){"use strict";function e(t,e,n,i){var s,r=arguments.length,o=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(r<3?s(o):r>3?s(e,n,o):s(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function n(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))}var i,s,r,o;function a(){}function l(t,e,n,i,s){for(var r=0,o=e.length,a=0,l=0;r<o;r++){var c=e[r];if(c.removed){if(c.value=t.join(i.slice(l,l+c.count)),l+=c.count,r&&e[r-1].added){var d=e[r-1];e[r-1]=e[r],e[r]=d}}else{if(!c.added&&s){var h=n.slice(a,a+c.count);h=h.map((function(t,e){var n=i[l+e];return n.length>t.length?n:t})),c.value=t.join(h)}else c.value=t.join(n.slice(a,a+c.count));a+=c.count,c.added||(l+=c.count)}}var u=e[o-1];return o>1&&"string"==typeof u.value&&(u.added||u.removed)&&t.equals("",u.value)&&(e[o-2].value+=u.value,e.pop()),e}function c(t){return{newPos:t.newPos,components:t.components.slice(0)}}t.RecordType=void 0,(i=t.RecordType||(t.RecordType={}))[i.HEAD=0]="HEAD",i[i.SNAPSHOT=1]="SNAPSHOT",i[i.WINDOW=2]="WINDOW",i[i.SCROLL=3]="SCROLL",i[i.MOUSE=4]="MOUSE",i[i.DOM=5]="DOM",i[i.FORM_EL=6]="FORM_EL",i[i.LOCATION=7]="LOCATION",i[i.AUDIO=8]="AUDIO",i[i.CANVAS=9]="CANVAS",i[i.TERMINATE=10]="TERMINATE",i[i.FONT=11]="FONT",i[i.PATCH=12]="PATCH",i[i.CUSTOM=13]="CUSTOM",i[i.WEBGL=14]="WEBGL",i[i.CANVAS_SNAPSHOT=15]="CANVAS_SNAPSHOT",i[i.VIDEO=16]="VIDEO",function(t){t[t.PROP=0]="PROP",t[t.INPUT=1]="INPUT",t[t.CHANGE=2]="CHANGE",t[t.FOCUS=3]="FOCUS",t[t.BLUR=4]="BLUR"}(s||(s={})),function(t){t[t.MOVE=0]="MOVE",t[t.CLICK=1]="CLICK"}(r||(r={})),function(t){t.READONLY="readonly",t.READWRITE="readwrite",t.VERSIONCHANGE="versionchange"}(o||(o={})),a.prototype={diff:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.callback;"function"==typeof n&&(i=n,n={}),this.options=n;var s=this;function r(t){return i?(setTimeout((function(){i(void 0,t)}),0),!0):t}t=this.castInput(t),e=this.castInput(e),t=this.removeEmpty(this.tokenize(t));var o=(e=this.removeEmpty(this.tokenize(e))).length,a=t.length,d=1,h=o+a,u=[{newPos:-1,components:[]}],p=this.extractCommon(u[0],e,t,0);if(u[0].newPos+1>=o&&p+1>=a)return r([{value:this.join(e),count:e.length}]);function f(){for(var n=-1*d;n<=d;n+=2){var i=void 0,h=u[n-1],p=u[n+1],f=(p?p.newPos:0)-n;h&&(u[n-1]=void 0);var m=h&&h.newPos+1<o,g=p&&0<=f&&f<a;if(m||g){if(!m||g&&h.newPos<p.newPos?(i=c(p),s.pushComponent(i.components,void 0,!0)):((i=h).newPos++,s.pushComponent(i.components,!0,void 0)),f=s.extractCommon(i,e,t,n),i.newPos+1>=o&&f+1>=a)return r(l(s,i.components,e,t,s.useLongestToken));u[n]=i}else u[n]=void 0}d++}if(i)!function t(){setTimeout((function(){if(d>h)return i();f()||t()}),0)}();else for(;d<=h;){var m=f();if(m)return m}},pushComponent:function(t,e,n){var i=t[t.length-1];i&&i.added===e&&i.removed===n?t[t.length-1]={count:i.count+1,added:e,removed:n}:t.push({count:1,added:e,removed:n})},extractCommon:function(t,e,n,i){for(var s=e.length,r=n.length,o=t.newPos,a=o-i,l=0;o+1<s&&a+1<r&&this.equals(e[o+1],n[a+1]);)o++,a++,l++;return l&&t.components.push({count:l}),t.newPos=o,a},equals:function(t,e){return this.options.comparator?this.options.comparator(t,e):t===e||this.options.ignoreCase&&t.toLowerCase()===e.toLowerCase()},removeEmpty:function(t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e},castInput:function(t){return t},tokenize:function(t){return t.split("")},join:function(t){return t.join("")}};var d=new a;var h=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,u=/\S/,p=new a;p.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!u.test(t)&&!u.test(e)},p.tokenize=function(t){for(var e=t.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),n=0;n<e.length-1;n++)!e[n+1]&&e[n+2]&&h.test(e[n])&&h.test(e[n+2])&&(e[n]+=e[n+2],e.splice(n+1,2),n--);return e};var f=new a;function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}f.tokenize=function(t){var e=[],n=t.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var i=0;i<n.length;i++){var s=n[i];i%2&&!this.options.newlineIsToken?e[e.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),e.push(s))}return e},(new a).tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)},(new a).tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};var g=Object.prototype.toString,_=new a;function y(t,e,n,i,s){var r,o;for(e=e||[],n=n||[],i&&(t=i(s,t)),r=0;r<e.length;r+=1)if(e[r]===t)return n[r];if("[object Array]"===g.call(t)){for(e.push(t),o=new Array(t.length),n.push(o),r=0;r<t.length;r+=1)o[r]=y(t[r],e,n,i,s);return e.pop(),n.pop(),o}if(t&&t.toJSON&&(t=t.toJSON()),"object"===m(t)&&null!==t){e.push(t),n.push(o={});var a,l=[];for(a in t)t.hasOwnProperty(a)&&l.push(a);for(l.sort(),r=0;r<l.length;r+=1)o[a=l[r]]=y(t[a],e,n,i,a);e.pop(),n.pop()}else o=t;return o}_.useLongestToken=!0,_.tokenize=f.tokenize,_.castInput=function(t){var e=this.options,n=e.undefinedReplacement,i=e.stringifyReplacer,s=void 0===i?function(t,e){return void 0===e?n:e}:i;return"string"==typeof t?t:JSON.stringify(y(t,null,null,s),s,"  ")},_.equals=function(t,e){return a.prototype.equals.call(_,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};var b=new a;b.tokenize=function(t){return t.slice()},b.join=b.removeEmpty=function(t){return t};const v="1.2.0-alpha.27";function E(t){const e=t.message||t;return console.error(`TimeCat Error: ${e}`),e}function w(){return Date.now()}function T(t=8){return(20*Math.random()+16).toString(36).substring(2,t+2).toUpperCase()}function x(t){const e=t.split(":");if(2===e.length){const[t,n]=e;return 1e3*(60*+t+ +n)}const[n,i,s]=e;return 1e3*(3600*+n+60*+i+ +s)}function A(e){return e.type===t.RecordType.SNAPSHOT&&!e.data.frameId}function R(t=200){return n(this,void 0,void 0,(function*(){return new Promise((e=>{setTimeout((()=>e()),t)}))}))}function S(t){return!!t.tag}function I(t,e){return function(t){let e=0;return t.map((t=>{const{added:n,removed:i,value:s,count:r}=t,o=r||0;if(n){const t={index:e,type:"add",value:s};return e+=o,t}if(i){return{index:e,type:"rm",len:o}}e+=o})).filter(Boolean)}(function(t,e,n){return d.diff(t,e,n)}(t,e))}function O(t,e,n={}){let i,s,r,o=null,a=0;const l=function(){a=!1===n.leading?0:Date.now(),o=null,r=t.apply(i,s),o||(i=s=null)};return function(){const c=Date.now();a||!1!==n.leading||(a=c);const d=e-(c-a);return i=this,s=arguments,d<=0||d>e?(o&&(clearTimeout(o),o=null),a=c,r=t.apply(i,s),o||(i=s=null)):o||!1===n.trailing||(o=setTimeout(l,d)),r}}function N(t,e,n={isImmediate:!1,isTrailing:!1}){let i;return function(...s){const r=this,o=n.isImmediate&&void 0===i;void 0!==i&&clearTimeout(i),i=setTimeout((function(){i=void 0,n.isImmediate&&!n.isTrailing||t.apply(r,s)}),e),o&&t.apply(r,s)}}function k(t,e){try{return new URL(t,e)}catch(t){E(t)}return{href:t,pathname:t}}function C(t){const{title:e,content:n,titleColor:i,backgroundColor:s}=t,r=i||"#606060",o=s||"#1475b2",a=["%c ".concat(e," %c ").concat(n," "),"padding: 1px; border-radius: 3px 0 0 3px; color: #fff; background: ".concat(r,";"),"padding: 1px; border-radius: 0 3px 3px 0; color: #fff; background: ".concat(o,";")];console.log.apply(void 0,a)}function L(){console.log("%c\n______ _                _____       _   \n|_   _(_)              /  __ \\     | |  \n  | |  _ _ __ ___   ___| /  \\/ __ _| |_ \n  | | | | '_ ` _ \\ / _ \\ |    / _` | __|\n  | | | | | | | | |  __/ \\__/\\ (_| | |_ \n  \\_/ |_|_| |_| |_|\\___|\\____/\\__,_|\\__|\n    ","color: #1475b2;"),C({title:"version",content:v}),C({title:"more info",content:"github.com/oct16/timecat"})}const D=()=>{},P=()=>Promise.resolve(),M=["direction","fillStyle","filter","font","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","imageSmoothingQuality","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","strokeStyle","textAlign","textBaseline"],U=[...M,"arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createImageData","createLinearGradient","createPattern","createRadialGradient","drawFocusIfNeeded","drawImage","ellipse","fill","fillRect","fillText","getImageData","getLineDash","getTransform","isPointInPath","isPointInStroke","lineTo","measureText","moveTo","putImageData","quadraticCurveTo","rect","resetTransform","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeRect","strokeText","transform","translate"],F=["drawingBufferWidth","drawingBufferHeight","ACTIVE_ATTRIBUTES","ACTIVE_TEXTURE","ACTIVE_UNIFORMS","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","ALPHA","ALPHA_BITS","ALWAYS","ARRAY_BUFFER","ARRAY_BUFFER_BINDING","ATTACHED_SHADERS","BACK","BLEND","BLEND_COLOR","BLEND_DST_ALPHA","BLEND_DST_RGB","BLEND_EQUATION","BLEND_EQUATION_ALPHA","BLEND_EQUATION_RGB","BLEND_SRC_ALPHA","BLEND_SRC_RGB","BLUE_BITS","BOOL","BOOL_VEC2","BOOL_VEC3","BOOL_VEC4","BROWSER_DEFAULT_WEBGL","BUFFER_SIZE","BUFFER_USAGE","BYTE","CCW","CLAMP_TO_EDGE","COLOR_ATTACHMENT0","COLOR_BUFFER_BIT","COLOR_CLEAR_VALUE","COLOR_WRITEMASK","COMPILE_STATUS","COMPRESSED_TEXTURE_FORMATS","CONSTANT_ALPHA","CONSTANT_COLOR","CONTEXT_LOST_WEBGL","CULL_FACE","CULL_FACE_MODE","CURRENT_PROGRAM","CURRENT_VERTEX_ATTRIB","CW","DECR","DECR_WRAP","DELETE_STATUS","DEPTH_ATTACHMENT","DEPTH_BITS","DEPTH_BUFFER_BIT","DEPTH_CLEAR_VALUE","DEPTH_COMPONENT","DEPTH_COMPONENT16","DEPTH_FUNC","DEPTH_RANGE","DEPTH_STENCIL","DEPTH_STENCIL_ATTACHMENT","DEPTH_TEST","DEPTH_WRITEMASK","DITHER","DONT_CARE","DST_ALPHA","DST_COLOR","DYNAMIC_DRAW","ELEMENT_ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER_BINDING","EQUAL","FASTEST","FLOAT","FLOAT_MAT2","FLOAT_MAT3","FLOAT_MAT4","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","FRAGMENT_SHADER","FRAMEBUFFER","FRAMEBUFFER_ATTACHMENT_OBJECT_NAME","FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE","FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE","FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL","FRAMEBUFFER_BINDING","FRAMEBUFFER_COMPLETE","FRAMEBUFFER_INCOMPLETE_ATTACHMENT","FRAMEBUFFER_INCOMPLETE_DIMENSIONS","FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT","FRAMEBUFFER_UNSUPPORTED","FRONT","FRONT_AND_BACK","FRONT_FACE","FUNC_ADD","FUNC_REVERSE_SUBTRACT","FUNC_SUBTRACT","GENERATE_MIPMAP_HINT","GEQUAL","GREATER","GREEN_BITS","HIGH_FLOAT","HIGH_INT","IMPLEMENTATION_COLOR_READ_FORMAT","IMPLEMENTATION_COLOR_READ_TYPE","INCR","INCR_WRAP","INT","INT_VEC2","INT_VEC3","INT_VEC4","INVALID_ENUM","INVALID_FRAMEBUFFER_OPERATION","INVALID_OPERATION","INVALID_VALUE","INVERT","KEEP","LEQUAL","LESS","LINEAR","LINEAR_MIPMAP_LINEAR","LINEAR_MIPMAP_NEAREST","LINES","LINE_LOOP","LINE_STRIP","LINE_WIDTH","LINK_STATUS","LOW_FLOAT","LOW_INT","LUMINANCE","LUMINANCE_ALPHA","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","MEDIUM_FLOAT","MEDIUM_INT","MIRRORED_REPEAT","NEAREST","NEAREST_MIPMAP_LINEAR","NEAREST_MIPMAP_NEAREST","NEVER","NICEST","NONE","NOTEQUAL","NO_ERROR","ONE","ONE_MINUS_CONSTANT_ALPHA","ONE_MINUS_CONSTANT_COLOR","ONE_MINUS_DST_ALPHA","ONE_MINUS_DST_COLOR","ONE_MINUS_SRC_ALPHA","ONE_MINUS_SRC_COLOR","OUT_OF_MEMORY","PACK_ALIGNMENT","POINTS","POLYGON_OFFSET_FACTOR","POLYGON_OFFSET_FILL","POLYGON_OFFSET_UNITS","RED_BITS","RENDERBUFFER","RENDERBUFFER_ALPHA_SIZE","RENDERBUFFER_BINDING","RENDERBUFFER_BLUE_SIZE","RENDERBUFFER_DEPTH_SIZE","RENDERBUFFER_GREEN_SIZE","RENDERBUFFER_HEIGHT","RENDERBUFFER_INTERNAL_FORMAT","RENDERBUFFER_RED_SIZE","RENDERBUFFER_STENCIL_SIZE","RENDERBUFFER_WIDTH","RENDERER","REPEAT","REPLACE","RGB","RGB565","RGB5_A1","RGBA","RGBA4","SAMPLER_2D","SAMPLER_CUBE","SAMPLES","SAMPLE_ALPHA_TO_COVERAGE","SAMPLE_BUFFERS","SAMPLE_COVERAGE","SAMPLE_COVERAGE_INVERT","SAMPLE_COVERAGE_VALUE","SCISSOR_BOX","SCISSOR_TEST","SHADER_TYPE","SHADING_LANGUAGE_VERSION","SHORT","SRC_ALPHA","SRC_ALPHA_SATURATE","SRC_COLOR","STATIC_DRAW","STENCIL_ATTACHMENT","STENCIL_BACK_FAIL","STENCIL_BACK_FUNC","STENCIL_BACK_PASS_DEPTH_FAIL","STENCIL_BACK_PASS_DEPTH_PASS","STENCIL_BACK_REF","STENCIL_BACK_VALUE_MASK","STENCIL_BACK_WRITEMASK","STENCIL_BITS","STENCIL_BUFFER_BIT","STENCIL_CLEAR_VALUE","STENCIL_FAIL","STENCIL_FUNC","STENCIL_INDEX8","STENCIL_PASS_DEPTH_FAIL","STENCIL_PASS_DEPTH_PASS","STENCIL_REF","STENCIL_TEST","STENCIL_VALUE_MASK","STENCIL_WRITEMASK","STREAM_DRAW","SUBPIXEL_BITS","TEXTURE","TEXTURE0","TEXTURE1","TEXTURE10","TEXTURE11","TEXTURE12","TEXTURE13","TEXTURE14","TEXTURE15","TEXTURE16","TEXTURE17","TEXTURE18","TEXTURE19","TEXTURE2","TEXTURE20","TEXTURE21","TEXTURE22","TEXTURE23","TEXTURE24","TEXTURE25","TEXTURE26","TEXTURE27","TEXTURE28","TEXTURE29","TEXTURE3","TEXTURE30","TEXTURE31","TEXTURE4","TEXTURE5","TEXTURE6","TEXTURE7","TEXTURE8","TEXTURE9","TEXTURE_2D","TEXTURE_BINDING_2D","TEXTURE_BINDING_CUBE_MAP","TEXTURE_CUBE_MAP","TEXTURE_CUBE_MAP_NEGATIVE_X","TEXTURE_CUBE_MAP_NEGATIVE_Y","TEXTURE_CUBE_MAP_NEGATIVE_Z","TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_CUBE_MAP_POSITIVE_Y","TEXTURE_CUBE_MAP_POSITIVE_Z","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TRIANGLES","TRIANGLE_FAN","TRIANGLE_STRIP","UNPACK_ALIGNMENT","UNPACK_COLORSPACE_CONVERSION_WEBGL","UNPACK_FLIP_Y_WEBGL","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNSIGNED_BYTE","UNSIGNED_INT","UNSIGNED_SHORT","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","VALIDATE_STATUS","VENDOR","VERSION","VERTEX_ATTRIB_ARRAY_BUFFER_BINDING","VERTEX_ATTRIB_ARRAY_ENABLED","VERTEX_ATTRIB_ARRAY_NORMALIZED","VERTEX_ATTRIB_ARRAY_POINTER","VERTEX_ATTRIB_ARRAY_SIZE","VERTEX_ATTRIB_ARRAY_STRIDE","VERTEX_ATTRIB_ARRAY_TYPE","VERTEX_SHADER","VIEWPORT","ZERO","activeTexture","attachShader","bindAttribLocation","bindBuffer","bindFramebuffer","bindRenderbuffer","bindTexture","blendColor","blendEquation","blendEquationSeparate","blendFunc","blendFuncSeparate","bufferData","bufferSubData","checkFramebufferStatus","clear","clearColor","clearDepth","clearStencil","colorMask","compileShader","compressedTexImage2D","compressedTexSubImage2D","copyTexImage2D","copyTexSubImage2D","createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture","cullFace","deleteBuffer","deleteFramebuffer","deleteProgram","deleteRenderbuffer","deleteShader","deleteTexture","depthFunc","depthMask","depthRange","detachShader","disable","disableVertexAttribArray","drawArrays","drawElements","enable","enableVertexAttribArray","finish","flush","framebufferRenderbuffer","framebufferTexture2D","frontFace","generateMipmap","getActiveAttrib","getActiveUniform","getAttachedShaders","getAttribLocation","getBufferParameter","getContextAttributes","getError","getExtension","getFramebufferAttachmentParameter","getParameter","getProgramInfoLog","getProgramParameter","getRenderbufferParameter","getShaderInfoLog","getShaderParameter","getShaderPrecisionFormat","getShaderSource","getSupportedExtensions","getTexParameter","getUniform","getUniformLocation","getVertexAttrib","getVertexAttribOffset","hint","isBuffer","isContextLost","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture","lineWidth","linkProgram","makeXRCompatible","pixelStorei","polygonOffset","readPixels","renderbufferStorage","sampleCoverage","scissor","shaderSource","stencilFunc","stencilFuncSeparate","stencilMask","stencilMaskSeparate","stencilOp","stencilOpSeparate","texImage2D","texParameterf","texParameteri","texSubImage2D","uniform1f","uniform1fv","uniform1i","uniform1iv","uniform2f","uniform2fv","uniform2i","uniform2iv","uniform3f","uniform3fv","uniform3i","uniform3iv","uniform4f","uniform4fv","uniform4i","uniform4iv","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","useProgram","validateProgram","vertexAttrib1f","vertexAttrib1fv","vertexAttrib2f","vertexAttrib2fv","vertexAttrib3f","vertexAttrib3fv","vertexAttrib4f","vertexAttrib4fv","vertexAttribPointer","viewport"],B=()=>{var t;return(null===(t=window.G_REPLAY_DATA&&window.G_REPLAY_DATA.snapshot.data)||void 0===t?void 0:t.href)||location.href};function j(t){return t.nodeType===Node.ELEMENT_NODE}function H(t,e,n){return t.replace(/(url\(['"]?((\/{1,2}|\.\.?\/)?.*?)(^\?.*?)?['"]?(?=\)))/g,((t,i,s)=>{const r=k(s,e||B());return s.startsWith("data:")?t:t.replace(s,n?n(r.href):r.href)}))}function z(t,e){return t.startsWith("data")?t:(e&&setTimeout((()=>{const n=e.getRootNode().defaultView,{href:i,path:s}=(null==n?void 0:n.G_REPLAY_LOCATION)||{};if(s&&i){const n=k(s,i).href;e.getAttributeNames().filter((t=>~["src","href"].indexOf(t))).forEach((i=>{const s=k(t,n).href;e.getAttribute(i)!==s&&e.setAttribute(i,s)}))}})),k(t,B()).href)}function V(t){return t.ownerDocument&&!!t.ownerDocument.contains(t)}function G(t){return n(this,void 0,void 0,(function*(){if(!t)return!1;if(t.length>500)return!1;const e=z(t);if(function(t){try{new URL(t)}catch(t){return!1}return!0}(e))try{return yield W(e)}catch(t){return!1}return!1}))}function W(t){return n(this,void 0,void 0,(function*(){return yield fetch(t).then((t=>n(this,void 0,void 0,(function*(){return(yield t.text()).replace(/<\/script>/g,"<\\/script>")}))),(e=>(E(e),t)))}))}function X(t,e){return function(t,{channelCount:e,sampleBits:n,sampleRate:i}){const s=new ArrayBuffer(44+t.byteLength),r=!0,o=new DataView(s);Z(o,0,"RIFF"),o.setUint32(4,36+2*t.byteLength,r),Z(o,8,"WAVE"),Z(o,12,"fmt "),o.setUint32(16,16,r),o.setUint16(20,1,r),o.setUint16(22,e,r),o.setUint32(24,i,r),o.setUint32(28,i*e*(n/8),r),o.setUint16(32,e*(n/8),r),o.setUint16(34,n,r),Z(o,36,"data"),o.setUint32(40,t.byteLength,r);const a=t.byteLength;let l=44;for(let e=0;e<a;e++)o.setUint8(l,t.getUint8(e)),l++;return o}(function(t,e){const{sampleBits:n}=e,i=new DataView(new ArrayBuffer(t.length*(n/8)));let s=0;if(8===n)for(let e=0;e<t.length;e++,s++){const n=Math.max(-1,Math.min(1,t[e]));let r=n<0?128*n:127*n;r=+r+128,i.setInt8(s,r)}else for(let e=0;e<t.length;e++,s+=2){const n=Math.max(-1,Math.min(1,t[e]));i.setInt16(s,n<0?32768*n:32767*n,!0)}return i}(function(t){const e=new Float32Array(t.length*t[0].length);let n=0;for(let i=0;i<t.length;i++)e.set(t[i],n),n+=t[i].length;return e}(t),e),e)}function Z(t,e,n){const i=n.length;for(let s=0;s<i;s++)t.setUint8(e+s,n.charCodeAt(s))}function Y(t){return q(t.buffer)}function K(t){return new Float32Array($(t))}function q(t){let e="";const n=new Uint8Array(t),i=n.byteLength;for(let t=0;t<i;t++)e+=String.fromCharCode(n[t]);return btoa(e)}function $(t){const e=atob(t),n=e.length,i=new ArrayBuffer(n),s=new DataView(i);for(let t=0;t<n;t++)s.setUint8(t,e.charCodeAt(t));return i}class J{constructor(t,e=60){this.index=0,this.fps=e,this.animate=t}start(){let t=performance.now();const e=1e3/this.fps,n=i=>{this.requestID=requestAnimationFrame(n);const s=i-t;s>=e-.1&&(t=i-s%e,this.animate(s,this.index++))};this.requestID=requestAnimationFrame(n)}stop(){cancelAnimationFrame(this.requestID)}}const Q=[["type","type",{unique:!1}],["data","data",{unique:!1}],["relatedId","relatedId",{unique:!1}],["time","time",{unique:!1}]];var tt;!function(t){t[t.ADD=0]="ADD",t[t.DELETE=1]="DELETE",t[t.CLEAR=2]="CLEAR"}(tt||(tt={}));const et=new class extends class{constructor(t,e,n){this.DBName=t,this.version=e,this.storeName=n,this.init()}init(){return n(this,void 0,void 0,(function*(){this.dbResolve=this.initDB(),this.db=yield this.dbResolve}))}initDB(){const t=window.indexedDB.open(this.DBName,this.version);return t.onupgradeneeded=t=>{const e=t.target.result;if(!e.objectStoreNames.contains(this.storeName)){const t=e.createObjectStore(this.storeName,{autoIncrement:!0,keyPath:"id"});Q.forEach((e=>t.createIndex(...e)))}},new Promise(((e,n)=>{t.onsuccess=()=>{e(t.result)},t.onerror=()=>{const t="open indexedDB on error";E(t)&&n(t)}}))}getIDBObjectStore(t){const e=this.db.transaction(this.storeName,t);return e.onabort=e.onerror=()=>{E(e.error)},e.objectStore(this.storeName)}}{constructor(t,e,n){super(t,e,n),this.tasks=[],this.triggerTask=(()=>{let t=0;return()=>{if(this.db){let t=Promise.resolve();for(;this.tasks.length;){const e=this.tasks.shift();t=t.then((()=>this.execTask(e)))}}else clearInterval(t),t=window.setTimeout((()=>this.triggerTask()),0)}})()}add(t){this.addTask(tt.ADD,t)}delete(t){this.addTask(tt.DELETE,t)}clear(){this.addTask(tt.CLEAR)}count(){return n(this,void 0,void 0,(function*(){const t=this.getIDBObjectStore(o.READONLY);return new Promise((e=>{t.count().onsuccess=t=>{e(t.target.result)}}))}))}last(){return n(this,void 0,void 0,(function*(){const t=this.getIDBObjectStore(o.READONLY);return new Promise(((e,n)=>{const i=t.openKeyCursor(null,"prev");i.onsuccess=()=>{const s=i.result;if(!s)return n("DB is empty");const r=t.get(s.key);r.onsuccess=()=>{e(r.result)}}}))}))}readAll(t){return n(this,void 0,void 0,(function*(){const{limit:e}=t||{};yield this.dbResolve;const n=this.getIDBObjectStore(o.READONLY),i=[];return new Promise((t=>{n.openCursor().onsuccess=n=>{const s=n.target.result;return e&&i.length>=e?t(i):s?(i.push(s.value),void s.continue()):void t(i)}})).then((t=>t.length?t:null))}))}execTask(t){switch(t.type){case tt.ADD:return this.execAddTask(t.data);case tt.DELETE:return this.execDeleteTask(t.data);case tt.CLEAR:return this.execClearTask();default:return Promise.resolve()}}addTask(t,e){this.tasks.push({type:t,data:e}),this.triggerTask()}execAddTask(t){return n(this,void 0,void 0,(function*(){this.getIDBObjectStore(o.READWRITE).add(t)}))}execDeleteTask(t){return n(this,void 0,void 0,(function*(){const{lowerBound:e,upperBound:n}=t||{};if(e&&n){const t=IDBKeyRange.bound(e,n);this.getIDBObjectStore(o.READWRITE).delete(t)}else E("Options lowerBound and upperBound is required")}))}execClearTask(){return n(this,void 0,void 0,(function*(){this.getIDBObjectStore(o.READWRITE).clear()}))}}("cat_db",1,"cat_data");class nt{constructor(){this.createNodeId=()=>nt.nodeId++,this.init()}init(){this.nodeMap=new Map,this.idMap=new WeakMap}reset(){this.nodeMap.clear()}getNode(t){return this.nodeMap.get(t)||null}addNode(t,e=this.createNodeId()){return this.idMap.set(t,e),this.nodeMap.set(e,t),e}removeNode(t){this.nodeMap.delete(t),this.idMap.delete(this.getNode(t))}getNodeId(t){return this.idMap.get(t)}updateNode(t,e){this.idMap.set(e,t),this.nodeMap.set(t,e)}}nt.nodeId=1;const it=new nt,st=(t,e={})=>j(t)?{id:e.id||it.createNodeId(),type:t.nodeType,attrs:rt(t),tag:t.tagName.toLocaleLowerCase(),children:[],extra:ot(t,e.isSVG)}:{id:e.id||it.createNodeId(),type:t.nodeType,value:t.textContent},rt=t=>{const e={},{attributes:n}=t;return n&&n.length?Object.values(n).reduce(((t,e)=>{const[n,i]=at(e);return n&&(t[n]=i),t}),e):e};function ot(t,e){var n,i;const{tagName:s}=t,r={},o={};if(e||"svg"===s.toLowerCase())r.isSVG=!0;else if("INPUT"===s){const{checked:e,value:n}=t;void 0!==n&&(o.value=n),void 0!==e&&(o.checked=e)}else if("OPTION"===s){const{selected:e}=t;!0===e&&(o.selected=!0)}else if("STYLE"===s){const e=null===(i=null===(n=t)||void 0===n?void 0:n.sheet)||void 0===i?void 0:i.rules;if(e&&e.length){const t=Array.from(e).map((t=>t.cssText)).join(" ");o.textContent=H(t)}}else"VIDEO"===s&&(o.autoplay=!1,o.controls=!1,o.loop=!1,o.muted=!0);const a=t.scrollLeft,l=t.scrollTop;return(l||a)&&(o.scroll={left:a,top:l}),Object.keys(o).length&&(r.props=o),r}const at=t=>{const{name:e,value:n}=t;return("href"===e||"src"===e)&&n.startsWith("#/")?[]:[e,n]},lt=(t,e)=>{var n,i,s;const r=st(t,{isSVG:e}),{id:o}=r;if(it.addNode(t,o),null===(s=null===(i=null===(n=r)||void 0===n?void 0:n.extra)||void 0===i?void 0:i.props)||void 0===s?void 0:s.textContent)return r;if(r.type===Node.ELEMENT_NODE){const n=r;e=e||n.extra.isSVG,t.childNodes.forEach((t=>{const i=lt(t,e);i&&n.children.push(i)}))}return r},ct=["VIDEO","IFRAME"];function dt(t,e,n){if(t.nodeType===Node.ELEMENT_NODE)if("style"!==e){if(!("src"===e&&~ct.indexOf(t.tagName)||n&&"string"==typeof n&&/\.js$/.test(n)||/^\d+/.test(e)||/^on\w+$/.test(e))){if(null===n)return t.removeAttribute(e);if(n=String(n),"href"===e&&(n=z(String(n),t)),"background"!==e&&"src"!==e||n.startsWith("data:")||(n=z(String(n),t)),"srcset"===e){const e=n.split(",");n=e.map((e=>{const[n,i]=e.trim().split(" ");return n&&i?`${z(n,t)} ${i}`:n?z(n,t):""})).join(", "),n=decodeURIComponent(n)}n.startsWith("/")&&(n=z(n,t));try{t.setAttribute(e,n)}catch(t){E(t)}}}else if("string"==typeof n)t.style.cssText=H(n);else if(null!==n&&"object"==typeof n)for(const[e,i]of Object.entries(n))"-"===e[0]?t.style.setProperty(e,i):t.style[e]=i}function ht(t,e){if(null==t)return null;const n=t;if(t.type===Node.COMMENT_NODE)return function(t){const{value:e,id:n}=t,i=document.createComment(e);return it.updateNode(n,i),i}(n);if(t.type===Node.TEXT_NODE){if(e&&"style"===e.tag){n.value=H(n.value,null==e?void 0:e.attrs["css-url"])}return function(t){const{value:e,id:n}=t,i=document.createTextNode(e);return it.updateNode(n,i),i}(n)}const i=t,s=function(t){const{id:e,extra:n}=t,{isSVG:i}=n;let s;const r=(o=t.tag,{script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointLight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",lineargradient:"linearGradient",radialgradient:"radialGradient",textpath:"textPath"}[o]||o);var o;s=i?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);return function(t,e){const n=function(t){return Object.assign({},t.attrs)}(t);for(const[t,i]of Object.entries(n))dt(e,t,i);"a"===t.tag&&e.setAttribute("target","_blank")}(t,s),function(t,e){const{props:n}=t.extra;if(n)for(const[t,i]of Object.entries(n))if("scroll"===t){const{left:t,top:n}=i;setTimeout((()=>{e.scrollTop=n,e.scrollLeft=t}),1e3)}else e[t]=i}(t,s),it.updateNode(e,s),s}(i);return(i.children&&i.children.length||s.childNodes&&s.childNodes.length)&&function(t,e){const n=[];t.children.slice().forEach((i=>{let s=n.pop();s=ht(i,t),s&&(function(t){return!!t&&t.nodeType===Node.COMMENT_NODE&&"hidden"===t.textContent}(e.lastChild)&&dt(s,"style","visibility: hidden"),e.appendChild(s))}))}(i,s),s}class ut{constructor(t){this.getNode=t=>it.getNode.call(it,t),this.getNodeId=t=>it.getNodeId.call(it,t);const{emit:e,context:n,relatedId:i,recorder:s}=t;this.options=t,this.recorder=s,this.relatedId=i,this.context=n,this.recordOptions=n.G_RECORD_OPTIONS||window.G_RECORD_OPTIONS||{},this.emit=e,this.init(t)}init(t){}uninstall(t){this.options.listenStore.add(t)}emitData(t,e,n=w(),i){const s={type:t,data:e,relatedId:this.relatedId,time:n};if(i)return this.emit(i(s));this.emit(s)}registerEvent(t){const{context:e,eventTypes:n,handleFn:i,listenerOptions:s,type:r,optimizeOptions:o,waitTime:a}=t;let l;l="throttle"===r?O(i,a,o):N(i,a,o),n.map((t=>n=>{e.addEventListener(t,n,s)})).forEach((t=>t(l))),this.uninstall((()=>{n.forEach((t=>{e.removeEventListener(t,l,s)}))}))}}const pt="https://timecatjs.com/all-origins?url=";function ft(t,e,i){if(!e)return;const{rewriteConfigs:s,preFetchConfigs:r}=e.reduce(((t,e)=>("preFetch"===e.type?t.preFetchConfigs.push(e):t.rewriteConfigs.push(e),t)),{rewriteConfigs:[],preFetchConfigs:[]});if(s.some((t=>{const{matches:e,rewrite:n}=t,{replaceOrigin:i}=n;return!i||!e})))return E("The params replaceOrigin and matches is required for using rewriteResource");function o(t,e){return n=>{const{href:i,src:s}=t.attrs;Object.entries({href:i,src:s}).filter((([,t])=>{if(t)return e.some((e=>"string"==typeof e?t.endsWith("."+e):e.test(t)))})).forEach((e=>n(t,...e)))}}s.forEach((e=>{const{rewrite:n,matches:i}=e,{replaceOrigin:s,folderPath:r,fn:a}=n,[l]=document.getElementsByTagName("base"),c=window.location.href,d=(t,e,n)=>{const i=t.attrs,o=k(n,(null==l?void 0:l.href)||c),d=o.href,h=mt(s,r||"",o.pathname),u=a&&a(d,h)||h;i[e]=u};t.forEach((t=>o(t,i)(d)))})),r.forEach((e=>{const{rewrite:s,matches:r}=e;if(!r.filter((t=>"string"==typeof t)).every((t=>t.endsWith("css"))))return E("PreFetch Resource only support [css] currently");const{replaceOrigin:a,folderPath:l,crossUrl:c,fn:d,matches:h}=s,[u]=document.getElementsByTagName("base"),p=window.location.href,f=(t,e,s)=>n(this,void 0,void 0,(function*(){const n=k(s,(null==u?void 0:u.href)||p),r=yield fetch(n.href).then((t=>t.text()),(()=>"")).catch((t=>function(t){const e=t.message||t;return console.warn(`TimeCat Warning: ${e}`),e}(t)));if(!r)return;const o=H(r,n.href,(t=>{if(!h)return t;let e;const n=k(t,(null==u?void 0:u.href)||p);return h.some((e=>"string"==typeof e?n.pathname.endsWith("."+e):e.test(t)))?(e=a&&l?mt(a,l||"",n.pathname):function(t,e){const n=encodeURIComponent(t);let i;i=e&&"string"==typeof e?~e.indexOf("<$url>")?e.replace("<$url>",n):e+n:pt+n;return i}(t,c),d&&d(t,e)||e):t})),f={id:t.id,tag:t.tag,key:e,time:w(),url:n.href,text:o};i(f)}));t.forEach((t=>o(t,r)(f)))}))}function mt(...t){if(!t.length)return"";if(1===t.length)return t[0];function e(t){return t.endsWith("/")?t.substring(0,t.length-1):t}return t.reduce(((t,n)=>{if(!t){if(!n.startsWith("http"))throw new Error("path error");return e(n)}return t+(n?"/"+function(t){return t.startsWith("/")?t.substring(1):t}(e(n)):"")}),"")}var gt,_t;!function(t){t.add="add",t.rm="rm"}(gt||(gt={})),function(t){t.replaceState="replaceState",t.pushState="pushState",t.popstate="popstate",t.hashchange="hashchange"}(_t||(_t={}));class yt extends ut{constructor(){super(...arguments),this.locationHandle=e=>{var n,i;const s=this.getContextNodeId(e),[,,r]=e.arguments||[,,null===(i=null===(n=this.context)||void 0===n?void 0:n.location)||void 0===i?void 0:i.pathname],[o]=this.context.document.body.getElementsByTagName("base"),{href:a,hash:l}=this.context.location,c=document.title;this.emitData(t.RecordType.LOCATION,{contextNodeId:s,href:(null==o?void 0:o.href)||a,hash:l,path:r,title:c})},this.emitOne=()=>this.locationHandle({target:window})}init(){this.context.history.pushState=this.kidnapLocation(_t.pushState),this.context.history.replaceState=this.kidnapLocation(_t.replaceState);const t=Object.values(_t);t.forEach((t=>this.toggleListener(gt.add,t,this.locationHandle))),this.uninstall((()=>{t.forEach((t=>this.toggleListener(gt.rm,t,this.locationHandle)))}))}toggleListener(t,e,n){this.context[t===gt.add?"addEventListener":"removeEventListener"](e,n)}kidnapLocation(t){const e=this.context,n=e.history[t];return function(){const i=n.apply(this,arguments),s=new Event(t);return s.arguments=arguments,e.dispatchEvent(s),i}}getContextNodeId(t){return this.getNodeId(t.target.document.documentElement)}}function bt(t){const e=Object.create(null),n=Object.create(null);return function(i,s,r){if(e[i]||(e[i]=[]),t.blockInstances.some((t=>r instanceof t))||e[i].push({name:s,args:r}),!n[i]){const s=window.setTimeout((()=>{!function(i){clearTimeout(n[i]),n[i]=0;const s=e[i].slice();e[i].length=0,t.fn.call(this,i,s)}(i)}),t.wait);n[i]=s}}}function vt(t,e){const n=t;if(!n.typeWatchers){n.typeWatchers=[];const t=n.getContext;n.getContext=function(e,i){return n.getContext=t,n.typeWatchers.forEach((t=>t.call(this,e,i))),n.typeWatchers.length=0,delete n.typeWatchers,t.apply(this,arguments)}}n.typeWatchers.push(e)}function Et(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.toDataURL()===e.toDataURL()}const wt=[];function Tt(t){wt.push(t);const e=document.createElement;e.toString().indexOf("[native code]")>-1&&(this.uninstall((()=>{document.createElement=e})),document.createElement=function(t,n){const i=e.call(this,t,n);return!1!==n&&wt.forEach((t=>t(i))),i})}function xt(t){Tt.call(this,(e=>{"CANVAS"===e.tagName&&t(e)}))}function At(){wt.length=0}const Rt=new WeakMap;const St=[WebGLActiveInfo,WebGLBuffer,WebGLFramebuffer,WebGLProgram,WebGLRenderbuffer,WebGLShader,WebGLShaderPrecisionFormat,WebGLTexture,WebGLUniformLocation],It=new WeakMap;const Ot={DOMWatcher:class extends ut{init(){const t=new MutationObserver((t=>this.mutationCallback(t)));t.observe(this.context.document.documentElement,{attributeOldValue:!0,attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),this.uninstall((()=>t.disconnect()))}mutationCallback(e){const n=new Set,i=new Map,s=new Set,r=new Set,o=[],a=new Set,l=this;function c(t,e){const o=l.getNodeId(t);if(o){if(e){s.add(t),i.delete(t);const n=l.getNodeId(e);n&&r.add(n+"@"+o)}}else n.add(t);t.childNodes.forEach((t=>c(t)))}function d(t,e){t.delete(e),e.childNodes.forEach((e=>{d(t,e)}))}e.forEach((t=>{const{target:e,addedNodes:h,removedNodes:u,type:p,attributeName:f,oldValue:m}=t;switch(p){case"attributes":o.push({key:f,node:e,oldValue:m});break;case"characterData":a.add(e);break;case"childList":h.forEach((t=>c(t,e))),u.forEach((t=>function(t,e){if(!t)return;const o=l.getNodeId(t),a=l.getNodeId(t.parentNode);n.has(t)?(d(n,t),i.set(t,e)):s.has(t)&&r.has(a+"@"+o)?(d(s,t),r.delete(a+"@"+o)):i.set(t,e)}(t,e)))}}));const h=[],u=new Map;n.forEach((t=>{const e=this.getNodeId(t.parentNode),n=it.getNodeId(t),i=n?st(t,{id:n}):((t,e=!1)=>{const n=st(t,{isSVG:e}),{id:i}=n;return it.addNode(t,i),n})(t);if(S(i)){t.constructor.name.startsWith("SVG")&&(i.extra.isSVG=!0)}h.push({parentId:e,nextId:this.getNodeId(t.nextSibling)||null,node:i}),S(i)&&u.set(i.id,i)}));const p=[];s.forEach((t=>{const e=this.getNodeId(t);p.push({parentId:this.getNodeId(t.parentNode),nextId:this.getNodeId(t.nextSibling)||null,id:e})}));const f=[];i.forEach(((t,e)=>{const n=this.getNodeId(e),i=this.getNodeId(t);n&&i&&f.push({parentId:i,id:n})}));const m=o.map((t=>{const{node:e,key:n,oldValue:i}=t;if(V(e)){const t=e.getAttribute(n);if(i===t)return null;const s=this.getNodeId(e);return"IFRAME"===e.tagName&&"src"===n&&this.waitAndRecordIFrame(e),{id:s,key:n,value:t}}})).filter(Boolean),g=[...a].map((t=>{if(V(t)&&t.parentNode)return{id:this.getNodeId(t),parentId:this.getNodeId(t.parentNode),value:t.textContent}})).filter(Boolean),_={addedNodes:h,movedNodes:p,removedNodes:f,attrs:m,texts:g};Object.keys(_).forEach((t=>{_[t].length||delete _[t]}));const y=w();_.addedNodes&&(this.watchIFrames(h),this.rewriteAddedSource(h,y)),Object.values(_).some((t=>t.length))&&this.emitData(t.RecordType.DOM,_,y)}waitAndRecordIFrame(t){var e,n;const i=t.contentWindow;null===(n=null===(e=t)||void 0===e?void 0:e.frameRecorder)||void 0===n||n.destroy();const s=()=>{this.recorder.recordIFrame(i),t.removeEventListener("load",s)};t.addEventListener("load",s)}findElementsByTag(t,e){return e.filter((e=>e.node.tag===t))}watchIFrames(t){const e=this.findElementsByTag("iframe",t);e.length&&e.map((t=>it.getNode(t.node.id))).filter(Boolean).map((t=>t.contentWindow)).forEach((t=>this.recorder.recordIFrame(t)))}rewriteAddedSource(e,n){const{G_RECORD_OPTIONS:i}=window,s=(null==i?void 0:i.rewriteResource)||[];if(!(null==s?void 0:s.length))return;ft(e.map((t=>t.node)).filter((t=>S(t)&&t)),s,(e=>this.emitData(t.RecordType.PATCH,e,n+1)))}},FormElementWatcher:class extends ut{init(){this.listenInputs(this.options),this.hijackInputs(this.options)}listenInputs(e){const{context:n}=e;let i;!function(t){t.input="input",t.change="change",t.focus="focus",t.blur="blur"}(i||(i={}));const r={once:!1,passive:!0,capture:!0};function o(e){const n=e.type;let r;switch(n){case i.input:case i.change:const t=e.target,o=t.getAttribute("type")||"text";let a="value";const l=t.value||"";let c="";const d=[];if("checkbox"===o||"radio"===o){if("input"===n)return;a="checked",c=t.checked}else{if(l===t.oldValue)return;l.length<=20||!t.oldValue?c=l:d.push(...I(t.oldValue,l)),t.oldValue=l}r={type:"input"===n?s.INPUT:s.CHANGE,id:this.getNodeId(e.target),key:a,value:d.length?null:c,patches:d};break;case i.focus:r={type:s.FOCUS,id:this.getNodeId(e.target)};break;case i.blur:r={type:s.BLUR,id:this.getNodeId(e.target)}}this.emitData(t.RecordType.FORM_EL,r)}Object.values(i).map((t=>e=>{n.addEventListener(t,e,r),this.uninstall((()=>n.removeEventListener(t,e,r)))})).forEach((t=>t(o.bind(this))))}hijackInputs(e){const{context:n}=e,i=this;function r(e,n){const r={type:s.PROP,id:i.getNodeId(this),key:e,value:n};i.emitData(t.RecordType.FORM_EL,r)}const o=(t,e)=>{const i=n.Object.getOwnPropertyDescriptor(e,t);n.Object.defineProperty(e,t,{set:function(e){setTimeout((()=>{r.call(this,t,e)})),i&&i.set&&i.set.call(this,e)}}),this.uninstall((()=>{i&&n.Object.defineProperty(e,t,i)}))};new Map([[n.HTMLSelectElement.prototype,"value"],[n.HTMLTextAreaElement.prototype,"value"],[n.HTMLOptionElement.prototype,"selected"]]).forEach(o.bind(this)),new Map([["value",n.HTMLInputElement.prototype],["checked",n.HTMLInputElement.prototype]]).forEach(((t,e)=>o(e,t)))}},MouseWatcher:class extends ut{init(){this.mouseMove(),this.mouseClick(),this.detectScrolling()}detectScrolling(){let t;const e=()=>{this.scrolling=!0,clearTimeout(t),t=this.context.setTimeout((()=>{this.scrolling=!1,this.latestMove&&(this.sendMoveData(this.latestMove),this.latestMove=null)}),500)};["mousewheel","scroll"].forEach((t=>{this.context.addEventListener(t,e,!0),this.uninstall((()=>{this.context.removeEventListener(t,e,!0)}))}))}sendMoveData(e){const{x:n,y:i,id:s}=e;this.emitData(t.RecordType.MOUSE,{type:r.MOVE,id:s,x:n,y:i})}mouseMove(){const t="mousemove",e=O((t=>{const e=this.getOffsetPosition(t,this.context);this.scrolling?this.latestMove=e:e&&this.sendMoveData(e)}),300,{trailing:!0,leading:!0});this.context.addEventListener(t,e),this.uninstall((()=>{this.context.removeEventListener(t,e)}))}mouseClick(){const e="click",n=O((e=>{const n=this.getOffsetPosition(e,this.context);n&&this.emitData(t.RecordType.MOUSE,Object.assign({type:r.CLICK},n))}),250);this.uninstall((()=>{this.context.removeEventListener(e,n)})),this.context.addEventListener(e,n)}getOffsetPosition(t,e){var n;const{mode:i}=e.G_RECORD_OPTIONS,{view:s,target:r,offsetX:o,offsetY:a}=t;if(s===e){const t=r.ownerDocument;function l(t){return"inline"===e.getComputedStyle(t).display}let s,c=r;if(V(c)){for(;l(c);)c=c.parentElement;s=this.getNodeId(c)}let d;if(function(t){if(!V(t))return 0;const n=e.getComputedStyle(t).transform;let i;if("none"!==n){const t=n.split("(")[1].split(")")[0].split(","),e=Number(t[0]),s=Number(t[1]);i=Math.round(Math.atan2(s,e)*(180/Math.PI))}else i=0;return i<0?i+360:i}(c)||!s)return null;d={id:s,x:o,y:a};const h=null===(n=null==t?void 0:t.defaultView)||void 0===n?void 0:n.frameElement;if(h&&"default"===i){const t=h.getBoundingClientRect();d.y+=t.top,d.x+=t.left}return d}return!1}},ScrollWatcher:class extends ut{getCompatibleTarget(t){return t.scrollingElement||t.documentElement}scrollTop(t){return t.scrollTop}scrollLeft(t){return t.scrollLeft}init(){const{scrollingElement:t}=this.context.document;this.emitData(...this.wrapData(t||document,!0)),this.registerEvent({context:this.context,eventTypes:["scroll"],handleFn:this.handleFn.bind(this),listenerOptions:{capture:!0},type:"throttle",optimizeOptions:{leading:!0,trailing:!0},waitTime:300})}wrapData(e,n=!1){const i=e instanceof this.context.HTMLElement?e:this.getCompatibleTarget(e),s={id:this.getNodeId(i)||null,top:this.scrollTop(i),left:this.scrollLeft(i)};return n&&(s.behavior="auto"),[t.RecordType.SCROLL,s]}handleFn(t){const{type:e,target:n}=t;"scroll"===e&&this.emitData(...this.wrapData(n))}}},Nt=Object.assign(Object.assign({LocationWatcher:yt},Ot),{WindowWatcher:class extends ut{width(){return this.context.innerWidth}height(){return this.context.innerHeight}init(){this.emitData(...this.wrapData(null)),this.registerEvent({context:this.context,eventTypes:["resize"],handleFn:this.handleFn.bind(this),listenerOptions:{capture:!0},type:"throttle",optimizeOptions:{trailing:!0},waitTime:500})}handleFn(t){const{type:e,target:n}=t;let i=null;if(n&&n instanceof HTMLElement){if(n.constructor.name===HTMLVideoElement.name)return;i=this.getNodeId(n)}"resize"===e&&this.emitData(...this.wrapData(i))}wrapData(e){return[t.RecordType.WINDOW,{id:e,width:this.width(),height:this.height()}]}},CanvasSnapshotWatcher:class extends ut{init(){const t=document.getElementsByTagName("canvas");Array.from(t).forEach((t=>{this.snapshotCanvas(t)}))}snapshotCanvas(e){if(Et(e))return;const n=e.toDataURL();this.emitData(t.RecordType.CANVAS_SNAPSHOT,{id:this.getNodeId(e),src:n})}},Canvas2DWatcher:class extends ut{constructor(){super(...arguments),this.aggregateDataEmitter=this.strokesManager(((e,n)=>{this.emitData(t.RecordType.CANVAS,{id:e,strokes:n})}))}getCanvasInitState(t){return Object.values(M).reduce(((e,n)=>Object.assign(Object.assign({},e),{[n]:t[n]})),{})}init(){this.watchCreatedCanvas(),this.watchCreatingCanvas()}watchCreatedCanvas(){const t=document.getElementsByTagName("canvas");Array.from(t).forEach((t=>{Et(t)?vt(t,(e=>{"2d"===e&&this.watchCanvas(t)})):this.watchCanvas(t)}))}watchCreatingCanvas(){xt.call(this,(t=>{vt(t,(e=>{"2d"===e&&this.watchCanvas(t)}))})),this.uninstall((()=>At()))}watchCanvas(e){const n=this,i=CanvasRenderingContext2D.prototype,s=U,r=e.getContext("2d");if(!r)return;if(Rt.get(e))return;this.emitData(t.RecordType.CANVAS,{id:this.getNodeId(r.canvas),status:this.getCanvasInitState(r)});const o={};s.forEach((t=>{const e=Object.getOwnPropertyDescriptor(i,t),s=e.value;o[t]=r[t];const a=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(r,t,{get(){const e=this,i=n.getNodeId(this.canvas);return"function"==typeof s?function(){var r;const o=[...arguments];if("createPattern"===t)o[0]=i;else if("drawImage"===t){const t=null===(r=o[0])||void 0===r?void 0:r.constructor.name;if("HTMLCanvasElement"===t){const t=o[0].toDataURL();o[0]=t}else if("HTMLImageElement"===t){const t=o[0];t.setAttribute("crossorigin","anonymous");const e=document.createElement("canvas",!1);e.width=t.width,e.height=t.height;e.getContext("2d").drawImage(t,0,0,t.width,t.height),o[0]=e.toDataURL()}}return n.aggregateDataEmitter(i,t,o),s.apply(e,arguments)}:o[t]},set:function(i){var s;const r=n.getNodeId(this.canvas);return"function"!=typeof i&&n.aggregateDataEmitter(r,t,i),o[t]=i,null===(s=e.set)||void 0===s?void 0:s.apply(this,arguments)},configurable:!0}),this.uninstall((()=>{Object.defineProperty(r,t,a||e)}))})),Rt.set(e,!0),this.uninstall((()=>{Rt.set(e,!1)}))}strokesManager(t,e=30){const n=Object.create(null),i=Object.create(null),s=[CanvasGradient,CanvasPattern];return function(r,o,a){if(!r)return;const l=it.getNode(r);if(!l)return;const c=this,d=U.indexOf("clearRect");if(n[r]||(n[r]=[]),!s.some((t=>a instanceof t))){const t=U.indexOf(o);n[r].push({name:t,args:a})}if(!i[r]){const s=window.setTimeout((()=>{(e=>{clearTimeout(i[e]),i[e]=0;const s=n[e].slice(),{width:r,height:o}=l.getBoundingClientRect(),a=s.reverse().findIndex((t=>{if(t.name===d){const e=t.args;if(0===e[0]&&0===e[1]&&e[2]===r&&e[3]===o)return!0}})),h=~a?s.slice(0,a+1).reverse():s.reverse();t.call(c,e,h),n[e].length=0})(r)}),e);i[r]=s}}}},CanvasWebGLWatcher:class extends ut{constructor(){super(...arguments),this.GLVars=Object.create(null),this.emitStroke=bt({keys:F,wait:20,blockInstances:[],fn:(e,n)=>{n=this.parseArgs(n),this.emitData(t.RecordType.WEBGL,{id:e,args:n})}})}init(){this.patchWebGLProto(WebGLRenderingContext.prototype),void 0!==window.WebGL2RenderingContext&&this.patchWebGLProto(WebGL2RenderingContext.prototype)}patchWebGLProto(t){Object.getOwnPropertyNames(t).forEach((e=>{"canvas"!==e&&"constructor"!==e&&void 0===t.__lookupGetter__(e)&&"function"==typeof t[e]&&this.patchProtoFunc(t,e)}))}patchProtoFunc(t,e){const n=t[e],i=this;if("isPatch"in n)return;const s=function(){const t=n.apply(this,arguments),s=[...arguments];return setTimeout((()=>{const t=this.canvas,n=i.getNodeId(t)||it.addNode(t);i.emitStroke(n,e,s)})),t};s.isPatch=!0,t[e]=s,this.uninstall((()=>{delete s.isPatch,t[e]=n}))}watchCreatedCanvas(){const t=document.getElementsByTagName("canvas");Array.from(t).forEach((t=>{Et(t)&&vt(t,(e=>{"webgl"!==e&&"experimental-webgl"!==e||this.watchCanvas(t)}))}))}watchCreatingCanvas(){xt.call(this,(t=>{vt(t,(e=>{"webgl"!==e&&"experimental-webgl"!==e||this.watchCanvas(t)}))})),this.uninstall((()=>At()))}watchCanvas(t){const e=this,n=WebGLRenderingContext.prototype,i=t.getContext("webgl")||t.getContext("experimental-webgl");if(!i)return;if(It.get(t))return;const s={};for(const r in i){const o=r;if("canvas"===o)continue;if("drawingBufferHeight"===r||"drawingBufferWidth"===r)continue;const a=Object.getOwnPropertyDescriptor(n,o),l=a.value;s[o]=l;const c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(i,o,{get(){const n=this;return"function"==typeof l?function(){const i=[...arguments];return setTimeout((()=>{const s=e.getNodeId(n.canvas)||it.addNode(t);e.emitStroke(s,o,i)})),l.apply(n,arguments)}:s[o]},set:function(n){var i;return setTimeout((()=>{const i=e.getNodeId(this.canvas)||it.addNode(t);"function"!=typeof n&&this.emitStroke(i,o,n)})),s[o]=n,null===(i=a.set)||void 0===i?void 0:i.apply(this,arguments)},configurable:!0}),this.uninstall((()=>{Object.defineProperty(i,o,c||a)}))}It.set(t,!0),this.uninstall((()=>{It.set(t,!1)}))}parseArgs(t){return t.map((({name:t,args:e})=>({name:t,args:e.map((t=>this.getWebGLVariable(t)))})))}getWebGLVariable(t){if(ArrayBuffer.isView(t))return"$f32arr"+Array.prototype.slice.call(t);if(t instanceof Array)return"$arr"+Array.prototype.slice.call(t);if(t instanceof HTMLImageElement)return"$src@"+t.src;if(St.some((e=>t instanceof e))||"object"==typeof t&&null!==t||t&&"WebGLVertexArrayObjectOES"===t.constructor.name){const e=t.constructor.name,n=this.GLVars[e]||(this.GLVars[e]=[]);let i=n.indexOf(t);return~i||(i=n.length,n.push(t)),"$"+e+"@"+i}return t}},FontWatcher:class extends ut{init(){this.recordOptions.font&&this.interceptAddFont()}interceptAddFont(){const e=window.FontFace,n=this;window.FontFace=function(i,s){const r=new e(i,s);n.emitData(t.RecordType.FONT,{family:i,source:"string"==typeof s?s:function(t){const e=new Uint16Array(t),n=e.byteLength;let i=Math.pow(2,16)-1,s="";for(let t=0;t<n;t+=i)t+i>n&&(i=n-t),s+=String.fromCharCode.apply(null,e.subarray(t,t+i));return s}(s)}),document.fonts.add(r)},this.uninstall((()=>{window.FontFace=e}))}},TerminateWatcher:class extends ut{init(){this.context.addEventListener("beforeunload",this.handleFn),this.uninstall((()=>{this.context.removeEventListener("beforeunload",this.handleFn)}))}handleFn(){}wrapData(){return[t.RecordType.TERMINATE,null]}}});class kt{constructor(t=kt.defaultRecordOptions){this.setOptions(t)}getOptions(){return this.opts}setOptions(t=kt.defaultRecordOptions){this.opts=Object.assign(Object.assign({},this.opts),t)}beginRecord(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:this.opts.sampleRate}),this.mediaNode=this.audioContext.createMediaStreamSource(this.mediaStream);this.processNode=this.audioContext.createScriptProcessor.call(this.audioContext,4096,this.opts.channelCount,this.opts.channelCount),this.processNode.connect(this.audioContext.destination),this.processNode.onaudioprocess=function(t){const e=t.inputBuffer.getChannelData(0).slice();if(this.onProgress){const t=[Y(e)];this.onProgress(t)}}.bind(this),this.mediaNode.connect(this.processNode)}initRecorder(){return n(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{window.navigator.mediaDevices.getUserMedia({audio:{sampleRate:this.opts.sampleRate,channelCount:this.opts.channelCount,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!1,latency:0}}).then((e=>t(e))).catch((t=>e(t)))}))}))}start(t=kt.defaultRecordOptions){return n(this,void 0,void 0,(function*(){this.setOptions(t),this.mediaStream=yield this.initRecorder(),this.mediaStream&&this.beginRecord()}))}stop(){this.mediaStream&&this.mediaStream.getAudioTracks()[0].stop(),this.processNode&&this.processNode.disconnect(),this.mediaNode&&this.mediaNode.disconnect()}pause(){}resume(){}}kt.defaultRecordOptions={sampleBits:8,sampleRate:48e3,channelCount:1};class Ct extends ut{constructor(t){super(t)}init(){const e=new kt({sampleBits:8,sampleRate:8e3,channelCount:1});e.start(),this.uninstall((()=>{e.stop()})),this.emitData(t.RecordType.AUDIO,{type:"opts",data:e.getOptions()}),e.onProgress=e=>{this.emitData(t.RecordType.AUDIO,{encode:"base64",type:"pcm",data:e})}}}class Lt extends ut{init(){const e=this.DOMSnapshotData(this.options.context||window),n=w();this.checkNodesData(e,n),this.emitData(t.RecordType.SNAPSHOT,e,n)}DOMSnapshotData(t){return Object.assign({vNode:lt(t.document.documentElement)},this.getInitInfo(t))}getInitInfo(t){const{name:e,publicId:n,systemId:i}=t.document.doctype||{},[s]=document.getElementsByTagName("base"),r=it.getNodeId(t.frameElement)||null;return{doctype:{name:e,publicId:n,systemId:i},href:(null==s?void 0:s.href)||t.location.href,scrollTop:t.pageYOffset,scrollLeft:t.pageXOffset,width:t.innerWidth,height:t.innerHeight,frameId:r}}checkNodesData({vNode:e},n){const{G_RECORD_OPTIONS:i}=window,s=(null==i?void 0:i.rewriteResource)||[];if(!(null==s?void 0:s.length))return;const r=t=>{const e=[];return t.forEach((t=>{const n=t;S(n)&&e.push(n,...r(n.children))})),e};ft(r(e.children),s,(e=>{this.emitData(t.RecordType.PATCH,e,n+1)}))}}var Dt="1.2.0-alpha.27";class Pt{constructor(t){Array.isArray(t)||(t=[]),this._args=t,this.taps=[],this.interceptors=[],this.call=this._call,this.promise=this._promise,this.callAsync=this._callAsync,this._x=void 0}compile(t){throw new Error("Abstract: should be overriden")}_createCall(t){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:t})}tap(t,e){if("string"==typeof t&&(t={name:t}),"object"!=typeof t||null===t)throw new Error("Invalid arguments to tap(options: Object, fn: function)");if("string"!=typeof(t=Object.assign({type:"sync",fn:e},t)).name||""===t.name)throw new Error("Missing name for tap");t=this._runRegisterInterceptors(t),this._insert(t)}tapAsync(t,e){if("string"==typeof t&&(t={name:t}),"object"!=typeof t||null===t)throw new Error("Invalid arguments to tapAsync(options: Object, fn: function)");if("string"!=typeof(t=Object.assign({type:"async",fn:e},t)).name||""===t.name)throw new Error("Missing name for tapAsync");t=this._runRegisterInterceptors(t),this._insert(t)}tapPromise(t,e){if("string"==typeof t&&(t={name:t}),"object"!=typeof t||null===t)throw new Error("Invalid arguments to tapPromise(options: Object, fn: function)");if("string"!=typeof(t=Object.assign({type:"promise",fn:e},t)).name||""===t.name)throw new Error("Missing name for tapPromise");t=this._runRegisterInterceptors(t),this._insert(t)}_runRegisterInterceptors(t){for(const e of this.interceptors)if(e.register){const n=e.register(t);void 0!==n&&(t=n)}return t}withOptions(t){const e=e=>Object.assign({},t,"string"==typeof e?{name:e}:e);t=Object.assign({},t,this._withOptions);const n=this._withOptionsBase||this,i=Object.create(n);return i.tapAsync=(t,i)=>n.tapAsync(e(t),i),i.tap=(t,i)=>n.tap(e(t),i),i.tapPromise=(t,i)=>n.tapPromise(e(t),i),i._withOptions=t,i._withOptionsBase=n,i}isUsed(){return this.taps.length>0||this.interceptors.length>0}intercept(t){if(this._resetCompilation(),this.interceptors.push(Object.assign({},t)),t.register)for(let e=0;e<this.taps.length;e++)this.taps[e]=t.register(this.taps[e])}_resetCompilation(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}_insert(t){let e;this._resetCompilation(),"string"==typeof t.before?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let n=0;"number"==typeof t.stage&&(n=t.stage);let i=this.taps.length;for(;i>0;){i--;const t=this.taps[i];this.taps[i+1]=t;const s=t.stage||0;if(e){if(e.has(t.name)){e.delete(t.name);continue}if(e.size>0)continue}if(!(s>n)){i++;break}}this.taps[i]=t}}function Mt(t,e){return function(...n){return this[t]=this._createCall(e),this[t](...n)}}Object.defineProperties(Pt.prototype,{_call:{value:Mt("call","sync"),configurable:!0,writable:!0},_promise:{value:Mt("promise","promise"),configurable:!0,writable:!0},_callAsync:{value:Mt("callAsync","async"),configurable:!0,writable:!0}});var Ut=Pt;var Ft=class{constructor(t){this.config=t,this.options=void 0,this._args=void 0}create(t){let e;switch(this.init(t),this.options.type){case"sync":e=new Function(this.args(),'"use strict";\n'+this.header()+this.content({onError:t=>`throw ${t};\n`,onResult:t=>`return ${t};\n`,resultReturns:!0,onDone:()=>"",rethrowIfPossible:!0}));break;case"async":e=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.content({onError:t=>`_callback(${t});\n`,onResult:t=>`_callback(null, ${t});\n`,onDone:()=>"_callback();\n"}));break;case"promise":let t=!1;const n=this.content({onError:e=>(t=!0,`_error(${e});\n`),onResult:t=>`_resolve(${t});\n`,onDone:()=>"_resolve();\n"});let i="";i+='"use strict";\n',i+="return new Promise((_resolve, _reject) => {\n",t&&(i+="var _sync = true;\n",i+="function _error(_err) {\n",i+="if(_sync)\n",i+="_resolve(Promise.resolve().then(() => { throw _err; }));\n",i+="else\n",i+="_reject(_err);\n",i+="};\n"),i+=this.header(),i+=n,t&&(i+="_sync = false;\n"),i+="});\n",e=new Function(this.args(),i)}return this.deinit(),e}setup(t,e){t._x=e.taps.map((t=>t.fn))}init(t){this.options=t,this._args=t.args.slice()}deinit(){this.options=void 0,this._args=void 0}header(){let t="";this.needContext()?t+="var _context = {};\n":t+="var _context;\n",t+="var _x = this._x;\n",this.options.interceptors.length>0&&(t+="var _taps = this.taps;\n",t+="var _interceptors = this.interceptors;\n");for(let e=0;e<this.options.interceptors.length;e++){const n=this.options.interceptors[e];n.call&&(t+=`${this.getInterceptor(e)}.call(${this.args({before:n.context?"_context":void 0})});\n`)}return t}needContext(){for(const t of this.options.taps)if(t.context)return!0;return!1}callTap(t,{onError:e,onResult:n,onDone:i,rethrowIfPossible:s}){let r="",o=!1;for(let e=0;e<this.options.interceptors.length;e++){const n=this.options.interceptors[e];n.tap&&(o||(r+=`var _tap${t} = ${this.getTap(t)};\n`,o=!0),r+=`${this.getInterceptor(e)}.tap(${n.context?"_context, ":""}_tap${t});\n`)}r+=`var _fn${t} = ${this.getTapFn(t)};\n`;const a=this.options.taps[t];switch(a.type){case"sync":s||(r+=`var _hasError${t} = false;\n`,r+="try {\n"),r+=n?`var _result${t} = _fn${t}(${this.args({before:a.context?"_context":void 0})});\n`:`_fn${t}(${this.args({before:a.context?"_context":void 0})});\n`,s||(r+="} catch(_err) {\n",r+=`_hasError${t} = true;\n`,r+=e("_err"),r+="}\n",r+=`if(!_hasError${t}) {\n`),n&&(r+=n(`_result${t}`)),i&&(r+=i()),s||(r+="}\n");break;case"async":let o="";o+=n?`(_err${t}, _result${t}) => {\n`:`_err${t} => {\n`,o+=`if(_err${t}) {\n`,o+=e(`_err${t}`),o+="} else {\n",n&&(o+=n(`_result${t}`)),i&&(o+=i()),o+="}\n",o+="}",r+=`_fn${t}(${this.args({before:a.context?"_context":void 0,after:o})});\n`;break;case"promise":r+=`var _hasResult${t} = false;\n`,r+=`var _promise${t} = _fn${t}(${this.args({before:a.context?"_context":void 0})});\n`,r+=`if (!_promise${t} || !_promise${t}.then)\n`,r+=`  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise${t} + ')');\n`,r+=`_promise${t}.then(_result${t} => {\n`,r+=`_hasResult${t} = true;\n`,n&&(r+=n(`_result${t}`)),i&&(r+=i()),r+=`}, _err${t} => {\n`,r+=`if(_hasResult${t}) throw _err${t};\n`,r+=e(`_err${t}`),r+="});\n"}return r}callTapsSeries({onError:t,onResult:e,resultReturns:n,onDone:i,doneReturns:s,rethrowIfPossible:r}){if(0===this.options.taps.length)return i();const o=this.options.taps.findIndex((t=>"sync"!==t.type)),a=n||s||!1;let l="",c=i;for(let n=this.options.taps.length-1;n>=0;n--){const s=n;c!==i&&"sync"!==this.options.taps[s].type&&(l+=`function _next${s}() {\n`,l+=c(),l+="}\n",c=()=>`${a?"return ":""}_next${s}();\n`);const d=c,h=t=>t?"":i(),u=this.callTap(s,{onError:e=>t(s,e,d,h),onResult:e&&(t=>e(s,t,d,h)),onDone:!e&&d,rethrowIfPossible:r&&(o<0||s<o)});c=()=>u}return l+=c(),l}callTapsLooping({onError:t,onDone:e,rethrowIfPossible:n}){if(0===this.options.taps.length)return e();const i=this.options.taps.every((t=>"sync"===t.type));let s="";i||(s+="var _looper = () => {\n",s+="var _loopAsync = false;\n"),s+="var _loop;\n",s+="do {\n",s+="_loop = false;\n";for(let t=0;t<this.options.interceptors.length;t++){const e=this.options.interceptors[t];e.loop&&(s+=`${this.getInterceptor(t)}.loop(${this.args({before:e.context?"_context":void 0})});\n`)}return s+=this.callTapsSeries({onError:t,onResult:(t,e,n,s)=>{let r="";return r+=`if(${e} !== undefined) {\n`,r+="_loop = true;\n",i||(r+="if(_loopAsync) _looper();\n"),r+=s(!0),r+="} else {\n",r+=n(),r+="}\n",r},onDone:e&&(()=>{let t="";return t+="if(!_loop) {\n",t+=e(),t+="}\n",t}),rethrowIfPossible:n&&i}),s+="} while(_loop);\n",i||(s+="_loopAsync = true;\n",s+="};\n",s+="_looper();\n"),s}callTapsParallel({onError:t,onResult:e,onDone:n,rethrowIfPossible:i,onTap:s=((t,e)=>e())}){if(this.options.taps.length<=1)return this.callTapsSeries({onError:t,onResult:e,onDone:n,rethrowIfPossible:i});let r="";r+="do {\n",r+=`var _counter = ${this.options.taps.length};\n`,n&&(r+="var _done = () => {\n",r+=n(),r+="};\n");for(let o=0;o<this.options.taps.length;o++){const a=()=>n?"if(--_counter === 0) _done();\n":"--_counter;",l=t=>t||!n?"_counter = 0;\n":"_counter = 0;\n_done();\n";r+="if(_counter <= 0) break;\n",r+=s(o,(()=>this.callTap(o,{onError:e=>{let n="";return n+="if(_counter > 0) {\n",n+=t(o,e,a,l),n+="}\n",n},onResult:e&&(t=>{let n="";return n+="if(_counter > 0) {\n",n+=e(o,t,a,l),n+="}\n",n}),onDone:!e&&(()=>a()),rethrowIfPossible:i})),a,l)}return r+="} while(false);\n",r}args({before:t,after:e}={}){let n=this._args;return t&&(n=[t].concat(n)),e&&(n=n.concat(e)),0===n.length?"":n.join(", ")}getTapFn(t){return`_x[${t}]`}getTap(t){return`_taps[${t}]`}getInterceptor(t){return`_interceptors[${t}]`}};const Bt=new class extends Ft{content({onError:t,onDone:e,rethrowIfPossible:n}){return this.callTapsSeries({onError:(e,n)=>t(n),onDone:e,rethrowIfPossible:n})}};var jt,Ht,zt=class extends Ut{tapAsync(){throw new Error("tapAsync is not supported on a SyncHook")}tapPromise(){throw new Error("tapPromise is not supported on a SyncHook")}compile(t){return Bt.setup(this,t),Bt.create(t)}};!function(t){t.beforeRun="beforeRun",t.run="run",t.emit="emit",t.end="end"}(jt||(jt={}));class Vt extends ut{init(){const t=this.recordOptions,{video:e}=t;this.fps=e.fps,this.watchVideos()}watchVideos(){const t=document.getElementsByTagName("video");Array.from(t).forEach((t=>{this.recordVideo(t)}))}recordVideo(e){const i=this.createMirrorCanvas(e),s=i.getContext("2d");if(!s)return;const r=()=>{this.resizeCanvasSize(i,e)};function o(t,e){const n=e.canvas;e.drawImage(t,0,0,n.width,n.height)}e.addEventListener("resize",r),o(e,s);const a=new MediaRecorder(i.captureStream(60),{mimeType:"video/webm;codecs=vp9",bitsPerSecond:1e6});a.ondataavailable=i=>n(this,void 0,void 0,(function*(){const n=i.data,s=q(yield n.arrayBuffer()),r={id:it.getNodeId(e),dataStr:s};this.emitData(t.RecordType.VIDEO,r)}));const l=()=>{"recording"===a.state&&a.stop()};let c=!1;const d=new J((()=>o(e,s)),this.fps),h=N((()=>{c=!c,c?(d.start(),a.start(1e3/this.fps)):(d.stop(),l())}),300,{isTrailing:!0,isImmediate:!0});e.addEventListener("timeupdate",h),this.uninstall((()=>{l(),e.removeEventListener("timeupdate",h),e.removeEventListener("resize",r)}))}createMirrorCanvas(t){const e=document.createElement("canvas",!1);return this.resizeCanvasSize(e,t),e}resizeCanvasSize(t,e){const{width:n,height:i}=e.getBoundingClientRect();t.width=n,t.height=i}}t.RecorderStatus=void 0,(Ht=t.RecorderStatus||(t.RecorderStatus={})).RUNNING="running",Ht.PAUSE="pause",Ht.HALT="halt";class Gt extends class{constructor(t){this.defaultPlugins=[],this.pluginWatchers=[],this.checkHookAvailable=()=>{try{return(new zt).call(),!0}catch(t){E(`Plugin hooks is not available in the current env, because ${t}`)}},this.plugin=(t,e)=>{const n=/Async/.test(this.hooks[t].constructor.name)?"tapAsync":"tap";this.hooks[t][n](t,e)},this.plugins=[],this.initPlugin(t);const e={beforeRun:new zt,run:new zt,emit:new zt(["data"]),end:new zt},n=this.checkHookAvailable()?e:Object.keys(e).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:()=>{}})),{});this.hooks=n}use(t){this.plugins.push(t)}initPlugin(t){const{plugins:e}=t||{};this.plugins.push(...this.defaultPlugins,...e||[])}loadPlugins(){this.plugins.forEach((t=>{t.apply.call(t,this)}))}addWatcher(t){this.pluginWatchers.push(t)}}{constructor(e){super(e),this.defaultMiddleware=[],this.destroyStore=new Set,this.listenStore=new Set,this.middleware=[...this.defaultMiddleware],this.watchersInstance=new Map,this.watchesReadyPromise=new Promise((t=>this.watcherResolve=t)),this.status=t.RecorderStatus.PAUSE;const n=this.initOptions(e);n.rootContext=n.rootContext||n.context,this.options=n,this.watchers=this.getWatchers(),this.init()}initOptions(t){const e=Object.assign(Object.assign({},Gt.defaultRecordOpts),t);return!0===e.video?e.video={fps:24}:e.video&&"fps"in e.video&&e.video.fps>24&&(e.video.fps=24),e}init(){this.startTime=w();const t=this.options;this.db=et,this.loadPlugins(),this.hooks.beforeRun.call(this),this.record(t),this.hooks.run.call(this)}onData(t){this.middleware.unshift(t)}destroy(){return n(this,void 0,void 0,(function*(){if(this.status===t.RecorderStatus.HALT)return;const e=yield this.pause();e&&(this.status=t.RecorderStatus.HALT,this.destroyTime=e.lastTime||w())}))}pause(){return n(this,void 0,void 0,(function*(){if(this.status===t.RecorderStatus.RUNNING){this.status=t.RecorderStatus.PAUSE;const e=yield this.db.last().catch((()=>{}));yield this.cancelListener(),this.destroyStore.forEach((t=>t())),this.destroyStore.clear();let n=null;if(e){n=e.time+1;const i={type:t.RecordType.TERMINATE,data:null,relatedId:window.G_RECORD_RELATED_ID,time:n};i.relatedId&&(this.options.write&&this.db.add(i),this.connectCompose(this.middleware)(i))}return{lastTime:n}}}))}clearDB(){this.db.clear()}cancelListener(){return n(this,void 0,void 0,(function*(){yield this.watchesReadyPromise,this.listenStore.forEach((t=>t())),this.listenStore.clear(),it.reset()}))}getWatchers(){const{video:t,audio:e,disableWatchers:n}=this.options,i=[Lt,...Object.values(Nt)];return e&&i.push(Ct),t&&i.push(Vt),i.filter((t=>!~n.indexOf(t.name)))}record(e){if(this.status!==t.RecorderStatus.PAUSE);else{const t=Object.assign(Object.assign({},Gt.defaultRecordOpts),e);this.startRecord(t.context.G_RECORD_OPTIONS=t)}}startRecord(e){return n(this,void 0,void 0,(function*(){this.status=t.RecorderStatus.RUNNING;let i=[...this.watchers,...this.pluginWatchers];e.context===this.options.rootContext?e.keep||this.db.clear():i=[Lt,...Object.values(Ot)];const s=e.context===this.options.rootContext,r=(e=>{const{write:i}=e,s=[],{middleware:r}=this.options.rootRecorder||{middleware:[]},o=(()=>{let e=0;return()=>n(this,void 0,void 0,(function*(){if(!(e>=1)){for(e++;s.length;){const e=s.shift();if(yield R(0),this.status===t.RecorderStatus.RUNNING){i&&this.db.add(e);const t=[...r,...this.middleware];yield this.connectCompose(t)(e),this.hooks.emit.call(e)}}e--}}))})();return t=>{t&&(s.push(t),o())}})(e),o={href:location.href,title:document.title,relatedId:T(),userAgent:navigator.userAgent,platform:navigator.platform,beginTime:w(),version:Dt},a=s?o.relatedId:e.rootContext.G_RECORD_RELATED_ID;if(e.context.G_RECORD_RELATED_ID=a,s&&r({type:t.RecordType.HEAD,data:o,relatedId:a,time:w()}),i.forEach((t=>{try{const n=new t({recorder:this,context:e&&e.context,listenStore:this.listenStore,relatedId:a,emit:r,watchers:this.watchersInstance});this.watchersInstance.set(t.name,n)}catch(t){E(t)}})),s&&e.emitLocationImmediate){const t=this.watchersInstance.get(yt.name);null==t||t.emitOne()}this.watcherResolve(),yield this.recordSubIFrames(e.context)}))}waitingSubIFramesLoaded(t){return n(this,void 0,void 0,(function*(){const e=Array.from(t.frames).filter((t=>{try{return t.frameElement&&t.frameElement.getAttribute("src")}catch(t){return E(t),!1}})).map((t=>n(this,void 0,void 0,(function*(){return yield R(0),yield new Promise((e=>{"complete"===t.document.readyState?e(t):t.addEventListener("load",(()=>{e(t)}))}))}))));return e.length?Promise.all(e):Promise.resolve([])}))}waitingIFrameLoaded(t){return n(this,void 0,void 0,(function*(){try{t.document&&t.frameElement&&t.frameElement.getAttribute("src")}catch(t){return void E(t)}return new Promise((e=>{const n=window.setInterval((()=>{try{t.document&&(clearInterval(n),e(t))}catch(t){E(t),clearInterval(n),e(void 0)}}),200)}))}))}recordSubIFrames(t){return n(this,void 0,void 0,(function*(){(yield this.waitingSubIFramesLoaded(t)).forEach((t=>{this.createIFrameRecorder(t)}))}))}recordIFrame(t){return n(this,void 0,void 0,(function*(){const e=yield this.waitingIFrameLoaded(t);e&&this.createIFrameRecorder(e)}))}createIFrameRecorder(t){const e=new Gt(Object.assign(Object.assign({},this.options),{context:t,keep:!0,rootRecorder:this.options.rootRecorder||this,rootContext:this.options.rootContext}));t.frameElement.frameRecorder=e,this.destroyStore.add((()=>e.destroy()))}connectCompose(t){return e=>n(this,void 0,void 0,(function*(){return yield t.reduce(((t,n)=>this.createNext(n,e,t)),(()=>Promise.resolve()))()}))}createNext(t,e,i){return()=>n(this,void 0,void 0,(function*(){return yield t(e,i)}))}}Gt.defaultRecordOpts={mode:"default",write:!0,keep:!1,audio:!1,video:!1,emitLocationImmediate:!0,context:window,rewriteResource:[],disableWatchers:[]};var Wt,Xt=(function(t,e){t.exports={polyfill:function(){var t=window,e=document;if(!("scrollBehavior"in e.documentElement.style)||!0===t.__forceSmoothScrollPolyfill__){var n,i=t.HTMLElement||t.Element,s={scroll:t.scroll||t.scrollTo,scrollBy:t.scrollBy,elementScroll:i.prototype.scroll||a,scrollIntoView:i.prototype.scrollIntoView},r=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now,o=(n=t.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(n)?1:0);t.scroll=t.scrollTo=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?f.call(t,e.body,void 0!==arguments[0].left?~~arguments[0].left:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:t.scrollY||t.pageYOffset):s.scroll.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:t.scrollY||t.pageYOffset))},t.scrollBy=function(){void 0!==arguments[0]&&(l(arguments[0])?s.scrollBy.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):f.call(t,e.body,~~arguments[0].left+(t.scrollX||t.pageXOffset),~~arguments[0].top+(t.scrollY||t.pageYOffset)))},i.prototype.scroll=i.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==l(arguments[0])){var t=arguments[0].left,e=arguments[0].top;f.call(this,this,void 0===t?this.scrollLeft:~~t,void 0===e?this.scrollTop:~~e)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");s.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},i.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):s.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},i.prototype.scrollIntoView=function(){if(!0!==l(arguments[0])){var n=u(this),i=n.getBoundingClientRect(),r=this.getBoundingClientRect();n!==e.body?(f.call(this,n,n.scrollLeft+r.left-i.left,n.scrollTop+r.top-i.top),"fixed"!==t.getComputedStyle(n).position&&t.scrollBy({left:i.left,top:i.top,behavior:"smooth"})):t.scrollBy({left:r.left,top:r.top,behavior:"smooth"})}else s.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function a(t,e){this.scrollLeft=t,this.scrollTop=e}function l(t){if(null===t||"object"!=typeof t||void 0===t.behavior||"auto"===t.behavior||"instant"===t.behavior)return!0;if("object"==typeof t&&"smooth"===t.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+t.behavior+" is not a valid value for enumeration ScrollBehavior.")}function c(t,e){return"Y"===e?t.clientHeight+o<t.scrollHeight:"X"===e?t.clientWidth+o<t.scrollWidth:void 0}function d(e,n){var i=t.getComputedStyle(e,null)["overflow"+n];return"auto"===i||"scroll"===i}function h(t){var e=c(t,"Y")&&d(t,"Y"),n=c(t,"X")&&d(t,"X");return e||n}function u(t){for(;t!==e.body&&!1===h(t);)t=t.parentNode||t.host;return t}function p(e){var n,i,s,o=(r()-e.startTime)/468;n=function(t){return.5*(1-Math.cos(Math.PI*t))}(o=o>1?1:o),e.method.call(e.scrollable,i=e.startX+(e.x-e.startX)*n,s=e.startY+(e.y-e.startY)*n),i===e.x&&s===e.y||t.requestAnimationFrame(p.bind(t,e))}function f(n,i,o){var l,c,d,h,u=r();n===e.body?(l=t,c=t.scrollX||t.pageXOffset,d=t.scrollY||t.pageYOffset,h=s.scroll):(l=n,c=n.scrollLeft,d=n.scrollTop,h=a),p({scrollable:l,method:h,startTime:u,startX:c,startY:d,x:i,y:o})}}}}(Wt={exports:{}},Wt.exports),Wt.exports);class Zt{constructor(){this.interval=1e3,this.len=0,this.resolved=!1,this.listener=[],this.timer=null,this.observe()}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)}destroy(){this.listener.length=0}observe(){this.timer=window.setTimeout((()=>{const t=performance.getEntriesByType("resource").filter((t=>this.isMatchType(t))).length;if(t<=this.len)return performance.clearResourceTimings(),this.clearTimer(),this.resolved=!0,void(this.listener.length&&this.listener.forEach((t=>t())));this.len=t,this.observe()}),this.interval)}isMatchType(t){switch(t.initiatorType){case"link":case"img":case"css":case"iframe":return!0}}ready(t){if(this.resolved)return t();this.listener.push(t)}}const Yt=new class{constructor(){this.id=1,this.listenersMap=new Map}on(t,e){return this.getListenersByKey(t).set(++this.id,e),this.id}emit(t,...e){this.getListenersByKey(t).forEach((t=>{t(...e)}))}once(t,e){const n=this.on(t,((...i)=>{e(...i),this.off(t,n)}));return n}flush(t){this.getListenersByKey(t).clear()}destroy(){this.listenersMap.clear()}off(t,e){this.getListenersByKey(t).delete(e)}getListenersByKey(t){const e=this.listenersMap.get(t)||new Map;return this.listenersMap.set(t,e),e}};function Kt(t){let e=t.length;for(;--e>=0;)t[e]=0}const qt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),$t=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Jt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Qt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),te=new Array(576);Kt(te);const ee=new Array(60);Kt(ee);const ne=new Array(512);Kt(ne);const ie=new Array(256);Kt(ie);const se=new Array(29);Kt(se);const re=new Array(30);function oe(t,e,n,i,s){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=t&&t.length}let ae,le,ce;function de(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}Kt(re);const he=t=>t<256?ne[t]:ne[256+(t>>>7)],ue=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},pe=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,ue(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},fe=(t,e,n)=>{pe(t,n[2*e],n[2*e+1])},me=(t,e)=>{let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},ge=(t,e,n)=>{const i=new Array(16);let s,r,o=0;for(s=1;s<=15;s++)i[s]=o=o+n[s-1]<<1;for(r=0;r<=e;r++){let e=t[2*r+1];0!==e&&(t[2*r]=me(i[e]++,e))}},_e=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},ye=t=>{t.bi_valid>8?ue(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},be=(t,e,n,i)=>{const s=2*e,r=2*n;return t[s]<t[r]||t[s]===t[r]&&i[e]<=i[n]},ve=(t,e,n)=>{const i=t.heap[n];let s=n<<1;for(;s<=t.heap_len&&(s<t.heap_len&&be(e,t.heap[s+1],t.heap[s],t.depth)&&s++,!be(e,i,t.heap[s],t.depth));)t.heap[n]=t.heap[s],n=s,s<<=1;t.heap[n]=i},Ee=(t,e,n)=>{let i,s,r,o,a=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*a]<<8|t.pending_buf[t.d_buf+2*a+1],s=t.pending_buf[t.l_buf+a],a++,0===i?fe(t,s,e):(r=ie[s],fe(t,r+256+1,e),o=qt[r],0!==o&&(s-=se[r],pe(t,s,o)),i--,r=he(i),fe(t,r,n),o=$t[r],0!==o&&(i-=re[r],pe(t,i,o)))}while(a<t.last_lit);fe(t,256,e)},we=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,r=e.stat_desc.elems;let o,a,l,c=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<r;o++)0!==n[2*o]?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[2*o+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[2*l]=1,t.depth[l]=0,t.opt_len--,s&&(t.static_len-=i[2*l+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)ve(t,n,o);l=r;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],ve(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[2*l]=n[2*o]+n[2*a],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[2*o+1]=n[2*a+1]=l,t.heap[1]=l++,ve(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const n=e.dyn_tree,i=e.max_code,s=e.stat_desc.static_tree,r=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,d,h,u,p,f,m=0;for(u=0;u<=15;u++)t.bl_count[u]=0;for(n[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)d=t.heap[c],u=n[2*n[2*d+1]+1]+1,u>l&&(u=l,m++),n[2*d+1]=u,d>i||(t.bl_count[u]++,p=0,d>=a&&(p=o[d-a]),f=n[2*d],t.opt_len+=f*(u+p),r&&(t.static_len+=f*(s[2*d+1]+p)));if(0!==m){do{for(u=l-1;0===t.bl_count[u];)u--;t.bl_count[u]--,t.bl_count[u+1]+=2,t.bl_count[l]--,m-=2}while(m>0);for(u=l;0!==u;u--)for(d=t.bl_count[u];0!==d;)h=t.heap[--c],h>i||(n[2*h+1]!==u&&(t.opt_len+=(u-n[2*h+1])*n[2*h],n[2*h+1]=u),d--)}})(t,e),ge(n,c,t.bl_count)},Te=(t,e,n)=>{let i,s,r=-1,o=e[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)s=o,o=e[2*(i+1)+1],++a<l&&s===o||(a<c?t.bl_tree[2*s]+=a:0!==s?(s!==r&&t.bl_tree[2*s]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,r=s,0===o?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4))},xe=(t,e,n)=>{let i,s,r=-1,o=e[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),i=0;i<=n;i++)if(s=o,o=e[2*(i+1)+1],!(++a<l&&s===o)){if(a<c)do{fe(t,s,t.bl_tree)}while(0!=--a);else 0!==s?(s!==r&&(fe(t,s,t.bl_tree),a--),fe(t,16,t.bl_tree),pe(t,a-3,2)):a<=10?(fe(t,17,t.bl_tree),pe(t,a-3,3)):(fe(t,18,t.bl_tree),pe(t,a-11,7));a=0,r=s,0===o?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4)}};let Ae=!1;const Re=(t,e,n,i)=>{pe(t,0+(i?1:0),3),((t,e,n,i)=>{ye(t),ue(t,n),ue(t,~n),t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n})(t,e,n)};var Se={_tr_init:t=>{Ae||((()=>{let t,e,n,i,s;const r=new Array(16);for(n=0,i=0;i<28;i++)for(se[i]=n,t=0;t<1<<qt[i];t++)ie[n++]=i;for(ie[n-1]=i,s=0,i=0;i<16;i++)for(re[i]=s,t=0;t<1<<$t[i];t++)ne[s++]=i;for(s>>=7;i<30;i++)for(re[i]=s<<7,t=0;t<1<<$t[i]-7;t++)ne[256+s++]=i;for(e=0;e<=15;e++)r[e]=0;for(t=0;t<=143;)te[2*t+1]=8,t++,r[8]++;for(;t<=255;)te[2*t+1]=9,t++,r[9]++;for(;t<=279;)te[2*t+1]=7,t++,r[7]++;for(;t<=287;)te[2*t+1]=8,t++,r[8]++;for(ge(te,287,r),t=0;t<30;t++)ee[2*t+1]=5,ee[2*t]=me(t,5);ae=new oe(te,qt,257,286,15),le=new oe(ee,$t,0,30,15),ce=new oe(new Array(0),Jt,0,19,7)})(),Ae=!0),t.l_desc=new de(t.dyn_ltree,ae),t.d_desc=new de(t.dyn_dtree,le),t.bl_desc=new de(t.bl_tree,ce),t.bi_buf=0,t.bi_valid=0,_e(t)},_tr_stored_block:Re,_tr_flush_block:(t,e,n,i)=>{let s,r,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),we(t,t.l_desc),we(t,t.d_desc),o=(t=>{let e;for(Te(t,t.dyn_ltree,t.l_desc.max_code),Te(t,t.dyn_dtree,t.d_desc.max_code),we(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*Qt[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),s=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==e?Re(t,e,n,i):4===t.strategy||r===s?(pe(t,2+(i?1:0),3),Ee(t,te,ee)):(pe(t,4+(i?1:0),3),((t,e,n,i)=>{let s;for(pe(t,e-257,5),pe(t,n-1,5),pe(t,i-4,4),s=0;s<i;s++)pe(t,t.bl_tree[2*Qt[s]+1],3);xe(t,t.dyn_ltree,e-1),xe(t,t.dyn_dtree,n-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Ee(t,t.dyn_ltree,t.dyn_dtree)),_e(t),i&&ye(t)},_tr_tally:(t,e,n)=>(t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(ie[n]+256+1)]++,t.dyn_dtree[2*he(e)]++),t.last_lit===t.lit_bufsize-1),_tr_align:t=>{pe(t,2,3),fe(t,256,te),(t=>{16===t.bi_valid?(ue(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},Ie=(t,e,n,i)=>{let s=65535&t|0,r=t>>>16&65535|0,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{s=s+e[i++]|0,r=r+s|0}while(--o);s%=65521,r%=65521}return s|r<<16|0};const Oe=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var Ne=(t,e,n,i)=>{const s=Oe,r=i+n;t^=-1;for(let n=i;n<r;n++)t=t>>>8^s[255&(t^e[n])];return-1^t},ke={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ce={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Le,_tr_stored_block:De,_tr_flush_block:Pe,_tr_tally:Me,_tr_align:Ue}=Se,{Z_NO_FLUSH:Fe,Z_PARTIAL_FLUSH:Be,Z_FULL_FLUSH:je,Z_FINISH:He,Z_BLOCK:ze,Z_OK:Ve,Z_STREAM_END:Ge,Z_STREAM_ERROR:We,Z_DATA_ERROR:Xe,Z_BUF_ERROR:Ze,Z_DEFAULT_COMPRESSION:Ye,Z_FILTERED:Ke,Z_HUFFMAN_ONLY:qe,Z_RLE:$e,Z_FIXED:Je,Z_DEFAULT_STRATEGY:Qe,Z_UNKNOWN:tn,Z_DEFLATED:en}=Ce,nn=(t,e)=>(t.msg=ke[e],e),sn=t=>(t<<1)-(t>4?9:0),rn=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let on=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const an=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},ln=(t,e)=>{Pe(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,an(t.strm)},cn=(t,e)=>{t.pending_buf[t.pending++]=e},dn=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},hn=(t,e,n,i)=>{let s=t.avail_in;return s>i&&(s=i),0===s?0:(t.avail_in-=s,e.set(t.input.subarray(t.next_in,t.next_in+s),n),1===t.state.wrap?t.adler=Ie(t.adler,e,s,n):2===t.state.wrap&&(t.adler=Ne(t.adler,e,s,n)),t.next_in+=s,t.total_in+=s,s)},un=(t,e)=>{let n,i,s=t.max_chain_length,r=t.strstart,o=t.prev_length,a=t.nice_match;const l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,c=t.window,d=t.w_mask,h=t.prev,u=t.strstart+258;let p=c[r+o-1],f=c[r+o];t.prev_length>=t.good_match&&(s>>=2),a>t.lookahead&&(a=t.lookahead);do{if(n=e,c[n+o]===f&&c[n+o-1]===p&&c[n]===c[r]&&c[++n]===c[r+1]){r+=2,n++;do{}while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<u);if(i=258-(u-r),r=u-258,i>o){if(t.match_start=e,o=i,i>=a)break;p=c[r+o-1],f=c[r+o]}}}while((e=h[e&d])>l&&0!=--s);return o<=t.lookahead?o:t.lookahead},pn=t=>{const e=t.w_size;let n,i,s,r,o;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-262)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,i=t.hash_size,n=i;do{s=t.head[--n],t.head[n]=s>=e?s-e:0}while(--i);i=e,n=i;do{s=t.prev[--n],t.prev[n]=s>=e?s-e:0}while(--i);r+=e}if(0===t.strm.avail_in)break;if(i=hn(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=i,t.lookahead+t.insert>=3)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=on(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=on(t,t.ins_h,t.window[o+3-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)},fn=(t,e)=>{let n,i;for(;;){if(t.lookahead<262){if(pn(t),t.lookahead<262&&e===Fe)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=on(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-262&&(t.match_length=un(t,n)),t.match_length>=3)if(i=Me(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=on(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=on(t,t.ins_h,t.window[t.strstart+1]);else i=Me(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ln(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===He?(ln(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(ln(t,!1),0===t.strm.avail_out)?1:2},mn=(t,e)=>{let n,i,s;for(;;){if(t.lookahead<262){if(pn(t),t.lookahead<262&&e===Fe)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=on(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-262&&(t.match_length=un(t,n),t.match_length<=5&&(t.strategy===Ke||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-3,i=Me(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=s&&(t.ins_h=on(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(ln(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=Me(t,0,t.window[t.strstart-1]),i&&ln(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=Me(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===He?(ln(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(ln(t,!1),0===t.strm.avail_out)?1:2};function gn(t,e,n,i,s){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=s}const _n=[new gn(0,0,0,0,((t,e)=>{let n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(pn(t),0===t.lookahead&&e===Fe)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const i=t.block_start+n;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,ln(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(ln(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===He?(ln(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&ln(t,!1),1)})),new gn(4,4,8,4,fn),new gn(4,5,16,8,fn),new gn(4,6,32,32,fn),new gn(4,4,16,16,mn),new gn(8,16,32,32,mn),new gn(8,16,128,128,mn),new gn(8,32,128,256,mn),new gn(32,128,258,1024,mn),new gn(32,258,258,4096,mn)];function yn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=en,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),rn(this.dyn_ltree),rn(this.dyn_dtree),rn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),rn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),rn(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const bn=t=>{if(!t||!t.state)return nn(t,We);t.total_in=t.total_out=0,t.data_type=tn;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=Fe,Le(e),Ve},vn=t=>{const e=bn(t);var n;return e===Ve&&((n=t.state).window_size=2*n.w_size,rn(n.head),n.max_lazy_match=_n[n.level].max_lazy,n.good_match=_n[n.level].good_length,n.nice_match=_n[n.level].nice_length,n.max_chain_length=_n[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),e},En=(t,e,n,i,s,r)=>{if(!t)return We;let o=1;if(e===Ye&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),s<1||s>9||n!==en||i<8||i>15||e<0||e>9||r<0||r>Je)return nn(t,We);8===i&&(i=9);const a=new yn;return t.state=a,a.strm=t,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=e,a.strategy=r,a.method=n,vn(t)};var wn=En,Tn=(t,e)=>t&&t.state?2!==t.state.wrap?We:(t.state.gzhead=e,Ve):We,xn=(t,e)=>{let n,i;if(!t||!t.state||e>ze||e<0)return t?nn(t,We):We;const s=t.state;if(!t.output||!t.input&&0!==t.avail_in||666===s.status&&e!==He)return nn(t,0===t.avail_out?Ze:We);s.strm=t;const r=s.last_flush;if(s.last_flush=e,42===s.status)if(2===s.wrap)t.adler=0,cn(s,31),cn(s,139),cn(s,8),s.gzhead?(cn(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),cn(s,255&s.gzhead.time),cn(s,s.gzhead.time>>8&255),cn(s,s.gzhead.time>>16&255),cn(s,s.gzhead.time>>24&255),cn(s,9===s.level?2:s.strategy>=qe||s.level<2?4:0),cn(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(cn(s,255&s.gzhead.extra.length),cn(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=Ne(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(cn(s,0),cn(s,0),cn(s,0),cn(s,0),cn(s,0),cn(s,9===s.level?2:s.strategy>=qe||s.level<2?4:0),cn(s,3),s.status=113);else{let e=en+(s.w_bits-8<<4)<<8,n=-1;n=s.strategy>=qe||s.level<2?0:s.level<6?1:6===s.level?2:3,e|=n<<6,0!==s.strstart&&(e|=32),e+=31-e%31,s.status=113,dn(s,e),0!==s.strstart&&(dn(s,t.adler>>>16),dn(s,65535&t.adler)),t.adler=1}if(69===s.status)if(s.gzhead.extra){for(n=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>n&&(t.adler=Ne(t.adler,s.pending_buf,s.pending-n,n)),an(t),n=s.pending,s.pending!==s.pending_buf_size));)cn(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>n&&(t.adler=Ne(t.adler,s.pending_buf,s.pending-n,n)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){n=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>n&&(t.adler=Ne(t.adler,s.pending_buf,s.pending-n,n)),an(t),n=s.pending,s.pending===s.pending_buf_size)){i=1;break}i=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,cn(s,i)}while(0!==i);s.gzhead.hcrc&&s.pending>n&&(t.adler=Ne(t.adler,s.pending_buf,s.pending-n,n)),0===i&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){n=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>n&&(t.adler=Ne(t.adler,s.pending_buf,s.pending-n,n)),an(t),n=s.pending,s.pending===s.pending_buf_size)){i=1;break}i=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,cn(s,i)}while(0!==i);s.gzhead.hcrc&&s.pending>n&&(t.adler=Ne(t.adler,s.pending_buf,s.pending-n,n)),0===i&&(s.status=103)}else s.status=103;if(103===s.status&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&an(t),s.pending+2<=s.pending_buf_size&&(cn(s,255&t.adler),cn(s,t.adler>>8&255),t.adler=0,s.status=113)):s.status=113),0!==s.pending){if(an(t),0===t.avail_out)return s.last_flush=-1,Ve}else if(0===t.avail_in&&sn(e)<=sn(r)&&e!==He)return nn(t,Ze);if(666===s.status&&0!==t.avail_in)return nn(t,Ze);if(0!==t.avail_in||0!==s.lookahead||e!==Fe&&666!==s.status){let n=s.strategy===qe?((t,e)=>{let n;for(;;){if(0===t.lookahead&&(pn(t),0===t.lookahead)){if(e===Fe)return 1;break}if(t.match_length=0,n=Me(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(ln(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===He?(ln(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(ln(t,!1),0===t.strm.avail_out)?1:2})(s,e):s.strategy===$e?((t,e)=>{let n,i,s,r;const o=t.window;for(;;){if(t.lookahead<=258){if(pn(t),t.lookahead<=258&&e===Fe)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(s=t.strstart-1,i=o[s],i===o[++s]&&i===o[++s]&&i===o[++s])){r=t.strstart+258;do{}while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<r);t.match_length=258-(r-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=Me(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Me(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(ln(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===He?(ln(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(ln(t,!1),0===t.strm.avail_out)?1:2})(s,e):_n[s.level].func(s,e);if(3!==n&&4!==n||(s.status=666),1===n||3===n)return 0===t.avail_out&&(s.last_flush=-1),Ve;if(2===n&&(e===Be?Ue(s):e!==ze&&(De(s,0,0,!1),e===je&&(rn(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),an(t),0===t.avail_out))return s.last_flush=-1,Ve}return e!==He?Ve:s.wrap<=0?Ge:(2===s.wrap?(cn(s,255&t.adler),cn(s,t.adler>>8&255),cn(s,t.adler>>16&255),cn(s,t.adler>>24&255),cn(s,255&t.total_in),cn(s,t.total_in>>8&255),cn(s,t.total_in>>16&255),cn(s,t.total_in>>24&255)):(dn(s,t.adler>>>16),dn(s,65535&t.adler)),an(t),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Ve:Ge)},An=t=>{if(!t||!t.state)return We;const e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?nn(t,We):(t.state=null,113===e?nn(t,Xe):Ve)},Rn=(t,e)=>{let n=e.length;if(!t||!t.state)return We;const i=t.state,s=i.wrap;if(2===s||1===s&&42!==i.status||i.lookahead)return We;if(1===s&&(t.adler=Ie(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){0===s&&(rn(i.head),i.strstart=0,i.block_start=0,i.insert=0);let t=new Uint8Array(i.w_size);t.set(e.subarray(n-i.w_size,n),0),e=t,n=i.w_size}const r=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,pn(i);i.lookahead>=3;){let t=i.strstart,e=i.lookahead-2;do{i.ins_h=on(i,i.ins_h,i.window[t+3-1]),i.prev[t&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=t,t++}while(--e);i.strstart=t,i.lookahead=2,pn(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=o,t.input=a,t.avail_in=r,i.wrap=s,Ve};const Sn=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var In=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const e in n)Sn(n,e)&&(t[e]=n[e])}}return t},On=t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const n=new Uint8Array(e);for(let e=0,i=0,s=t.length;e<s;e++){let s=t[e];n.set(s,i),i+=s.length}return n};let Nn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Kt){Nn=!1}const kn=new Uint8Array(256);for(let t=0;t<256;t++)kn[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;kn[254]=kn[254]=1;var Cn=t=>{let e,n,i,s,r,o=t.length,a=0;for(s=0;s<o;s++)n=t.charCodeAt(s),55296==(64512&n)&&s+1<o&&(i=t.charCodeAt(s+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),s++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),r=0,s=0;r<a;s++)n=t.charCodeAt(s),55296==(64512&n)&&s+1<o&&(i=t.charCodeAt(s+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?e[r++]=n:n<2048?(e[r++]=192|n>>>6,e[r++]=128|63&n):n<65536?(e[r++]=224|n>>>12,e[r++]=128|n>>>6&63,e[r++]=128|63&n):(e[r++]=240|n>>>18,e[r++]=128|n>>>12&63,e[r++]=128|n>>>6&63,e[r++]=128|63&n);return e},Ln=(t,e)=>{let n,i;const s=e||t.length,r=new Array(2*s);for(i=0,n=0;n<s;){let e=t[n++];if(e<128){r[i++]=e;continue}let o=kn[e];if(o>4)r[i++]=65533,n+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&n<s;)e=e<<6|63&t[n++],o--;o>1?r[i++]=65533:e<65536?r[i++]=e:(e-=65536,r[i++]=55296|e>>10&1023,r[i++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Nn)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n})(r,i)},Dn=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+kn[t[n]]>e?n:e},Pn=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Mn=Object.prototype.toString,{Z_NO_FLUSH:Un,Z_SYNC_FLUSH:Fn,Z_FULL_FLUSH:Bn,Z_FINISH:jn,Z_OK:Hn,Z_STREAM_END:zn,Z_DEFAULT_COMPRESSION:Vn,Z_DEFAULT_STRATEGY:Gn,Z_DEFLATED:Wn}=Ce;function Xn(t){this.options=In({level:Vn,method:Wn,chunkSize:16384,windowBits:15,memLevel:8,strategy:Gn},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Pn,this.strm.avail_out=0;let n=wn(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Hn)throw new Error(ke[n]);if(e.header&&Tn(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Cn(e.dictionary):"[object ArrayBuffer]"===Mn.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=Rn(this.strm,t),n!==Hn)throw new Error(ke[n]);this._dict_set=!0}}function Zn(t,e){const n=new Xn(e);if(n.push(t,!0),n.err)throw n.msg||ke[n.err];return n.result}Xn.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=e===~~e?e:!0===e?jn:Un,n.input="string"==typeof t?Cn(t):"[object ArrayBuffer]"===Mn.call(t)?new Uint8Array(t):t,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(r===Fn||r===Bn)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=xn(n,r),s===zn)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=An(this.strm),this.onEnd(s),this.ended=!0,s===Hn;if(0!==n.avail_out){if(r>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Xn.prototype.onData=function(t){this.chunks.push(t)},Xn.prototype.onEnd=function(t){t===Hn&&(this.result=On(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Yn={Deflate:Xn,deflate:Zn,deflateRaw:function(t,e){return(e=e||{}).raw=!0,Zn(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,Zn(t,e)},constants:Ce},Kn=function(t,e){let n,i,s,r,o,a,l,c,d,h,u,p,f,m,g,_,y,b,v,E,w,T,x,A;const R=t.state;n=t.next_in,x=t.input,i=n+(t.avail_in-5),s=t.next_out,A=t.output,r=s-(e-t.avail_out),o=s+(t.avail_out-257),a=R.dmax,l=R.wsize,c=R.whave,d=R.wnext,h=R.window,u=R.hold,p=R.bits,f=R.lencode,m=R.distcode,g=(1<<R.lenbits)-1,_=(1<<R.distbits)-1;t:do{p<15&&(u+=x[n++]<<p,p+=8,u+=x[n++]<<p,p+=8),y=f[u&g];e:for(;;){if(b=y>>>24,u>>>=b,p-=b,b=y>>>16&255,0===b)A[s++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=f[(65535&y)+(u&(1<<b)-1)];continue e}if(32&b){R.mode=12;break t}t.msg="invalid literal/length code",R.mode=30;break t}v=65535&y,b&=15,b&&(p<b&&(u+=x[n++]<<p,p+=8),v+=u&(1<<b)-1,u>>>=b,p-=b),p<15&&(u+=x[n++]<<p,p+=8,u+=x[n++]<<p,p+=8),y=m[u&_];n:for(;;){if(b=y>>>24,u>>>=b,p-=b,b=y>>>16&255,!(16&b)){if(0==(64&b)){y=m[(65535&y)+(u&(1<<b)-1)];continue n}t.msg="invalid distance code",R.mode=30;break t}if(E=65535&y,b&=15,p<b&&(u+=x[n++]<<p,p+=8,p<b&&(u+=x[n++]<<p,p+=8)),E+=u&(1<<b)-1,E>a){t.msg="invalid distance too far back",R.mode=30;break t}if(u>>>=b,p-=b,b=s-r,E>b){if(b=E-b,b>c&&R.sane){t.msg="invalid distance too far back",R.mode=30;break t}if(w=0,T=h,0===d){if(w+=l-b,b<v){v-=b;do{A[s++]=h[w++]}while(--b);w=s-E,T=A}}else if(d<b){if(w+=l+d-b,b-=d,b<v){v-=b;do{A[s++]=h[w++]}while(--b);if(w=0,d<v){b=d,v-=b;do{A[s++]=h[w++]}while(--b);w=s-E,T=A}}}else if(w+=d-b,b<v){v-=b;do{A[s++]=h[w++]}while(--b);w=s-E,T=A}for(;v>2;)A[s++]=T[w++],A[s++]=T[w++],A[s++]=T[w++],v-=3;v&&(A[s++]=T[w++],v>1&&(A[s++]=T[w++]))}else{w=s-E;do{A[s++]=A[w++],A[s++]=A[w++],A[s++]=A[w++],v-=3}while(v>2);v&&(A[s++]=A[w++],v>1&&(A[s++]=A[w++]))}break}}break}}while(n<i&&s<o);v=p>>3,n-=v,p-=v<<3,u&=(1<<p)-1,t.next_in=n,t.next_out=s,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=s<o?o-s+257:257-(s-o),R.hold=u,R.bits=p};const qn=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Jn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Qn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ti=(t,e,n,i,s,r,o,a)=>{const l=a.bits;let c,d,h,u,p,f,m=0,g=0,_=0,y=0,b=0,v=0,E=0,w=0,T=0,x=0,A=null,R=0;const S=new Uint16Array(16),I=new Uint16Array(16);let O,N,k,C=null,L=0;for(m=0;m<=15;m++)S[m]=0;for(g=0;g<i;g++)S[e[n+g]]++;for(b=l,y=15;y>=1&&0===S[y];y--);if(b>y&&(b=y),0===y)return s[r++]=20971520,s[r++]=20971520,a.bits=1,0;for(_=1;_<y&&0===S[_];_++);for(b<_&&(b=_),w=1,m=1;m<=15;m++)if(w<<=1,w-=S[m],w<0)return-1;if(w>0&&(0===t||1!==y))return-1;for(I[1]=0,m=1;m<15;m++)I[m+1]=I[m]+S[m];for(g=0;g<i;g++)0!==e[n+g]&&(o[I[e[n+g]]++]=g);if(0===t?(A=C=o,f=19):1===t?(A=qn,R-=257,C=$n,L-=257,f=256):(A=Jn,C=Qn,f=-1),x=0,g=0,m=_,p=r,v=b,E=0,h=-1,T=1<<b,u=T-1,1===t&&T>852||2===t&&T>592)return 1;for(;;){O=m-E,o[g]<f?(N=0,k=o[g]):o[g]>f?(N=C[L+o[g]],k=A[R+o[g]]):(N=96,k=0),c=1<<m-E,d=1<<v,_=d;do{d-=c,s[p+(x>>E)+d]=O<<24|N<<16|k|0}while(0!==d);for(c=1<<m-1;x&c;)c>>=1;if(0!==c?(x&=c-1,x+=c):x=0,g++,0==--S[m]){if(m===y)break;m=e[n+o[g]]}if(m>b&&(x&u)!==h){for(0===E&&(E=b),p+=_,v=m-E,w=1<<v;v+E<y&&(w-=S[v+E],!(w<=0));)v++,w<<=1;if(T+=1<<v,1===t&&T>852||2===t&&T>592)return 1;h=x&u,s[h]=b<<24|v<<16|p-r|0}}return 0!==x&&(s[p+x]=m-E<<24|64<<16|0),a.bits=b,0};const{Z_FINISH:ei,Z_BLOCK:ni,Z_TREES:ii,Z_OK:si,Z_STREAM_END:ri,Z_NEED_DICT:oi,Z_STREAM_ERROR:ai,Z_DATA_ERROR:li,Z_MEM_ERROR:ci,Z_BUF_ERROR:di,Z_DEFLATED:hi}=Ce,ui=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function pi(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const fi=t=>{if(!t||!t.state)return ai;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,si},mi=t=>{if(!t||!t.state)return ai;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,fi(t)},gi=(t,e)=>{let n;if(!t||!t.state)return ai;const i=t.state;return e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?ai:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,mi(t))},_i=(t,e)=>{if(!t)return ai;const n=new pi;t.state=n,n.window=null;const i=gi(t,e);return i!==si&&(t.state=null),i};let yi,bi,vi=!0;const Ei=t=>{if(vi){yi=new Int32Array(512),bi=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ti(1,t.lens,0,288,yi,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ti(2,t.lens,0,32,bi,0,t.work,{bits:5}),vi=!1}t.lencode=yi,t.lenbits=9,t.distcode=bi,t.distbits=5},wi=(t,e,n,i)=>{let s;const r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(e.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>i&&(s=i),r.window.set(e.subarray(n-i,n-i+s),r.wnext),(i-=s)?(r.window.set(e.subarray(n-i,n),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var Ti=mi,xi=_i,Ai=(t,e)=>{let n,i,s,r,o,a,l,c,d,h,u,p,f,m,g,_,y,b,v,E,w,T,x=0;const A=new Uint8Array(4);let R,S;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return ai;n=t.state,12===n.mode&&(n.mode=13),o=t.next_out,s=t.output,l=t.avail_out,r=t.next_in,i=t.input,a=t.avail_in,c=n.hold,d=n.bits,h=a,u=l,T=si;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;d<16;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(2&n.wrap&&35615===c){n.check=0,A[0]=255&c,A[1]=c>>>8&255,n.check=Ne(n.check,A,2,0),c=0,d=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",n.mode=30;break}if((15&c)!==hi){t.msg="unknown compression method",n.mode=30;break}if(c>>>=4,d-=4,w=8+(15&c),0===n.wbits)n.wbits=w;else if(w>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<n.wbits,t.adler=n.check=1,n.mode=512&c?10:12,c=0,d=0;break;case 2:for(;d<16;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(n.flags=c,(255&n.flags)!==hi){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Ne(n.check,A,2,0)),c=0,d=0,n.mode=3;case 3:for(;d<32;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}n.head&&(n.head.time=c),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,n.check=Ne(n.check,A,4,0)),c=0,d=0,n.mode=4;case 4:for(;d<16;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Ne(n.check,A,2,0)),c=0,d=0,n.mode=5;case 5:if(1024&n.flags){for(;d<16;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Ne(n.check,A,2,0)),c=0,d=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(p=n.length,p>a&&(p=a),p&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(r,r+p),w)),512&n.flags&&(n.check=Ne(n.check,i,p,r)),a-=p,r+=p,n.length-=p),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===a)break t;p=0;do{w=i[r+p++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&p<a);if(512&n.flags&&(n.check=Ne(n.check,i,p,r)),a-=p,r+=p,w)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===a)break t;p=0;do{w=i[r+p++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&p<a);if(512&n.flags&&(n.check=Ne(n.check,i,p,r)),a-=p,r+=p,w)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;d<16;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(c!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}c=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;d<32;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}t.adler=n.check=ui(c),c=0,d=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=o,t.avail_out=l,t.next_in=r,t.avail_in=a,n.hold=c,n.bits=d,oi;t.adler=n.check=1,n.mode=12;case 12:if(e===ni||e===ii)break t;case 13:if(n.last){c>>>=7&d,d-=7&d,n.mode=27;break}for(;d<3;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}switch(n.last=1&c,c>>>=1,d-=1,3&c){case 0:n.mode=14;break;case 1:if(Ei(n),n.mode=20,e===ii){c>>>=2,d-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}c>>>=2,d-=2;break;case 14:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&c,c=0,d=0,n.mode=15,e===ii)break t;case 15:n.mode=16;case 16:if(p=n.length,p){if(p>a&&(p=a),p>l&&(p=l),0===p)break t;s.set(i.subarray(r,r+p),o),a-=p,r+=p,l-=p,o+=p,n.length-=p;break}n.mode=12;break;case 17:for(;d<14;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(n.nlen=257+(31&c),c>>>=5,d-=5,n.ndist=1+(31&c),c>>>=5,d-=5,n.ncode=4+(15&c),c>>>=4,d-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;d<3;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}n.lens[I[n.have++]]=7&c,c>>>=3,d-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,R={bits:n.lenbits},T=ti(0,n.lens,0,19,n.lencode,0,n.work,R),n.lenbits=R.bits,T){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;x=n.lencode[c&(1<<n.lenbits)-1],g=x>>>24,_=x>>>16&255,y=65535&x,!(g<=d);){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(y<16)c>>>=g,d-=g,n.lens[n.have++]=y;else{if(16===y){for(S=g+2;d<S;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(c>>>=g,d-=g,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}w=n.lens[n.have-1],p=3+(3&c),c>>>=2,d-=2}else if(17===y){for(S=g+3;d<S;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}c>>>=g,d-=g,w=0,p=3+(7&c),c>>>=3,d-=3}else{for(S=g+7;d<S;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}c>>>=g,d-=g,w=0,p=11+(127&c),c>>>=7,d-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;p--;)n.lens[n.have++]=w}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,R={bits:n.lenbits},T=ti(1,n.lens,0,n.nlen,n.lencode,0,n.work,R),n.lenbits=R.bits,T){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,R={bits:n.distbits},T=ti(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,R),n.distbits=R.bits,T){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,e===ii)break t;case 20:n.mode=21;case 21:if(a>=6&&l>=258){t.next_out=o,t.avail_out=l,t.next_in=r,t.avail_in=a,n.hold=c,n.bits=d,Kn(t,u),o=t.next_out,s=t.output,l=t.avail_out,r=t.next_in,i=t.input,a=t.avail_in,c=n.hold,d=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;x=n.lencode[c&(1<<n.lenbits)-1],g=x>>>24,_=x>>>16&255,y=65535&x,!(g<=d);){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(_&&0==(240&_)){for(b=g,v=_,E=y;x=n.lencode[E+((c&(1<<b+v)-1)>>b)],g=x>>>24,_=x>>>16&255,y=65535&x,!(b+g<=d);){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=g,d-=g,n.back+=g,n.length=y,0===_){n.mode=26;break}if(32&_){n.back=-1,n.mode=12;break}if(64&_){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&_,n.mode=22;case 22:if(n.extra){for(S=n.extra;d<S;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;x=n.distcode[c&(1<<n.distbits)-1],g=x>>>24,_=x>>>16&255,y=65535&x,!(g<=d);){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(0==(240&_)){for(b=g,v=_,E=y;x=n.distcode[E+((c&(1<<b+v)-1)>>b)],g=x>>>24,_=x>>>16&255,y=65535&x,!(b+g<=d);){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=g,d-=g,n.back+=g,64&_){t.msg="invalid distance code",n.mode=30;break}n.offset=y,n.extra=15&_,n.mode=24;case 24:if(n.extra){for(S=n.extra;d<S;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break t;if(p=u-l,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=s,f=o-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{s[o++]=m[f++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===l)break t;s[o++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;d<32;){if(0===a)break t;a--,c|=i[r++]<<d,d+=8}if(u-=l,t.total_out+=u,n.total+=u,u&&(t.adler=n.check=n.flags?Ne(n.check,s,u,o-u):Ie(n.check,s,u,o-u)),u=l,(n.flags?c:ui(c))!==n.check){t.msg="incorrect data check",n.mode=30;break}c=0,d=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;d<32;){if(0===a)break t;a--,c+=i[r++]<<d,d+=8}if(c!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}c=0,d=0}n.mode=29;case 29:T=ri;break t;case 30:T=li;break t;case 31:return ci;case 32:default:return ai}return t.next_out=o,t.avail_out=l,t.next_in=r,t.avail_in=a,n.hold=c,n.bits=d,(n.wsize||u!==t.avail_out&&n.mode<30&&(n.mode<27||e!==ei))&&wi(t,t.output,t.next_out,u-t.avail_out),h-=t.avail_in,u-=t.avail_out,t.total_in+=h,t.total_out+=u,n.total+=u,n.wrap&&u&&(t.adler=n.check=n.flags?Ne(n.check,s,u,t.next_out-u):Ie(n.check,s,u,t.next_out-u)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===h&&0===u||e===ei)&&T===si&&(T=di),T},Ri=t=>{if(!t||!t.state)return ai;let e=t.state;return e.window&&(e.window=null),t.state=null,si},Si=(t,e)=>{if(!t||!t.state)return ai;const n=t.state;return 0==(2&n.wrap)?ai:(n.head=e,e.done=!1,si)},Ii=(t,e)=>{const n=e.length;let i,s,r;return t&&t.state?(i=t.state,0!==i.wrap&&11!==i.mode?ai:11===i.mode&&(s=1,s=Ie(s,e,n,0),s!==i.check)?li:(r=wi(t,e,n,n),r?(i.mode=31,ci):(i.havedict=1,si))):ai},Oi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ni=Object.prototype.toString,{Z_NO_FLUSH:ki,Z_FINISH:Ci,Z_OK:Li,Z_STREAM_END:Di,Z_NEED_DICT:Pi,Z_STREAM_ERROR:Mi,Z_DATA_ERROR:Ui,Z_MEM_ERROR:Fi}=Ce;function Bi(t){this.options=In({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Pn,this.strm.avail_out=0;let n=xi(this.strm,e.windowBits);if(n!==Li)throw new Error(ke[n]);if(this.header=new Oi,Si(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Cn(e.dictionary):"[object ArrayBuffer]"===Ni.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Ii(this.strm,e.dictionary),n!==Li)))throw new Error(ke[n])}function ji(t,e){const n=new Bi(e);if(n.push(t),n.err)throw n.msg||ke[n.err];return n.result}Bi.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let r,o,a;if(this.ended)return!1;for(o=e===~~e?e:!0===e?Ci:ki,n.input="[object ArrayBuffer]"===Ni.call(t)?new Uint8Array(t):t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),r=Ai(n,o),r===Pi&&s&&(r=Ii(n,s),r===Li?r=Ai(n,o):r===Ui&&(r=Pi));n.avail_in>0&&r===Di&&n.state.wrap>0&&0!==t[n.next_in];)Ti(n),r=Ai(n,o);switch(r){case Mi:case Ui:case Pi:case Fi:return this.onEnd(r),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||r===Di))if("string"===this.options.to){let t=Dn(n.output,n.next_out),e=n.next_out-t,s=Ln(n.output,t);n.next_out=e,n.avail_out=i-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==Li||0!==a){if(r===Di)return r=Ri(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Bi.prototype.onData=function(t){this.chunks.push(t)},Bi.prototype.onEnd=function(t){t===Li&&(this.result="string"===this.options.to?this.chunks.join(""):On(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Hi={Inflate:Bi,inflate:ji,inflateRaw:function(t,e){return(e=e||{}).raw=!0,ji(t,e)},ungzip:ji,constants:Ce};const{Deflate:zi,deflate:Vi,deflateRaw:Gi,gzip:Wi}=Yn,{Inflate:Xi,inflate:Zi,inflateRaw:Yi,ungzip:Ki}=Hi;var qi={Deflate:zi,deflate:Vi,deflateRaw:Gi,gzip:Wi,Inflate:Xi,inflate:Zi,inflateRaw:Yi,ungzip:Ki,constants:Ce};class $i{constructor(t){this.defaultOptions={ai:"$",si:","},this.keysMap=new Map,this.indexMap=new Map;let e=0,n=1;this.options=this.defaultOptions,"Object"===Object.prototype.toString.call(t[0]).slice(8,14)&&(this.options={...this.defaultOptions,...t[0]},e++,n++),this.result=this.convert2Json(t[e],t[n])}convert2Json(t,e){if(!(t&&Array.isArray(t)&&e&&Array.isArray(e)))throw new Error("Params is not valid");const n=t.slice();for(t.forEach(((t,e)=>{n[e].i=e;const i=t.join(this.options.si);this.keysMap.set(i,e),this.indexMap.set(e,i)}));n.length;){const t=n.shift(),e=t.i,i=t.join(this.options.si);for(const[e,n]of t.entries())if("number"==typeof n){const i=this.indexMap.get(n);t[e]=i.split(this.options.si)}const s=t.flat().join(this.options.si);i!==s&&(this.keysMap.delete(i),this.keysMap.set(s,e),this.indexMap.set(e,s))}return this.convertObj(e)}convertObj(t){if(Array.isArray(t)){if(t[0]===this.options.ai){const e=t.slice(1);return this.convertArray(e)}if(!t.length)return{};const e=this.indexMap.get(t[0]),n={},i=e.split(this.options.si),s=t.slice(1);return i.forEach(((t,e)=>{const i=s[e];n[t]=Array.isArray(i)?this.convertObj(i):i})),n}return t}convertArray(t){const e=[];return t.forEach((t=>{e.push(this.convertObj(t))})),e}}class Ji{constructor(t,e){if(this.defaultOptions={arrayIdentifier:"$",separatorIdentifier:","},this.keys=[],this.values=[],this.keyMap=new Map,this.indexMap=new Map,this.getLastKeyInMap=()=>{const t=this.keyMap;return Array.from(t)[t.size-1][0]},"object"!=typeof t||null===t)throw new Error("The params json is not a object");const{arrayIdentifier:n,separatorIdentifier:i}=e||{};this.json=t,this.arrayIdentifier=n||this.defaultOptions.arrayIdentifier,this.separatorIdentifier=i||this.defaultOptions.separatorIdentifier,this.result=this.getResult()}getResult(){const t=this.json;this.values=Array.isArray(t)?[...this.deepConvertArray(t)]:this.deepConvertObj(t);const e={ai:this.arrayIdentifier===this.defaultOptions.arrayIdentifier?void 0:this.arrayIdentifier,si:this.separatorIdentifier===this.defaultOptions.separatorIdentifier?void 0:this.separatorIdentifier};return Object.keys(e).forEach((t=>{e[t]||delete e[t]})),Object.keys(e).length?[e,this.keys,this.values]:[this.keys,this.values]}deepConvertArray(t,e=!0){const n=[e?this.arrayIdentifier:""].filter(Boolean);return t.forEach((t=>{const e=typeof t;Array.isArray(t)?n.push(this.deepConvertArray(t)):n.push(null!==t&&"object"===e?this.deepConvertObj(t):t)})),n}deepConvertObj(t){const e=this.separatorIdentifier,n=[],i=Object.getOwnPropertyNames(t).sort(),s=i.join(e),r="<$index>";if(""===s&&!i.length)return n;let o=i.map((e=>t[e]));if(this.keys.length){const a=this.getIndexByKey(s);if(void 0!==a)return o=s.split(e).map((e=>t[e])),n.push(a,...this.deepConvertArray(o,!1)),n;const l=this.getLastKeyInMap();for(const[t,o]of this.keyMap){const a=s.split(e).length<t.split(e).length,c=a?t:s,d=a?s:t,h=this.keys.length,u=t=>t.split(e).map((t=>"<$"+t+">")).join(e),p=u(c),f=u(d);if(~p.indexOf(f)){const t=p.replace(f,r),i=n=>t.split(e).map((t=>t===r?n:t.substring(2,t.length-1)));if(a){const t=this.saveKey(d),s=i(t),r=this.getIndexByKey(c);this.keys.push(d.split(e)),this.keys[r]=s,n.unshift(t)}else{const t=i(o);this.saveKey(c),this.keys.push(t),n.unshift(h)}break}if(l===t){this.saveKey(s),this.keys.push([...i]),n.unshift(h);break}}}else n.unshift(this.saveKey(s)),this.keys.push(i);return n.push(...this.deepConvertArray(o,!1)),n}saveKey(t,e=this.keys.length){return this.keyMap.set(t,e),this.indexMap.set(e,t),e}getIndexByKey(t){return this.keyMap.get(t)}}const Qi={startTime:0,endTime:0,duration:0,packsInfo:[]};var ts;!function(t){t.RESET="RESET",t.PROGRESS="PROGRESS"}(ts||(ts={}));const es={speed:0,options:{}};var ns;function is(e){const n=[],i=[];return e.forEach(((s,r)=>{r&&s.type===t.RecordType.HEAD&&(n.push(i.slice()),i.length=0),i.push(s),e.length-1===r&&n.push(i)})),n}!function(t){t.RESET="RESET",t.SPEED="SPEED",t.OPTIONS="OPTIONS"}(ns||(ns={}));const ss={records:[],packs:[],currentData:{}};var rs;!function(t){t.RESET="RESET",t.UPDATE_DATA="UPDATE_DATA",t.APPEND_RECORDS="APPEND_RECORDS"}(rs||(rs={}));const os=function(t){let e=t({});const n=[];function i(i){e=t(e,i),n.forEach((t=>{t(e)}))}return{unsubscribe:function(){n.length=0,i({type:"RESET",data:{}})},subscribe:function(t){n.push(t)},dispatch:i,getState:function(){return e}}}(function(t){const e=Object.keys(t);return function(n,i){const s={};for(let r=0;r<e.length;r++){const o=e[r],a=(0,t[o])(n[o],i);s[o]=a}return s}}({player:function(t,e){if(t||(t=es),!e)return t;const{type:n,data:i}=e;switch(n){case ns.OPTIONS:return Object.assign(Object.assign({},t),{options:i.options});case ns.SPEED:return Object.assign(Object.assign({},t),{speed:i.speed});case ns.RESET:return Object.assign({},es);default:return t}},progress:function(t,e){if(t||(t=Qi),!e)return t;const{type:n,data:i}=e;switch(n){case ts.PROGRESS:return Object.assign(Object.assign({},t),i);case ts.RESET:return Object.assign({},Qi);default:return t}},replayData:function(t,e){if(t||(t=ss),!e)return t;const{type:n,data:i}=e;switch(n){case rs.APPEND_RECORDS:const e=t.records;e.push(...i.records);const n=is(e);return t.packs=n,t;case rs.UPDATE_DATA:return i.currentData&&i.currentData&&(window.G_REPLAY_DATA=i.currentData),Object.assign(Object.assign({},t),i);case rs.RESET:return Object.assign({},ss);default:return t}}}));var as=hs,ls=hs,cs=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,ds=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i;function hs(t){t||(t={});var e=t.ua;if(e||"undefined"==typeof navigator||(e=navigator.userAgent),e&&e.headers&&"string"==typeof e.headers["user-agent"]&&(e=e.headers["user-agent"]),"string"!=typeof e)return!1;var n=t.tablet?ds.test(e):cs.test(e);return!n&&t.tablet&&t.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==e.indexOf("Macintosh")&&-1!==e.indexOf("Safari")&&(n=!0),n}as.isMobile=hs,as.default=ls;function us(e){const n={head:{},snapshot:{},records:[],audio:{src:"",pcmStrList:[],wavStrList:[],subtitles:[],opts:{}},videos:[]},i=new Map;if(e.forEach(((s,r)=>{const o=e[r+1];if(s.type===t.RecordType.HEAD)o&&!o.data.frameId&&(n.head=s);else if(s.type===t.RecordType.SNAPSHOT)s.data.frameId?n.records.push(s):n&&(n.snapshot=s);else{switch(s.type){case t.RecordType.AUDIO:const{data:e}=s;if(e.src){const t=e;n.audio.src=t.src,n.audio.subtitles=t.subtitles}else!function(t){return"pcm"===t.type&&"base64"===t.encode}(e)?!function(t){return"wav"===t.type&&"base64"===t.encode}(e)?n.audio.opts=e.data:n.audio.wavStrList.push(...e.data):n.audio.pcmStrList.push(...e.data);n.records.push(s);break;case t.RecordType.VIDEO:const{data:r,time:o}=s,{id:a,dataStr:l}=r;if(!l)break;const c=i.get(a);if(c)c.bufferStrList.push(l),c.endTime=o;else{i.set(a,{id:a,startTime:o,endTime:o,bufferStrList:[l]})}n.records.push(s)}n&&n.records.push(s)}})),i.size){const t=Array.from(i.entries()).map((([,t])=>{const{bufferStrList:e,startTime:n,endTime:i,id:s}=t,r=e.map((t=>{const e=$(t);return new Blob([e],{type:"video/webm;codecs=vp9"})})),o=new Blob(r,{type:"video/webm"});return{id:s,src:window.URL.createObjectURL(o),startTime:n,endTime:i}}));n.videos.push(...t)}return n}function ps(){const t=window.G_REPLAY_STR_RECORDS;if(!t)return null;return function(t){return function(t){const{result:e}=new $i(t);return e}(JSON.parse(qi.ungzip(t,{to:"string"})))}(function(t){const e=t.split(""),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++){const i=e[t].charCodeAt(0);n[t]=i>=256?i-256:i}return n}(t))}function fs(){return n(this,void 0,void 0,(function*(){const t=yield et.readAll();return t&&t.length?t:null}))}function ms(t){return[...(new DOMParser).parseFromString(t,"text/html").body.children]}function gs(t,e){t.open();const n=e.doctype;t.write(`<!DOCTYPE ${n.name} ${n.publicId?'PUBLIC "'+n.publicId+'"':""} ${n.systemId?'"'+n.systemId+'"':""}><html><head></head><body></body></html>`)}function _s(t,e){const n=ht(e.vNode);if(n){const i=n.querySelector("head");if(i){const t=ms("<div>\n                    <style>\n                        /**\n * Copyright (c) oct16.\n * https://github.com/oct16\n * \n * This source code is licensed under the GPL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\ntextarea,\nbutton,\ndatalist,\nfieldset,\nform,\ninput,\nlabel,\nlegend,\nmeter,\noptgroup,\noption,\noutput,\nprogress,\nselect,\niframe {\n  pointer-events: none;\n}\nhtml,\nbody {\n  scrollbar-width: none;\n  /* firefox */\n}\nhtml::-webkit-scrollbar,\nbody::-webkit-scrollbar {\n  display: none;\n}\n\n                    </style>\n                </div>")[0].firstElementChild;i.appendChild(t)}const s=t.documentElement;n.scrollLeft=e.scrollLeft,n.scrollTop=e.scrollTop,t.replaceChild(n,s)}}const ys=(bs=os,t=>{let e;return n=>{bs.subscribe((()=>{const i=t(bs.getState());((t,e)=>{if(t===e)return!0;if("object"!=typeof t||null==t||"object"!=typeof e||null==e)return!1;const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(let i=0;i<n.length;i++){if(!e.hasOwnProperty(n[i]))return!1;if(t[n[i]]!==e[n[i]])return!1}return!0})(i,e)||n(e=i)}))}});var bs;const vs=t=>function(e,n,i){const s=i.value;i.value=function(e){ys(t)((t=>{s.call(this,t),e&&e(t)}))}};class Es{constructor(t,e=[]){this.ratio=2,this.target=t,this.points=e;const n=this.target.offsetHeight*this.ratio;this.targetWidth=t.width=this.target.offsetWidth*this.ratio,this.targetHeight=t.height=n,this.context=t.getContext("2d")}radiusRect(t,e,n,i,s,r="#fff"){const o=Math.min(n,i);s>o/2&&(s=o/2),this.context.fillStyle=r,this.context.strokeStyle=r,this.context.beginPath(),this.context.moveTo(t+s,e),this.context.arcTo(t+n,e,t+n,e+i,s),this.context.arcTo(t+n,e+i,t,e+i,s),this.context.arcTo(t,e+i,t,e,s),this.context.arcTo(t,e,t+n,e,s),this.context.closePath(),this.context.stroke(),this.context.fill()}}class ws extends Es{constructor(t,e){super(t,e),this.draw()}draw(){const t=this.points,e=t.length,n=this.targetWidth/(2*e),i=this.targetHeight,s=Math.max.apply(null,t.map((t=>t.step)));for(let r=0;r<e;r++){const e=t[r];if(!e.step)continue;const o=2*r*n,a=2,l=n,c=.9*i,d=.16,h=Math.sin(e.step/s*(Math.PI/2))*(1-d)+d;this.radiusRect(o,a,l,e.snapshot?c:h*c,2,e.snapshot?"#6AD1C7":"#fff")}}}class Ts extends Es{constructor(t){super(t),this.draw()}draw(){if(!this.targetWidth)return;this.radiusRect(4,8,this.targetWidth-8,8,4)}}function xs(t,e,n){return function(i){customElements.get(t)||customElements.define(t,class extends HTMLElement{constructor(){var t,s;super();const r=ms(e)[0];i.prototype.target=r;const o=r.getElementsByTagName("slot")[0];if(o&&(null===(t=this.children)||void 0===t?void 0:t.length)>0){const t=o.parentElement;[...this.children].forEach((e=>null==t?void 0:t.insertBefore(e,null))),null==t||t.removeChild(o)}(null==n?void 0:n.isShadow)?this.attachShadow({mode:"open"}).append(r):null===(s=this.parentElement)||void 0===s||s.replaceChild(r,this),i.prototype.parent=r.parentElement}})}}const As=function(t,...e){let n="";return t.forEach(((t,i)=>{n+=t+(e[i]||"")})),n};const Rs="const loadingNode = document.createElement('div')\nloadingNode.className = 'pacman-box';\nloadingNode.innerHTML = '<style>.pacman-box{margin:0 auto;display:flex;vertical-align:middle;height:100vh;flex:0 1 auto;flex-direction:column;flex-grow:1;flex-shrink:0;flex-basis:25%;max-width:25%;align-items:center;justify-content:center}.pacman>div:first-of-type,.pacman>div:nth-child(2){width:0;height:0;border-right:25px solid transparent;border-top:25px solid grey;border-left:25px solid grey;border-bottom:25px solid grey;border-radius:25px;position:relative;left:-30px}@-webkit-keyframes rotate_pacman_half_up{0%,100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}50%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate_pacman_half_up{0%,100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}50%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes rotate_pacman_half_down{0%,100%{-webkit-transform:rotate(90deg);transform:rotate(90deg)}50%{-webkit-transform:rotate(0);transform:rotate(0)}}@keyframes rotate_pacman_half_down{0%,100%{-webkit-transform:rotate(90deg);transform:rotate(90deg)}50%{-webkit-transform:rotate(0);transform:rotate(0)}}@-webkit-keyframes pacman-balls{75%{opacity:.7}100%{-webkit-transform:translate(-100px,-6.25px);transform:translate(-100px,-6.25px)}}@keyframes pacman-balls{75%{opacity:.7}100%{-webkit-transform:translate(-100px,-6.25px);transform:translate(-100px,-6.25px)}}.pacman{transform: translateX(30px);position:relative}.pacman>div:nth-child(3){-webkit-animation:pacman-balls 1s -.66s infinite linear;animation:pacman-balls 1s -.66s infinite linear}.pacman>div:nth-child(4){-webkit-animation:pacman-balls 1s -.33s infinite linear;animation:pacman-balls 1s -.33s infinite linear}.pacman>div:nth-child(5){-webkit-animation:pacman-balls 1s 0s infinite linear;animation:pacman-balls 1s 0s infinite linear}.pacman>div:first-of-type{-webkit-animation:rotate_pacman_half_up .5s 0s infinite;animation:rotate_pacman_half_up .5s 0s infinite}.pacman>div:nth-child(2){-webkit-animation:rotate_pacman_half_down .5s 0s infinite;animation:rotate_pacman_half_down .5s 0s infinite;margin-top:-50px}.pacman>div:nth-child(3),.pacman>div:nth-child(4),.pacman>div:nth-child(5),.pacman>div:nth-child(6){background-color:grey;border-radius:100%;margin:2px;width:10px;height:10px;position:absolute;-webkit-transform:translate(0,-6.25px);transform:translate(0,-6.25px);top:25px;left:70px}</style><div class=\"pacman\"><div></div><div></div><div></div><div></div><div></div></div>'\nloadingNode.setAttribute('style', 'text-align: center;vertical-align: middle;line-height: 100vh;')\ndocument.body.insertBefore(loadingNode, document.body.firstChild);window.addEventListener('DOMContentLoaded', () => loadingNode.parentNode.removeChild(loadingNode))";const Ss=new class{constructor(){const t=document.createElement("iframe");t.style.display="none",t.style.visibility="hidden",document.body.appendChild(t),this.safeWindow=t.contentWindow}getObjByPath(t,e){if(!t)return e;const n=this.getMethodAtPath(t);let i=e;return n.forEach((t=>{i=i[t]})),i}getMethodAtPath(t){return t.split(".")}recoverMethod(t){const e=this.getObjByPath(t,window);if(!this.isNative(e)){const e=this.getObjByPath(t,this.safeWindow);this.recover(t,e)}}recover(t,e){const n=this.getMethodAtPath(t),[i,...s]=n.reverse();this.getObjByPath(s.reverse().join("."),window)[i]=e}isNative(t){const e=Object.prototype.toString,n=Function.prototype.toString,i=RegExp("^"+String(e).replace(/[.*+?^${}()|[\]\/\\]/g,"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),s=typeof t;return"function"==s?i.test(n.call(t)):t&&"object"==s&&/^\[object .+?Constructor\]$/.test(e.call(t))||!1}};["MutationObserver","console.warn","console.error","console.log"].forEach(Ss.recoverMethod.bind(Ss));function Is(t){return n(this,void 0,void 0,(function*(){["HTMLElement.prototype.appendChild"].forEach(Ss.recoverMethod.bind(Ss));const e=(yield Os(t)).documentElement.outerHTML;!function(t,e){!function(t,e){const n=document.createElement("a");n.download=e,"string"==typeof t?(n.href=t,n.click()):(n.href=URL.createObjectURL(t),n.click(),URL.revokeObjectURL(n.href))}(new Blob([e],{type:"text/html"}),`${t}.html`)}(`${t.exportName||"TimeCat"}-${T()}`,e)}))}function Os(t){return n(this,void 0,void 0,(function*(){const e=(new DOMParser).parseFromString('<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no, viewport-fit=cover">\n    <meta http-equiv="Content-Security-Policy-Report-Only" />\n    <title>TimeCat</title>\n</head>\n<body style="margin: 0; overflow: hidden">\n</body>\n</html>\n',"text/html");return yield function(t){return n(this,void 0,void 0,(function*(){Ns(t,[{src:Rs}])}))}(e),yield function(t,e){return n(this,void 0,void 0,(function*(){const n=e.records||ps()||function(){const t=os.getState().replayData.records;return t.length?t:null}()||(yield fs());if(!n)return E("Records not found");const i=function(t){let e="";for(let n=0;n<t.length;n++){let i=t[n];~[13,34,39,44,60,62,92,96,10,0].indexOf(i)&&(i+=256),e+=String.fromCharCode(i)}return e}(function(t,e){const n=function(t,e){const{result:n}=new Ji(t,e);return n}(t,e),{level:i}=e||{};return qi.gzip(JSON.stringify(n),{level:void 0!==i?i:6})}(function(t,e){return t.map(ks)}(is(n)).flat(1)));Ns(t,[{src:`var G_REPLAY_STR_RECORDS = '${i}'`}])}))}(e,t),yield function(t,e){return n(this,void 0,void 0,(function*(){const{scripts:n,autoplay:i}=e,s={autoplay:i},r=n||[];r.some((t=>"timecat-init"===t.name))||r.push({name:"timecat-init",src:`new TimeCat.Player(${JSON.stringify(s)})`}),yield Ns(t,r)}))}(e,t),e}))}function Ns(t,e){return n(this,void 0,void 0,(function*(){if(e)for(const n of e){const{src:e,name:i}=n;let s=e;const r=document.createElement("script");i&&(r.id=i);/^((chrome-extension|https?):)?\/\/.+/.test(e)&&(s=yield W(e)),r.text=s,t.body.appendChild(r)}}))}function ks(e){const n=[],i=[];if(e.forEach((e=>{if(e.type===t.RecordType.AUDIO){if("pcm"===e.data.type)return void n.push(e)}i.push(e)})),n.length){const e=q(function(t){const e=[];t.forEach((t=>{const{data:n}=t.data;e.push(...n)}));const n=[];for(let t=0;t<e.length;t++){const i=K(e[t]);n.push(i)}return X(n,{sampleBits:8,channelCount:1,sampleRate:48e3})}(n).buffer),s=i.length-1,r={type:"wav",encode:"base64",data:[e]},o=Object.assign(Object.assign({},i[s]),{time:n.slice(-1)[0].time,type:t.RecordType.AUDIO,data:r});i.splice(s,0,o)}return i}var Cs;!function(t){t.INIT="init",t.PLAY="play",t.PAUSE="pause",t.STOP="stop",t.SPEED="speed",t.RESIZE="resize",t.PROGRESS="progress",t.JUMP="jump"}(Cs||(Cs={}));let Ls=class{constructor(t,e){this.options=t,this.c=e,this.init()}watchPlayerSpeed(t){t&&(this.paly(t.speed),this.setSpeed(t.speed))}init(){this.controller=this.c.container.querySelector(".player-keyboard"),this.playOrPauseBtn=this.c.container.querySelector(".play-or-pause"),this.createFastForwards(this.options.fastForward);const t=t=>{if(t.target&&"button"===t.target.type){const e=Number(t.target.getAttribute("speed"));this.dispatchPlay(e)}};this.controller.addEventListener("click",t,!1),this.options.destroyStore.add((()=>{this.controller.removeEventListener("click",t,!1)})),this.watchPlayerSpeed(),this.detectWindowIsActive()}createFastForwards(t){if(t=Array.from(new Set([1].concat(t)))){const e=t.reduce(((t,e)=>t+As`<button type="button" class="speed" speed="${e}">${e}x</button>`),"");this.controller.append(...ms(e))}}dispatchPlay(t=0){os.dispatch({type:ns.SPEED,data:{speed:t}})}detectWindowIsActive(){const t=()=>{"hidden"===document.visibilityState&&this.dispatchPlay(0)};document.addEventListener("visibilitychange",t,!1),this.options.destroyStore.add((()=>{document.removeEventListener("visibilitychange",t,!1)}))}paly(t){0!==t?(this.playOrPauseBtn.innerText="",this.playOrPauseBtn.setAttribute("style","letter-spacing: 1px;font-weight: bold;"),this.playOrPauseBtn.removeAttribute("speed")):(this.playOrPauseBtn.innerText="",this.playOrPauseBtn.removeAttribute("style"),this.playOrPauseBtn.setAttribute("speed","1"))}setSpeed(t){const e=this.c.container.querySelectorAll(".speed");[...e].forEach((t=>{t.removeAttribute("disabled")}));const n=function(t){return[...e].findIndex((e=>e.getAttribute("speed")===t.toString()))}(t);n>-1&&e[n].setAttribute("disabled","")}};e([vs((t=>({speed:t.player.speed})))],Ls.prototype,"watchPlayerSpeed",null),Ls=e([xs("player-keyboard",As`<div class="player-keyboard"> <button class="play-or-pause" type="button" speed="1"></button> </div>`)],Ls);const Ds=[WebGLActiveInfo,WebGLBuffer,WebGLFramebuffer,WebGLProgram,WebGLRenderbuffer,WebGLShader,WebGLShaderPrecisionFormat,WebGLTexture,WebGLUniformLocation],Ps=Object.create(null),Ms=t=>Ps[t]||(Ps[t]=[]);function Us(t){return n(this,void 0,void 0,(function*(){yield R();const{id:e,args:n}=t,i=it.getNode(e);if(!i)return;if(i.contextType){if("2d"===i.contextType)return}else i.contextType="webgl";const s=i.getContext("webgl",{preserveDrawingBuffer:!0});s&&n.forEach((({name:t,args:e})=>{const n=s[t];if("function"==typeof n){e=e.map((t=>{if("string"==typeof t){if(t.startsWith("$f32arr")){const e=t.slice(7).split(",");return new Float32Array(e)}if(t.startsWith("$arr")){return new Array(...t.slice(4).split(",")).map((t=>function(t){return!isNaN(parseFloat(t))&&isFinite(parseFloat(t))}(t)?+t:t))}if(t.startsWith("$")){const[e,n]=t.slice(1).split("@");if("src"===e){const t=document.createElement("img");return t.setAttribute(e,n),t}return Ms(e)[+n]}}return t}));const i=n.apply(s,e);if(null==i?void 0:i.constructor){const e=i.constructor.name;if(Ds.some((t=>t.name===e))||"getExtension"===t){const t=Ms(e);i&&Array.isArray(t)&&(~t.indexOf(i)||t.push(i))}}}}))}))}function Fs(t){const{family:e,source:n}=t,i=new Uint8Array(n.length);for(let t=0;t<n.length;t++){const e=n.charCodeAt(t);i[t]=e}const s=new window.FontFace(e,i);this.c.sandBoxDoc.fonts.add(s),document.fonts.add(s)}function Bs(t){var e;const{top:n,left:i,id:s,behavior:r}=t,o=s?it.getNode(s):this.c.sandBoxDoc.documentElement;if(!o)return;const a=window.G_REPLAY_DATA.snapshot.data.height,l={top:n,left:i,behavior:r||Math.abs(n-o.scrollTop)>3*a?"auto":"smooth"};try{o.scroll(l)}catch(t){"HTML"===o.nodeName?null===(e=o.ownerDocument.defaultView)||void 0===e||e.scroll(l):(o.scrollLeft=i,o.scrollTop=n)}}function js(t){const{width:e,height:n,id:i}=t;let s;i?(s=it.getNode(i),s.style.width=e+"px",s.style.height=n+"px"):(s=this.c.sandBoxDoc.body,this.c.resize({setWidth:e,setHeight:n}))}function Hs(t){const{x:e,y:n,id:i,type:s}=t;let o=0,a=0;if(i){const t=it.getNode(i);let e={};t&&t.getBoundingClientRect&&(e=t.getBoundingClientRect());const{left:n,top:s}=e;o=n,a=s}s===r.MOVE?this.pointer.move(e+o,n+a):s===r.CLICK&&this.pointer.click(e+o,n+a)}function zs(t,e){const{parentId:n,nextId:i,node:s}=t,r=it.getNode(n);if(!r||!j(r))return!0;{let t=null;if(i){if(e.has(i))return!0;if(t=(t=>t?it.getNode(t):null)(i),!t)return!0;if(!r.contains(t))return!0}const n=s;let o;"number"==typeof s?(o=it.getNode(s),e.has(s)&&e.delete(s)):o=S(n)?ht(n):function(t){const{type:e,value:n,id:i}=t;let s;switch(e){case Node.TEXT_NODE:s=document.createTextNode(n);break;case Node.COMMENT_NODE:s=document.createComment(n)}return it.updateNode(i,s),s}(n),o&&r.insertBefore(o,t)}}function Vs(e,i){return n(this,void 0,void 0,(function*(){const{isJumping:r,speed:o}=i||{},a=r?0:200,{type:l,data:c}=e,d=()=>a?R(a):Promise.resolve();switch(l){case t.RecordType.SNAPSHOT:!function(t){n(this,void 0,void 0,(function*(){const e=t,{frameId:n}=e;if(n){const t=it.getNode(n);if(t){const n=t.getAttribute("src");n&&(dt(t,"disabled-src",n),dt(t,"src",null));const i=t.contentDocument;gs(i,e),_s(i,e)}}}))}(c);break;case t.RecordType.SCROLL:Bs.call(this,c);break;case t.RecordType.WINDOW:js.call(this,c);break;case t.RecordType.MOUSE:Hs.call(this,c);break;case t.RecordType.DOM:r||1!==o||(yield d()),function(t){const{addedNodes:e,movedNodes:n,removedNodes:i,attrs:s,texts:r}=t;i&&i.forEach((t=>{const{parentId:e,id:n}=t,i=it.getNode(e),s=it.getNode(n);s&&i&&i.contains(s)&&i.removeChild(s)}));const o=new Set,a=n&&n.slice()||[];a.forEach((t=>{t.nextId&&a.some((e=>e.id===t.nextId))&&o.add(t.nextId)}));const l=a.map((t=>{const{id:e,parentId:n,nextId:i}=t;return{node:e,parentId:n,nextId:i}})).concat(e&&e.slice()||[]);if(l){const t=l.length,e=t>0?(t*t+t)/2:0;let n=0;for(;l.length;){const t=l.shift();t&&zs(t,o)&&n++<e&&l.push(t)}}s&&s.forEach((t=>{const{id:e,key:n,value:i}=t,s=it.getNode(e);s&&dt(s,n,i)})),r&&r.forEach((t=>{const{id:e,value:n,parentId:i}=t,s=it.getNode(i),r=it.getNode(e);if(s&&r){if(V(r))return void(r.textContent=n);s.innerText=n}}))}(c);break;case t.RecordType.FORM_EL:r||1!==o||(yield d()),function(t,e){const{isJumping:n}=e||{},{id:i,key:r,type:o,value:a,patches:l}=t,c=it.getNode(i),{mode:d}=os.getState().player.options;if(c)if(o===s.INPUT||o===s.CHANGE)if(l&&l.length){const t=(h=c.value,l.forEach((t=>{const{type:e,value:n,len:i}=t;switch(e){case"add":h=h.substring(0,t.index)+n+h.substring(t.index);break;case"rm":h=h.substring(0,t.index)+h.substring(t.index+i)}})),h);c.value=t}else r&&(c[r]=a);else o===s.FOCUS?"live"!==d&&!n&&c.focus&&c.focus({preventScroll:!0}):o===s.BLUR?"live"!==d&&!n&&c.blur&&c.blur():o===s.PROP&&r&&(c[r]=a);var h}(c,{isJumping:r});break;case t.RecordType.LOCATION:!function(t){n(this,void 0,void 0,(function*(){const{path:e,hash:n,href:i,contextNodeId:s}=t,r=it.getNode(s);if(r){const t=r.ownerDocument.defaultView;t.G_REPLAY_LOCATION=Object.assign(Object.assign({},t.G_REPLAY_LOCATION),{path:e,hash:n,href:i})}}))}(c);break;case t.RecordType.CANVAS_SNAPSHOT:!function(t){const{src:e,id:n}=t,i=it.getNode(n);if(!i||"HTMLCanvasElement"!==i.constructor.name)return;if(i.contextType){if("webgl"===i.contextType||"experimental-webgl"===i.contextType)return}else i.contextType="2d";const s=i.getContext("2d");if(s&&e){const t=new Image;t.src=e,t.onload=function(){s.drawImage(this,0,0)}}}(c);break;case t.RecordType.CANVAS:r||1!==o||(yield d()),function(t){const e=t,{src:n,status:i,id:s,strokes:r}=e,o=it.getNode(s);if(!o||"HTMLCanvasElement"!==o.constructor.name)return;if(o.contextType){if("webgl"===o.contextType||"experimental-webgl"===o.contextType)return}else o.contextType="2d";const a=o.getContext("2d");if(a)if(n){const t=new Image;t.src=n,t.onload=function(){a.drawImage(this,0,0)}}else if(i)Object.keys(i).forEach((t=>{a[t]=i[t]}));else for(const t of r){const{name:e,args:n}=t,i="number"==typeof e?U[e]:e;if(Array.isArray(n)){const t=n.slice();if("createPattern"===i)t[0]=it.getNode(t[0]);else if("drawImage"===i){const e=new Image,n=t[0];if(n.length<10)continue;e.src=n,t[0]=e}else"putImageData"===i&&(t[0]=new ImageData(new Uint8ClampedArray(t[0].data),t[1],t[2]));a[i].apply(a,t)}else a[i]=n}}(c);break;case t.RecordType.FONT:Fs.call(this,c);break;case t.RecordType.PATCH:!function(t){n(this,void 0,void 0,(function*(){const{id:e,key:n,url:i,tag:s,text:r}=t,o=it.getNode(e);o||(yield R(1e3));const a=o;if(a&&a.getAttribute(n)===i&&a.tagName===s.toUpperCase()&&"link"===s){const t=document.createElement("style");t.setAttribute("type","text/css"),t.setAttribute("css-url",i),t.innerHTML=r,a.replaceWith(t)}}))}(c);break;case t.RecordType.WEBGL:Us(c)}}))}let Gs=class{constructor(t,e,n,i,s){this.speed=0,this.recordIndex=0,this.frameIndex=0,this.isFirstTimePlay=!0,this.maxFrameInterval=250,this.maxFps=30,this.animationDelayTime=300,this.elapsedTime=0,this.audioOffset=150,this.curViewDiffTime=0,this.preViewsDurationTime=0,this.viewIndex=0,this.subtitlesIndex=0,this.maxIntensityStep=8,this.options=t,this.c=e,this.pointer=n,this.progress=i,this.broadcaster=s,this.init()}watchPlayerSpeed(t){if(t){const e=t.speed,n=this.speed;this.speed=e,Yt.emit(Cs.SPEED,e),e>0?(this.play(),0===n&&Yt.emit(Cs.PLAY)):this.pause()}}watchProgress(){this.recalculateProgress(),this.viewsLength=os.getState().replayData.packs.length}watcherProgressJump(){Yt.on(Cs.JUMP,(t=>n(this,void 0,void 0,(function*(){return this.jump(t,!0)}))))}init(){return n(this,void 0,void 0,(function*(){this.audioNode=new Audio,this.calcFrames(),this.viewsLength=os.getState().replayData.packs.length,this.initViewState(),this.setViewState(),this.records.length<=2?(window.addEventListener("record-data",this.streamHandle.bind(this)),this.options.destroyStore.add((()=>window.removeEventListener("record-data",this.streamHandle.bind(this))))):(this.watchProgress(),this.watchPlayerSpeed(),this.watcherProgressJump()),Yt.on(Cs.RESIZE,(()=>n(this,void 0,void 0,(function*(){yield R(500),this.recalculateProgress()})))),Yt.on(Cs.PROGRESS,(t=>{this.progress.setProgressPosition(t/(this.frames.length-1))}))}))}initAudio(){if(this.audioData)if(this.audioData.src)this.audioBlobUrl=location.href.split("/").slice(0,-1).join("/")+"/"+this.audioData.src;else{const{wavStrList:t,pcmStrList:e}=this.audioData;let n;const i=[];if(t.length?(n="wav",i.push(...t)):e.length&&(n="pcm",i.push(...e)),!n)return;const s=[];for(let t=0;t<i.length;t++){const e=K(i[t]);s.push(e)}const r="wav"===n?new Blob(s,{type:"audio/wav"}):function(t,e){const n=X(t,e);return new Blob([n],{type:"audio/wav"})}(s,this.audioData.opts),o=URL.createObjectURL(r);this.audioBlobUrl=o}}mountVideos(){this.videos&&this.videos.length&&this.videos.forEach((t=>{const{src:e,id:n}=t,i=it.getNode(n);if(i){const t=i;t.muted=!0,t.autoplay=t.loop=t.controls=!1,t.src=e}}))}streamHandle(t){const e=t.detail;if(A(e))return os.getState().replayData.currentData.snapshot=e,void this.setViewState();this.execFrame(e)}initViewState(){const{currentData:t}=os.getState().replayData,{records:e,audio:n,videos:i,head:s}=t;this.records=this.processing(e),this.audioData=n,this.videos=i;const{userAgent:r}=(null==s?void 0:s.data)||{};var o;(o=r)&&as({ua:o})&&this.pointer.hidePointer(),this.records.length&&(this.subtitlesIndex=0,this.broadcaster.cleanText(),this.curViewStartTime=s&&s.time||e[0].time,this.curViewEndTime=e.slice(-1)[0].time,this.preViewsDurationTime=0,this.curViewDiffTime=0,this.viewIndex=0)}setViewState(){this.c.setViewState(),this.initAudio(),this.mountVideos()}jump(t,e=!1){return n(this,void 0,void 0,(function*(){let n;this.isJumping=!0,this.shouldWaitForSync=!0;const{speed:i}=os.getState().player,{index:s,time:r,percent:o}=t;e&&(this.pause(!1),n=ms('<div class="lds-ring"><style>.lds-ring{margin-left:-40px;margin-top:-40px;width:80px;height:80px;position:absolute;left:50%;top:50%}.lds-ring div{box-sizing:border-box;display:block;position:absolute;width:64px;height:64px;margin:8px;border:8px solid grey;border-radius:50%;animation:lds-ring 1.2s cubic-bezier(0.5,0,0.5,1) infinite;border-color:grey transparent transparent transparent}.lds-ring div:nth-child(1){animation-delay:-0.45s}.lds-ring div:nth-child(2){animation-delay:-0.3s}.lds-ring div:nth-child(3){animation-delay:-0.15s}@keyframes lds-ring{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}</style><div></div><div></div><div></div><div></div></div>')[0],this.c.container.appendChild(n),yield R(100));const a=this.getNextReplayData(s);if(!a)return;if(this.initViewState(),this.viewIndex!==s||this.startTime>=r){const[{packsInfo:t},{packs:e}]=[os.getState().progress,os.getState().replayData],n=t[s].diffTime;this.curViewEndTime=e[s].slice(-1)[0].time,this.curViewDiffTime=n,this.preViewsDurationTime=t.slice(0,s).reduce(((t,e)=>t+e.duration),0),this.viewIndex=s,this.records=e[s]}const l=1+this.frames.findIndex(((t,e)=>{if(r>=t&&r<=(this.frames[e+1]||t+1))return!0}));this.frameIndex=l,this.initTime=w(),this.recordIndex=0,this.audioData=a.audio,this.startTime=r,this.subtitlesIndex=0,void 0!==o&&(this.progress.moveThumb(o),yield R(100)),this.setViewState(),this.playAudio(),this.loopFramesByTime(this.frames[this.frameIndex]),n&&(yield R(100),this.c.container.removeChild(n),os.dispatch({type:ns.SPEED,data:{speed:i}})),this.isJumping=!1,setTimeout((()=>this.shouldWaitForSync=!1),100)}))}getNextReplayData(t){const{packs:e}=os.getState().replayData,n=e[t];if(n){const t=us(n);return os.dispatch({type:rs.UPDATE_DATA,data:{currentData:t}}),t}return null}loopFramesByTime(t,e=!1){let n=this.frames[this.frameIndex];for(;n&&t>=n;)e||Yt.emit(Cs.PROGRESS,this.frameIndex,this.frames.length-1),this.frameIndex++,this.renderEachFrame(),n=this.frames[this.frameIndex];return n}play(){0===this.frameIndex&&(this.progress.moveThumb(),this.isFirstTimePlay?this.progress.drawHeatPoints():(this.getNextReplayData(0),this.initViewState(),this.setViewState())),this.playAudio(),this.isFirstTimePlay=!1,this.RAF&&this.RAF.requestID&&this.RAF.stop(),this.RAF=new J(function(t,e){return n(this,void 0,void 0,(function*(){const t=w()-this.initTime;if(this.frameIndex>0&&this.frameIndex>=this.frames.length)return void this.stop();const e=this.startTime+t*this.speed;if(this.loopFramesByTime(e)>this.curViewEndTime-this.curViewDiffTime&&this.viewIndex<this.viewsLength-1){const{packsInfo:t}=os.getState().progress,e=this.viewIndex+1,{startTime:n,diffTime:i}=t[e];this.jump({index:e,time:n-i})}this.elapsedTime=(e-this.frames[0])/1e3,this.syncAudio(),this.syncVideos()}))}.bind(this),this.maxFps),this.options.destroyStore.add((()=>this.RAF.stop())),this.RAF.start(),this.initTime=w(),this.startTime=this.frames[this.frameIndex]}playAudio(){this.audioData&&(this.audioBlobUrl?this.audioNode&&(this.audioNode.src&&this.audioNode.src===this.audioBlobUrl||(this.audioNode.src=this.audioBlobUrl),this.syncAudioTargetNode(),this.speed>0&&this.audioNode.play()):this.pauseAudio())}syncAudio(){if(!this.audioNode)return;Math.abs(this.elapsedTime-this.preViewsDurationTime/1e3-this.audioNode.currentTime)>(100+this.audioOffset)/1e3&&this.syncAudioTargetNode()}syncAudioTargetNode(){this.audioNode.currentTime=this.elapsedTime-this.preViewsDurationTime/1e3+this.audioOffset/1e3}syncVideos(){const t=this.curViewStartTime,e=t+(1e3*this.elapsedTime-this.preViewsDurationTime);this.videos.forEach((n=>{const{startTime:i,endTime:s,id:r}=n,o=it.getNode(r);if(o)if(e>=i&&e<s){o.paused&&this.speed>0&&o.play();const e=this.elapsedTime-this.preViewsDurationTime/1e3-(i-t)/1e3;Math.abs(e-o.currentTime)>.1&&(o.currentTime=e)}else o.paused||o.pause()}))}pauseAudio(){this.audioNode&&this.audioNode.pause()}pauseVideos(){this.videos&&this.videos.length&&this.videos.forEach((t=>{const e=it.getNode(t.id);e&&e.pause()}))}renderEachFrame(){let t;for(this.progress.updateTimer(this.frameIndex,this.frameInterval,this.curViewDiffTime);this.recordIndex<this.records.length&&(t=this.records[this.recordIndex]).time-this.curViewDiffTime<=this.frames[this.frameIndex];)this.execFrame(t),this.recordIndex++;this.syncSubtitles()}syncSubtitles(){return n(this,void 0,void 0,(function*(){if(!this.shouldWaitForSync&&this.audioData&&this.audioData.subtitles.length){const t=this.audioData.subtitles;let{text:e}=t[this.subtitlesIndex];const{end:n}=t[this.subtitlesIndex],i=x(n);if(this.elapsedTime>i/1e3&&(this.broadcaster.cleanText(),this.subtitlesIndex<t.length-1)){for(;;){if(x(t[this.subtitlesIndex].end)/1e3>this.elapsedTime)break;this.subtitlesIndex++}e=t[this.subtitlesIndex].text}this.broadcaster.updateText(e)}}))}pause(t=!0){this.RAF&&this.RAF.stop(),os.dispatch({type:ns.SPEED,data:{speed:0}}),this.pauseAudio(),this.pauseVideos(),t&&Yt.emit(Cs.PAUSE)}stop(){this.speed=0,this.recordIndex=0,this.frameIndex=0,this.elapsedTime=0,this.pause(),this.audioNode.currentTime=0,Yt.emit(Cs.STOP)}execFrame(t){const{isJumping:e,speed:n}=this;Vs.call(this,t,{isJumping:e,speed:n})}calcFrames(t=this.maxFrameInterval){if("live"===this.options.mode)return[];const e=this.frames&&this.frames[this.frameIndex],{duration:n,startTime:i,endTime:s}=os.getState().progress;this.frameInterval=Math.max(20,Math.min(t,n/60/1e3*60-40));const r=this.frameInterval,o=[];let a;for(let t=i;t<s+r;t+=r)o.push(t),!a&&e&&t>=e&&(a=o.length-1);o.push(s),a&&(this.frameIndex=a),this.frames=o}calcHeatPointsData(){const t=this.frames;if(!(null==t?void 0:t.length)||!this.options.heatPoints)return[];const e=os.getState(),{packs:n}=e.replayData,{duration:i}=e.progress,s=i/Math.floor(this.progress.slider.offsetWidth/7);return n.reduce(((t,e)=>{let n=0,i=0,r=!1;const o=e.slice(-1)[0].time;let a=e[0].time;for(;a<o&&n<e.length;){const o=e[n];o.time<a+s?(n++,i++,A(o)&&(r=!0)):(t.push({step:i,snapshot:r}),i=0,r=!1,a+=s)}return t}),[])}orderRecords(t){return t.length?(t.sort(((t,e)=>t.time-e.time)),t):[]}recalculateProgress(){this.calcFrames(),this.progress.drawHeatPoints(this.calcHeatPointsData())}processing(t){return this.orderRecords(t)}};e([vs((t=>({speed:t.player.speed})))],Gs.prototype,"watchPlayerSpeed",null),e([vs((t=>({endTime:t.progress.endTime})))],Gs.prototype,"watchProgress",null),Gs=e([xs("timecat-player",As`<div class="timecat-player"> <iframe class="player-sandbox" sandbox="allow-same-origin allow-scripts allow-popups allow-popups-to-escape-sandbox" ></iframe> </div>`)],Gs);let Ws=class{constructor(t){this.x=0,this.y=0,this.c=t,this.initPointer(),this.togglePointer(!0)}initPointer(){this.pointer=this.c.container.querySelector(".player-pointer")}togglePointer(t=!this.show){this.show=t,this.pointer.firstElementChild.style.display=this.show?"inherit":"none"}hidePointer(){this.togglePointer(this.show=!1)}move(t,e){this.x=t,this.y=e,this.pointer.style.left=this.x+"px",this.pointer.style.top=this.y+"px"}click(t,e){return n(this,void 0,void 0,(function*(){this.move(t,e),this.pointer.hasAttribute("active")||(yield R(200),dt(this.pointer,"active",""),yield R(400),dt(this.pointer,"active",null))}))}};Ws=e([xs("player-pointer",As`<div class="player-pointer"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAACACAQAAAAhBLbAAAAMkklEQVR42u2ceXAb5RXAfyvJh2xLcqw4dmQ7thPbOSGEOLJbjtIUBgi0wxSmMNNSoDTQMrRAIIUm8E+HuwfD0OkwPZgGUmiBNswUmvhIoBkIsS0DCTShSYAcxHYS27ItW7e0/UOr9a7sla3Tnqnfjjz77fft6uent+977+0BczInczInczInWRYBQf47a0RIqE+cadypoAXpI6KTgMXZgq2LiyyWFK4wEyIHPTp0s81MJkLrMEBx7WdtVzUAJozkYkA3m7EF9OSAYB4LiM6aYqCEQvJmN7YOPXkIwvxTvaJ4+COzBVhAEfnkzF5sAQNGcgTbqV5RFMXDn5hLgXJMsxdbQEcOheQL1af6RFEURfHTQ2YbAgsV2DMGrovTF0GX0JYu73rbXMkZishBj34mda0NLUgeRIZraHDsNlfJ2DOoa13cXkHdX1/vaLcs4ixF5Eh+ZEawp4KOwaqv69o989i6RHeoX9zVVlzDuZnEngp6EqD6JZ0tJTWytvXZx57KPCaV+iUdLdZaCVuffeyEzSMidYs7W621KgeYRfAEoN+lQ9FaXOtosy6O8dtZwk4A+gDNnFK0a2q62+cvmYnpJgFoG7CWHsWW6mpH+/y67E83Cdr0ORr5Uom9qLu9tI4zmLLpABM+EXu5BKeivajK0V7aQF82HWAS3uM4zTHYXa1lS2M8yWyDhiM0MaBoV1d1tpRHsHOzgZ2knz4ag72oqqvVtow+CrPht5OEhs+wq7ArK7tabcsl286w304aGj6nUYVtq3C02ZbThynT2ClAw3HW0q9oL7Q5dttW0Kuw7YxIStBwgkY1dnn3bttKFXYGwFOEhhOs45yiXV7W3VZxHr0UZg47ZWg4jp0zSuxyR2tlFDsj000aoOE4TfSpsLtaFp1Pb6amm7RAwwma6FVhd7ZUr6ZHZSRpA08TNJzErsIuK+9qrblAZdtpc4Bpg4YvaVRhly5wRLCL0o2dRmjoYa0K21rqaK9ZQw9F8imZFuy0QkNvTJpgtXa3166RTklDuqabNENDL40q7JKSfW/aooFrmhxg2qEj2MrsptzmaLXVpxM7A9DQi52TivbCqq7WijRiZwQaemnihKJtq+psrWpIV50kQ9DQh53jauyWRersJmlPkjFoOMs6FXZ5VVdL9bJ0YGcQGvpjsBdUOlqql9GXqt/OKDT006jCnl/haK1eoSo4JCEZhoaBWGybo616ZWp1koxDR7A/V2KXd7fVpISdBWgYwM5nira1zNFauyp57KxAwwBNHFVil3e1LF6likkSAM8SdAT7iAq7s6Xu/JhQaprYWYMGJ3b+G4Ndf0Ey5Z0sQsMwdpW255V17WpYLaUJCWg7q9AwwjoVtmVBZ0vDGnql+vY0/XaWoSPYSiOxlHa1NkSym2l7kqxDwwh2PlW0zdautoYLYzzJbIOOYB9SYpd0tSy9UJFLTnE/yYxAg4tmlZGYrZ0tyxvpoVBx7UYTfIagwcVlqgt8ZmvHrhWNKtvW9CQzBh1JE5TZjcna0bLKTg+mqRzgDEJPzG6KSjp2ntfEabl0qZsce0ahJ2Y3BSX7d53XLJ+SGrY9w9DQTy1tSuzijl3nNXMaE3laoZQhk0DzuZ1RgnHH5HCQ3Vyh2GK0dLTYr/pkPzZAIEgImMZdrgI6cjFhEVadOidK8g+RhJducToSFsMxW9zD538VgSrmUUBu7ISTYfO4Z1qjJpqt0dyxc/VXOCUVinXqUzLD0O/y1yT3zDd37FzTzJcUTLx1MU3QC5iv0fN40sfMM3/wzqVX0DPxtty0QFs5zcMafR/zvKIVCA6PESYkLWHVElIsQYIEyHvnxSY7ThlZAk+D97DSgYFbeJyzGrr+AbnSeo7h7pe2d9ZaQ34hRGjSu99FREJCEJ/gDYzUlrgMFEojhOjIlKEr2UcVUMxmNk864hS/YovcunXd9te/OEsQPwFChCdxZWFEQvjx4fnShQEjY+oBKZpHDR9SJa1volZj1NOKq7rfWHXLFZxDT5gQAfyTLAHJN+vJw4SAT/rX5H8vJeilOBQnoI6tGuOGeUrRevg6vZEBxhhhGCdOBlXLAIMM4mSYEUZx4yNISAIWU4a+kANYVVtuZ43G2GcVxZq6mnuv5CQB3LhwMRyzjEh/RxhlDA8+goTVZpQ09FreJ2/CVi1dB1S63nKzpRInIfx48eDGzZhicePGjQcPXvwECMinbGrQ63HIHkEp1/N1jT3+wEfyeknpz79DPzpEQgQJ4JvUtqPA4VibnlymiD3WxwYPofHgoU0zDrlBGVuMVl5COZUUY5SfolEvkZvOhcmivCQ0fQO7VW2X52vPvSMX6i7nOo39Xudted1YuOU23KonZ0RE1VQT3SaqTSMpTd8Yo2SPr+kxLrrl9+NbHJq6Vv1CwVVXMp9KisnHkFjdNAFNh4GbYwKgMW/jIx3vUb+ttVtOrtdym8YR9rBjvKHfupEQuXL2nYAkAH2CDbwYg2zf+p9uivFw5rG/jW/fqnkMZfh00/UXrcdJPoZEnwtLAPqWGC33j6y+/1A3ZgYZJG/Hzrf3R3uWcJ/GMRz8WdHaupEcDIk/E5YAtBWTonV2aO2mzw5ixomTIdw4H31pvHezaqxa12F5/eorr9lAP/lZqk/3Ou2bTx7FgpMhaRYr2tP299Zo/0Ie0NjzKM8qWg/fiQVBkZ1kDvrT3lU/PXEEE06GGMGFCxceAk+8MD7mfio19n4Sl7ze3Pz96+jHKD8PlqlS7+Ee+/2DpyjCKcUHkSl3DFP3vj+9Fh1VyM809j/LLxWth35MGSFypCkmM5o+cNL+gKuHIobkkMaPDx9ePBge3xb0R0f+hGUax/i14o6Q5SvuuokBjHK1NOUrARNmon1H19w32kchgxKyV4p/A/jxUvj5h79RnI5ars/NE4rWljsKa/FLdp0WTauw3zty8YPiEEacjOBiDC8BOasL4MdDwVMvj8h3hH+PJo3D/pbD8npF9aabccoxSHqvBLR+fPED4hB5kpbdeKUcIxI1RAJN4+DhJ7eN7/OI5tGU08yDd5Stwj39m2qn1rSk6ze7r7yX0QnIYTmyCBHEzxjFz7x6Ur6t5hqu0jjwduS5iMKSh27FRf50dT2VTUvIb+3/5j2EMDAg23IUOWJCYcJSZKz3nnhCoWvtKf0XivW7f7jYjkua0qd0fdrQ0o8u6OC1f117B2H0OHFJeZtfoWWkT8Su3cx7fscB+UrQxdyo8QU72SuvG/Ie2YhPCp+SvKEi+oytUVcnhvbuYSGruZg1NFCJlaJJHsUWENCTjwUbK6m86YHxGPTgpGHqInGb6FcFues2YKECM3lTXeHSa0ALkWm1oko/dPtDfiMFuKRpJJIdT6xXRGtAOgTMnxxZ31gtTYllnMGhGlrMs2xndcyXl1te2YFRSmOTEh0G8jHryvT5LGQZS1hEGfOkCwuT6UFAwEAeFhayjMrL7xzX4UkxR9Zwrvj4hMJuVL61ESOlFJEbP+rTa/YICAhiWMxHj09a/HINQpx0j+hHh+Xzo6uXLV8S6bDg4V0ANrGL9Ro8b+35S+vAgFRGn2aKFQsQ0XUhZoopxkyR5P7jWZuAnjzMlLGU6nXfHddhj2gWrxXPiVryxvv1G6mmgWUswCSV0eN8TRw9S5YdeWGGSAiRMPFSeQHQk0M+JiwMv/DMbd+OdIi4KNJwVTsP3P/y4b2EyWeYYUbxECAYT9dC3O1RnymCyr3FO1rkLQoFmAk3rDz8mi43znj+fWjTqx/sJUyBVG8aw42PgORONUQf54hK2OghprK0cR+iwzTwxbzS5gu0hnYdu+F3jz7f+wUmRCmWic4AU5QN4rtxde/0Tg1B1rUJYX7Nsdct5omDjpy+65Xd7fgw4WcMD268ePEpCsBxvi2eppOTqK4FdJjcJwxF62NCvb7Bjdt+9OwXBylEh0vKfNyylievWSeg6WSxIx7biAlDvvXYqxUV0a5R95Ydz73BGcyEGcONF49UyQvKwFPW7dKvabW/Lgie9uVuuBQgFHjynxuefr8dHfmMMoJLSta8Ch0zNXKmHr6LRCK5GCkil5xjbyyp++POza8MHcOMgTE8qkJuQK7eTfP9Q5mD1mEglwLM+K6+LGBpb8OKCQ9eCdhHQEoiEgLOJHT0VT15GLEwgoEKkDLJqDkEkgHOHHTkyDoJO488cqUSekACDsrF8iReSZXJuxBEwgSBMEG8CCBd1EwJOBvQkRk1KIUdkeuyKQFDZl+5EH3/23iqKsakaCkcOJMiKD7KEy6lF6tl/s0Fsd8wK94DNydzMif/n/I/5OjlEWH8JT8AAAAASUVORK5CYII=" alt="pointer" /> <div class="spinner"></div> </div>`)],Ws);let Xs=class{constructor(t,e){this.heatPoints=[],this.findProgressByPosition=(()=>{const t=new Map;return function(e){const n=t.get(e);if(n)return n;const{startTime:i,duration:s,packsInfo:r}=os.getState().progress,{packs:o}=os.getState().replayData,a=i+s*e,l=r.findIndex((t=>{const{startTime:e,endTime:n,diffTime:i}=t;if(e-i<=a&&n-i>=a)return!0}));if(void 0!==l){const n=o[l],i=r[l],{startTime:s,diffTime:c}=i,d=r.reduce(((t,e)=>t+e.duration),0),h=r.slice(0,l).reduce(((t,e)=>t+e.duration),0);for(let i=0;i<n.length;i++){const r=n[i],o=n[i+1];if(o&&a>=r.time-c&&a<=o.time-c){const n={index:l,percent:e,time:r.time-c+(d*e-(r.time-s)-h)};return t.set(e,n),n}}}return null}})(),this.listenElementOnHover=t=>function(t,e,n){let i=n,s=0;return n=>{t((function(t){s&&clearTimeout(s),s=window.setTimeout((()=>{i!==t&&(n(t),i=t,clearTimeout(s),s=0)}),"number"==typeof e?e:e(t))}))}}((e=>{const n=()=>e("in"),i=()=>e("out");t.addEventListener("mouseover",n,!1),t.addEventListener("mouseout",i,!1),this.options.destroyStore.add((()=>{t.removeEventListener("mouseover",n,!1),t.removeEventListener("mouseout",i,!1)}))}),(t=>"in"===t?200:1e3),"out"),this.options=t,this.c=e,this.progress=e.container.querySelector(".player-progress"),this.progress=e.container.querySelector(".player-progress"),this.timer=e.container.querySelector(".player-timer"),this.currentProgress=this.progress.querySelector(".player-current-progress"),this.slider=this.progress.querySelector(".player-slider-bar"),this.heatBar=this.progress.querySelector(".player-heat-bar"),this.thumb=this.progress.querySelector(".player-thumb"),this.listenElementOnHover(this.parent)((t=>{"in"!==t?this.thumb.removeAttribute("active"):this.thumb.setAttribute("active","")}));const n=t=>{const{left:e,width:n}=this.slider.getBoundingClientRect(),i=+(Math.max(0,Math.min(t.x-e,n))/n).toFixed(3),s=this.findProgressByPosition(i);Yt.emit(Cs.JUMP,s)};this.progress.addEventListener("click",n,!1),this.options.destroyStore.add((()=>{this.progress.removeEventListener("click",n,!1)}))}updateTimer(t,e,n){const i=this.c.options,{timeMode:s}=i,r=(t+1)*e;let o;if("durationTime"===s)o=function(t){t<=0&&(t=0);const[e,n,i]=[Math.floor(t/3600),Math.floor(t/60%60),Math.floor(t%60)];return[e,n,i].map((t=>t<=9?"0"+t:t)).join(":").replace(/^00\:/,"")}(r/1e3);else{const{startTime:t}=os.getState().progress;o=function(t){const e=new Date(t),n=e.getHours(),i="0"+e.getMinutes(),s="0"+e.getSeconds();return(n<10?"0"+n:n)+":"+i.substr(-2)+":"+s.substr(-2)}(t+r+n)}o!==this.timer.innerText&&(this.timer.innerText=o)}moveThumb(t=0){this.currentProgress.style.width=t*this.slider.offsetWidth+"px"}drawHeatPoints(t){if(t){if(function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++){const i=t[n],s=e[n];if(i.step!==s.step||i.snapshot!==s.snapshot)return!1}return!0}(this.heatPoints,t))return;this.heatPoints=t}else if(this.heatPoints.length)return;this.heatPoints.length?new ws(this.heatBar,this.heatPoints):new Ts(this.heatBar)}setProgressPosition(t){this.currentProgress.style.width=this.slider.offsetWidth*t+"px"}};Xs=e([xs("player-progress",As`<div class="player-progress"> <div class="player-timer">00:00</div> <div class="player-slider-bar"> <div class="player-heat-bar-container"> <canvas class="player-heat-bar"></canvas> </div> <div class="player-current-progress"> <div class="player-thumb"></div> </div> </div> </div>`)],Xs);let Zs=class{constructor(t){this.c=t,this.init()}init(){this.broadcaster=this.c.container.querySelector(".player-broadcaster"),this.floatLayer=this.broadcaster.firstElementChild,this.subtitle=this.floatLayer.firstElementChild}updateText(t){t=t.trim(),this.subtitle.innerText.trim()!==t&&(this.subtitle.innerText=t,this.floatLayer.toggleAttribute("hidden",!t))}cleanText(){this.updateText("")}};Zs=e([xs("player-broadcaster",As`<div class="player-broadcaster"> <div class="float-layer" hidden> <span class="subtitle"></span> </div> </div>`)],Zs);let Ys=class{constructor(t,e){this.options=t,this.c=e,this.exportBtn=this.target.querySelector(".player-export"),this.exportBtn.addEventListener("click",this.export),this.fullscreenBtn=this.target.querySelector(".player-fullscreen"),this.fullscreenTarget=this.c.container.parentNode.host.parentElement,this.fullscreenTarget.addEventListener("fullscreenchange",(()=>this.cancelFullScreen())),this.fullscreenBtn.addEventListener("click",(()=>this.setFullScreen())),this.options.destroyStore.add((()=>{this.exportBtn.removeEventListener("click",this.export),this.fullscreenTarget.removeEventListener("fullscreenchange",(()=>this.cancelFullScreen())),this.fullscreenBtn.removeEventListener("click",(()=>this.setFullScreen()))}))}export(){return n(this,void 0,void 0,(function*(){const t=document.querySelector("#timecat"),e=document.querySelector("#timecat-init"),i=[],s=document.querySelectorAll("script");function r(t){return n(this,void 0,void 0,(function*(){if(t)return t.textContent||(yield G(t.src.trim()))||t.src}))}const o=(yield r(t))||Array.from(s).map((t=>t.src)).find((t=>/(timecat)(\.prod)?\.global\.js/.test(t)))||Array.from(s).map((t=>t.textContent)).find((t=>null==t?void 0:t.trim().startsWith("var TimeCat")))||"//cdn.jsdelivr.net/npm/timecatjs/dist/timecat.global.prod.js";i.push({name:"timecat",src:o});const a=(yield r(e))||Array.from(s).map((t=>t.textContent)).find((t=>{if(t)return/new\s(TimeCat\.)?Player/.test(t)}))||"new window.TimeCat.Player({autoplay: true})";i.push({name:"timecat-init",src:a});const l=os.getState().player.options;Is(Object.assign(Object.assign({},l),{scripts:i}))}))}setFullScreen(){this.c.resize({maxScale:100}),this.fullscreenTarget.requestFullscreen().catch((t=>{E(t),function(t){console.log(`%c TimeCat Advice: ${t}`,"color:#0f0;")}("If the Player within the iframe, you should be set the attribute: allowfullscreen")}))}cancelFullScreen(){document.fullscreen||this.c.resize({maxScale:0})}};Ys=e([xs("player-toolbox",As`<div class="player-toolbox"> <div class="player-export"> <button type="button"> <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 511.994 511.994" style="enable-background:new 0 0 511.994 511.994;" xml:space="preserve" > <path style="fill:#fff;" d="M403.079,310.458c-3.627-7.232-11.008-11.797-19.093-11.797h-64v-85.333c0-11.776-9.536-21.333-21.333-21.333H213.32 c-11.776,0-21.333,9.557-21.333,21.333v85.333h-64c-8.064,0-15.445,4.565-19.072,11.797c-3.605,7.232-2.837,15.872,2.027,22.336 l128,170.667c4.011,5.376,10.347,8.533,17.045,8.533c6.72,0,13.056-3.157,17.067-8.533l128-170.667 C405.917,326.33,406.685,317.69,403.079,310.458z" /> <path style="fill:#fff;" d="M298.663,128.001H213.33c-11.797,0-21.333,9.536-21.333,21.333c0,11.797,9.536,21.333,21.333,21.333h85.333 c11.797,0,21.333-9.536,21.333-21.333C319.996,137.537,310.46,128.001,298.663,128.001z" /> <path style="fill:#fff;" d="M298.663,64.001H213.33c-11.797,0-21.333,9.536-21.333,21.333s9.536,21.333,21.333,21.333h85.333 c11.797,0,21.333-9.536,21.333-21.333S310.46,64.001,298.663,64.001z" /> </svg> </button> </div> <div class="player-fullscreen"> <svg version="1.1" id="Capa_1" width="16px" height="16px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 469.333 469.333" style="enable-background:new 0 0 469.333 469.333;" xml:space="preserve" > <path style="fill:#fff;" d="M160,0H10.667C4.771,0,0,4.771,0,10.667V160c0,5.896,4.771,10.667,10.667,10.667H32c5.896,0,10.667-4.771,10.667-10.667 V42.667H160c5.896,0,10.667-4.771,10.667-10.667V10.667C170.667,4.771,165.896,0,160,0z" /> <path style="fill:#fff;" d="M458.667,0H309.333c-5.896,0-10.667,4.771-10.667,10.667V32c0,5.896,4.771,10.667,10.667,10.667h117.333V160 c0,5.896,4.771,10.667,10.667,10.667h21.333c5.896,0,10.667-4.771,10.667-10.667V10.667C469.333,4.771,464.563,0,458.667,0z" /> <path style="fill:#fff;" d="M458.667,298.667h-21.333c-5.896,0-10.667,4.771-10.667,10.667v117.333H309.333c-5.896,0-10.667,4.771-10.667,10.667 v21.333c0,5.896,4.771,10.667,10.667,10.667h149.333c5.896,0,10.667-4.771,10.667-10.667V309.333 C469.333,303.437,464.563,298.667,458.667,298.667z" /> <path style="fill:#fff;" d="M160,426.667H42.667V309.333c0-5.896-4.771-10.667-10.667-10.667H10.667C4.771,298.667,0,303.437,0,309.333v149.333 c0,5.896,4.771,10.667,10.667,10.667H160c5.896,0,10.667-4.771,10.667-10.667v-21.333 C170.667,431.438,165.896,426.667,160,426.667z" /> </svg> </div> </div>`)],Ys);let Ks=class{constructor(t){this.c=t,this.options=t.options,this.options.hidePanel&&(this.target.style.display="none"),this.initComponent()}initComponent(){new Ys(this.options,this.c),this.keyboard=new Ls(this.options,this.c),this.progress=new Xs(this.options,this.c),this.pointer=new Ws(this.c),this.broadcaster=new Zs(this.c),this.player=new Gs(this.options,this.c,this.pointer,this.progress,this.broadcaster)}};Ks=e([xs("player-panel",As`<div class="player-panel"> <slot></slot> </div>`)],Ks);let qs=class{constructor(){setTimeout((()=>{}))}};qs=e([xs("player-start-page",As`<div class="player-start-page" style="display: none;"> <div class="play-btn"> <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 142.448 142.448" style="enable-background:new 0 0 142.448 142.448;" xml:space="preserve" > <g> <path style="fill:#bbb;" d="M142.411,68.9C141.216,31.48,110.968,1.233,73.549,0.038c-20.361-0.646-39.41,7.104-53.488,21.639 C6.527,35.65-0.584,54.071,0.038,73.549c1.194,37.419,31.442,67.667,68.861,68.861c0.779,0.025,1.551,0.037,2.325,0.037 c19.454,0,37.624-7.698,51.163-21.676C135.921,106.799,143.033,88.377,142.411,68.9z M111.613,110.336 c-10.688,11.035-25.032,17.112-40.389,17.112c-0.614,0-1.228-0.01-1.847-0.029c-29.532-0.943-53.404-24.815-54.348-54.348 c-0.491-15.382,5.122-29.928,15.806-40.958c10.688-11.035,25.032-17.112,40.389-17.112c0.614,0,1.228,0.01,1.847,0.029 c29.532,0.943,53.404,24.815,54.348,54.348C127.91,84.76,122.296,99.306,111.613,110.336z" /> <path style="fill:#bbb;" d="M94.585,67.086L63.001,44.44c-3.369-2.416-8.059-0.008-8.059,4.138v45.293 c0,4.146,4.69,6.554,8.059,4.138l31.583-22.647C97.418,73.331,97.418,69.118,94.585,67.086z" /> </g> </svg> </div> </div>`)],qs);class $s{constructor(t){this.options=t,this.init()}init(){const t=this.options.target,e="string"==typeof t?document.querySelector(t):t;this.target=e,this.initTemplate(),this.initSandbox();const{resize:n}=this.makeItResponsive();this.resize=n,this.initPanel(),setTimeout((()=>Yt.emit(Cs.INIT)))}initPanel(){this.panel=new Ks(this),new qs}initSandbox(){this.sandBox=this.container.querySelector(".player-sandbox"),this.sandBoxDoc=this.sandBox.contentDocument,this.setSmoothScroll(this.sandBox.contentWindow),gs(this.sandBoxDoc,this.getSnapshotRecord()),this.options.disableScrolling&&function(t){const e={37:1,38:1,39:1,40:1};function n(t){t.preventDefault()}function i(t){if(e[t.keyCode])return n(t),!1}let s=!1;try{t.addEventListener("test",(()=>{}),Object.defineProperty({},"passive",{get:function(){s=!0}}))}catch(t){}const r=!!s&&{passive:!1},o="onwheel"in document.createElement("div")?"wheel":"mousewheel";t.addEventListener("DOMMouseScroll",n,!1),t.addEventListener(o,n,r),t.addEventListener("touchmove",n,r),t.addEventListener("keydown",i,!1)}(this.sandBox.contentWindow.document),this.setViewState()}getSnapshotRecord(){return os.getState().replayData.currentData.snapshot.data}setSmoothScroll(t){Xt.polyfill(),t.HTMLElement.prototype.scroll=window.scroll,t.HTMLElement.prototype.scrollTo=window.scrollTo}setViewState(){it.reset();const t=this.getSnapshotRecord(),{pathname:e,hash:n,href:i}=k(t.href),s=this.sandBoxDoc.defaultView;s.G_REPLAY_LOCATION=Object.assign(Object.assign({},s.G_REPLAY_LOCATION||{}),{path:e,hash:n,href:i}),_s(this.sandBoxDoc,t)}initTemplate(){const t=this.target instanceof Window?this.target.document.body:this.target,e=ms(As`<div class="player-shadowhost"></div>`)[0];t.appendChild(e);const n=e.attachShadow({mode:"open"});n.appendChild(this.createStyle("player-css","/**\n * Copyright (c) oct16.\n * https://github.com/oct16\n * \n * This source code is licensed under the GPL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nbody {\n  margin: 0;\n  background-color: #e2e2e2;\n  overflow: hidden;\n}\n.player-main {\n  box-shadow: 0px 0px 5px rgba(26, 26, 26, 0.05);\n  transition: all 0.5s;\n  -webkit-transition: all 0.5s;\n  opacity: 0;\n  position: relative;\n  overflow: visible;\n}\n.player-sandbox {\n  background: white;\n  vertical-align: top;\n  border: 0;\n  width: 100%;\n  height: 100%;\n}\n.timecat-player {\n  position: relative;\n  width: inherit;\n  height: inherit;\n}\n.player-pointer {\n  width: 10px;\n  height: 10px;\n  position: absolute;\n  transition: all 0.2s;\n}\n.player-pointer img {\n  width: 15px;\n  position: absolute;\n  z-index: 100;\n  top: -5px;\n  left: -3px;\n}\n.player-pointer[active] .spinner {\n  width: 32px;\n  height: 32px;\n  left: -17px;\n  top: -18px;\n  position: absolute;\n  background-color: #333;\n  border-radius: 100%;\n  -webkit-animation: spinner-scale 0.4s 1 ease-in-out;\n  animation: spinner-scale 0.4s 1 ease-in-out;\n}\n@-webkit-keyframes spinner-scale {\n  0% {\n    -webkit-transform: scale(0);\n  }\n  100% {\n    -webkit-transform: scale(1);\n    opacity: 0.2;\n  }\n}\n@keyframes spinner-scale {\n  0% {\n    -webkit-transform: scale(0);\n    transform: scale(0);\n  }\n  100% {\n    -webkit-transform: scale(1);\n    transform: scale(1);\n    opacity: 0.2;\n  }\n}\n.player-container {\n  background: grey;\n}\n.player-panel {\n  width: 100%;\n  box-sizing: border-box;\n  padding: 5px 10px;\n  height: 40px;\n  position: absolute;\n  left: 0;\n  bottom: -41px;\n  background: black;\n  opacity: 0.8;\n  display: flex;\n  user-select: none;\n}\n.player-broadcaster {\n  position: absolute;\n  width: 100%;\n  left: 0;\n  bottom: 50px;\n  display: flex;\n  justify-content: center;\n}\n.player-broadcaster .float-layer {\n  margin: 0 10px;\n  line-height: 20px;\n  color: #fff;\n  background-color: rgba(0, 0, 0, 0.6);\n  border-radius: 2px;\n  padding: 5px;\n  box-shadow: 0px 0px 2px rgba(26, 26, 26, 0.5);\n  text-align: center;\n}\n.player-broadcaster .float-layer[hidden] {\n  display: none;\n}\n.player-keyboard {\n  white-space: nowrap;\n}\n.player-keyboard button[disabled] {\n  cursor: default;\n  color: #999;\n}\n.player-export button,\n.player-keyboard button {\n  border: none;\n  background: none;\n  color: white;\n  outline: none;\n  cursor: pointer;\n  font-size: 14px;\n  padding: 0 5px;\n}\n.player-export button.play-or-pause,\n.player-keyboard button.play-or-pause {\n  padding: 0;\n  text-indent: 1px;\n  transform: rotate(90deg);\n  width: 18px;\n}\n.player-progress,\n.player-keyboard,\n.player-toolbox,\n.player-timer {\n  display: flex;\n  align-items: center;\n}\n.player-export {\n  display: flex;\n}\n.player-export button {\n  padding: 2px 0 0 0;\n  padding-left: 2px;\n}\n.player-fullscreen {\n  margin-left: 8px;\n  cursor: pointer;\n  display: flex;\n}\n.player-progress {\n  width: 100%;\n  cursor: pointer;\n}\n.player-progress .player-timer {\n  margin-left: 2px;\n  padding: 0 4px;\n  color: white;\n  font-size: 14px;\n  font-family: Helvetica;\n}\n.player-slider-bar {\n  position: relative;\n  width: calc(100% - 20px);\n  height: 23px;\n  margin: 7.5px 8px;\n  border-radius: 2.5px;\n}\n.player-heat-bar-container {\n  height: 100%;\n  width: 100%;\n  position: absolute;\n  overflow: hidden;\n  background: black;\n}\n.player-heat-bar {\n  height: 16px;\n  width: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  margin: 2px 0px 0 0px;\n  background: black;\n  transform: rotateZ(180deg) rotateY(180deg);\n}\n.player-thumb {\n  width: 2px;\n  border: 1px solid white;\n  border-radius: 1px;\n  height: 95%;\n  background: #fff;\n  cursor: pointer;\n  position: absolute;\n  right: 0px;\n  top: 0;\n  z-index: 10;\n  transition: all 0.3s;\n  box-shadow: 0px 0px 5px black;\n}\n.player-thumb[active] {\n  background: red;\n  border-color: red;\n}\n.player-current-progress {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 0;\n  height: 100%;\n}\n.player-start-page {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: calc(100% + 42px);\n  -webkit-backdrop-filter: blur(1.5px);\n  backdrop-filter: blur(1.5px);\n  transition: 0.5s all;\n  cursor: pointer;\n}\n.player-start-page .play-btn {\n  position: absolute;\n  margin: auto;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 100px;\n  height: 100px;\n  transition: all 0.5s;\n  transform: scale(0);\n  opacity: 0;\n}\n.player-start-page .play-btn.show {\n  transform: scale(1);\n  opacity: 1;\n}\n")),n.appendChild(this.createContainer("player-main",'<div class="player-container">\n    <timecat-player></timecat-player>\n    <player-panel>\n        <player-broadcaster></player-broadcaster>\n        <player-keyboard></player-keyboard>\n        <player-progress></player-progress>\n        <player-toolbox></player-toolbox>\n    </player-panel>\n    <player-start-page></player-start-page>\n    <player-pointer></player-pointer>\n</div>\n')),this.shadowHost=e}createContainer(t,e){const n=(new DOMParser).parseFromString(e,"text/html").body.firstChild;return n.className=t,n.style.width=this.getSnapshotRecord().width+"px",n.style.height=this.getSnapshotRecord().height+"px",n.style.display="none",this.container=n}makeItResponsive(){const t=this,e=N(o,500),i=()=>e({target:t.target});window.addEventListener("resize",i,!0),this.options.destroyStore.add((()=>window.removeEventListener("resize",i,!0))),setTimeout((()=>this.container.style.opacity="1")),this.container.style.display="block";let s=0;function r(e){const{setHeight:n,setWidth:i,maxScale:s}=e||{};o({target:t.target},i,n,s)}function o(e,i,r,o=1){return n(this,void 0,void 0,(function*(){if(!e)return;const{width:n,height:l}=(c=t.container,{width:parseInt(c.style.width,10),height:parseInt(c.style.height,10)});var c;switch(i=i||n,r=r||l,o){case 0:s=0;break;case 100:s=100}const d=s||o;if(e.target instanceof Window){const{innerWidth:n,innerHeight:s}=e.target;a(t.container,n,s,i,r,d)}else{const{offsetWidth:n,offsetHeight:s}=e.target;a(t.container,n,s,i,r,d)}}))}function a(t,e,n,i,s,r){const{mode:o}=os.getState().player.options||{},a="live"===o?0:38,l=e/i,c=n/(s+a),d=Math.min(l>c?c:l,r||1),h=(i*d-i)/2+(e-i*d)/2,u=(n-s-a*d)/2;t.style.transform=`scale(${d})`,t.style.left=h+"px",t.style.top=u+"px";const p=parseInt(t.style.width),f=parseInt(t.style.height);i===p&&s===f||(t.style.width=i+"px",t.style.height=s+"px",Yt.emit(Cs.RESIZE))}return r(),{resize:r}}createStyle(t,e){const n=document.createElement("style");return n.id=t,n.innerHTML=e,n}}class Js{constructor(t){this.commands=[],this.commandsGetHandle=(t,e,n)=>("push"===e&&this.player&&setTimeout((()=>this.execLastCommand())),Reflect.get(t,e,n)),this.proxyCommands=new Proxy(this.commands,{get:this.commandsGetHandle}),this.getPlayer(),Yt.on(Cs.INIT,(()=>{var e;const{player:n}=(null===(e=null==t?void 0:t.c)||void 0===e?void 0:e.panel)||{};this.player=n,this.initResolve(this.player),this.execLastCommand()}))}command(t){this.proxyCommands.push(t)}execLastCommand(){let t;for(;t=this.commands.shift();){const{cmd:e,value:n}=t;this.getPlayer().then((t=>{switch(e){case"jump":const{startTime:e}=os.getState().progress;this.player.jump({index:0,time:e+n});case"speed":os.dispatch({type:ns.SPEED,data:{speed:n}});break;case"pause":t.pause()}}))}}get duration(){const{duration:t}=os.getState().progress;return t}get paused(){return 0===this.player.speed}get frames(){return{index:this.player.frameIndex,total:this.player.frames.length}}get currentTime(){const{duration:t}=os.getState().progress,{index:e,total:n}=this.frames;return+(e/n*t).toFixed(0)}set currentTime(t){this.setCurrentTime(t)}setCurrentTime(t){return n(this,void 0,void 0,(function*(){this.command({cmd:"jump",value:t})}))}getPlayer(){return n(this,void 0,void 0,(function*(){return yield new Promise((t=>{this.initResolve?t(this.player):this.initResolve=t}))}))}play(){return n(this,void 0,void 0,(function*(){this.command({cmd:"speed",value:1})}))}pause(){return n(this,void 0,void 0,(function*(){this.command({cmd:"pause"})}))}}const Qs={autoplay:!0,mode:"default",target:window,heatPoints:!0,timeMode:"durationTime",fastForward:[2,8],disableScrolling:!0};class tr{constructor(t){this.destroyStore=new Set,this.initialized=!1,this.triggerCalcProgress=N((()=>this.calcProgress()),500),this.getCtrl=()=>this.ctrl,it.reset(),this.init(t),this.watchData(),this.ctrl=new Js(this)}watchData(t){if(t&&!this.initialized){this.initialized=!0;const e=this.options,{records:i,packs:s,currentData:r}=t,{audio:o}=r,a=o&&(o.src||o.wavStrList.length||o.pcmStrList.length);if(this.c=new $s(e),function(t){t.container.querySelector(".player-start-page").setAttribute("style","")}(this.c),(this.fmp=new Zt).ready((()=>n(this,void 0,void 0,(function*(){a&&(yield function(t){return n(this,void 0,void 0,(function*(){const e=function(t){const e=t.querySelector(".player-start-page").querySelector(".play-btn");return e.classList.add("show"),e}(t);return new Promise((t=>{e.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){e.classList.remove("show"),yield R(500),t()}))))}))}))}(this.c.container)),function(t){var e;const n=t.querySelector(".player-start-page");null===(e=null==n?void 0:n.parentElement)||void 0===e||e.removeChild(n)}(this.c.container),i.length&&(e.autoplay||a)&&e.autoplay&&os.dispatch({type:ns.SPEED,data:{speed:1}})})))),s.length&&this.calcProgress(),i.length<=2){os.dispatch({type:ns.OPTIONS,data:{options:{mode:"live"}}});const t=this.c.panel.target;t&&t.setAttribute("style","display: none")}}}init(t){L(),this.initOptions(t),this.initData()}initOptions(t){return n(this,void 0,void 0,(function*(){const e=Object.assign(Object.assign({destroyStore:this.destroyStore},Qs),t);this.options=e,os.dispatch({type:ns.OPTIONS,data:{options:e}}),this.destroyStore.add((()=>os.unsubscribe()))}))}initData(){return n(this,void 0,void 0,(function*(){const t=this.options,e=yield this.getRecords(t);window.G_REPLAY_RECORDS=e;const n=is(e),i=us(n[0]);os.dispatch({type:rs.UPDATE_DATA,data:{records:e,packs:n,currentData:i}})}))}getRecords(t){return n(this,void 0,void 0,(function*(){const{receiver:e,records:n}=t,i=n||e&&(yield this.dataReceiver(e))||ps()||(yield fs());if(!i)throw E("Replay data not found");return i}))}calcProgress(){const{packs:t}=os.getState().replayData,e=t[0][0].time;let n=0;const i=[];let s=0;t.forEach(((e,r)=>{const o=e[0].time,a=e.slice(-1)[0].time;r&&(s+=o-t[r-1].slice(-1)[0].time);const l={startTime:o,endTime:a,duration:a-o,diffTime:s};i.push(l),n+=l.duration}));os.dispatch({type:ts.PROGRESS,data:{duration:n,packsInfo:i,startTime:e,endTime:e+n}})}dispatchEvent(t,e){const n=new CustomEvent(t,{detail:e});window.dispatchEvent(n)}dataReceiver(e){return n(this,void 0,void 0,(function*(){let n,i,s;return yield new Promise((r=>{e((e=>{n?this.dispatchEvent("record-data",e):(e.type===t.RecordType.HEAD?i=e:e.type===t.RecordType.SNAPSHOT&&(s=e),i&&s&&(n=!0,r([i,s]),this.dispatchEvent("record-data",e)))}))}))}))}destroy(t={removeDOM:!0}){var e;return n(this,void 0,void 0,(function*(){if(this.destroyStore.forEach((t=>t())),Yt.destroy(),os.unsubscribe(),yield R(0),Object.keys(window).filter((t=>{if(t&&(t.startsWith("G_RECORD")||t.startsWith("G_REPLAY")))return!0})).forEach((t=>{delete window[t]})),t.removeDOM){const t=this.c.shadowHost;null===(e=this.c.shadowHost.parentElement)||void 0===e||e.removeChild(t)}}))}on(t,e){Yt.on(t,e)}append(t){return n(this,void 0,void 0,(function*(){yield R(0),os.dispatch({type:rs.APPEND_RECORDS,data:{records:t}}),this.triggerCalcProgress()}))}}return e([vs((t=>({currentData:t.replayData.currentData,records:t.replayData.records,packs:t.replayData.packs})))],tr.prototype,"watchData",null),t.Player=class{constructor(t){this.on=D,this.destroy=D,this.append=D,this.getCtrl=D;const e=new tr(t);Object.keys(this).forEach((t=>{this[t]=e[t].bind(e)}))}},t.PlayerModule=tr,t.Recorder=class{constructor(e){this.status=t.RecorderStatus.PAUSE,this.onData=D,this.destroy=P,this.pause=P,this.record=P,this.use=D,this.clearDB=P;const n=new Gt(e);Object.keys(this).forEach((t=>{Object.defineProperty(this,t,{get:()=>"function"==typeof n[t]?n[t].bind(n):n[t]})}))}},t.RecorderModule=Gt,t.Watcher=ut,t.createReplayDocument=Os,t.debounce=N,t.delay=R,t.exportReplay=Is,t.throttle=O,t.version=v,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=timecat.global.prod.js.map
